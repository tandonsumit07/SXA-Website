---
ID: "88adf235-5b8f-4743-8ea3-30b316880fac"
Parent: "6ce5b4f5-1498-4b16-8233-af8569eaefce"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Themes/SitecoreShades/StandBlog/Site theme name/Scripts/owl
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/88ADF2355B8F47438EA330B316880FAC.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "f0dd4188-0772-40a8-95b4-2be7bdb019b0"
  Value: LyoqDQogKiBPd2wgQ2Fyb3VzZWwgdjIuMy40DQogKiBDb3B5cmlnaHQgMjAxMy0yMDE4IERhdmlkIERldXRzY2gNCiAqIExpY2Vuc2VkIHVuZGVyOiBTRUUgTElDRU5TRSBJTiBodHRwczovL2dpdGh1Yi5jb20vT3dsQ2Fyb3VzZWwyL093bENhcm91c2VsMi9ibG9iL21hc3Rlci9MSUNFTlNFDQogKi8NCi8qKg0KICogT3dsIGNhcm91c2VsDQogKiBAdmVyc2lvbiAyLjMuNA0KICogQGF1dGhvciBCYXJ0b3N6IFdvamNpZWNob3dza2kNCiAqIEBhdXRob3IgRGF2aWQgRGV1dHNjaA0KICogQGxpY2Vuc2UgVGhlIE1JVCBMaWNlbnNlIChNSVQpDQogKiBAdG9kbyBMYXp5IExvYWQgSWNvbg0KICogQHRvZG8gcHJldmVudCBhbmltYXRpb25lbmQgYnVibGluZw0KICogQHRvZG8gaXRlbXNTY2FsZVVwDQogKiBAdG9kbyBUZXN0IFplcHRvDQogKiBAdG9kbyBzdGFnZVBhZGRpbmcgY2FsY3VsYXRlIHdyb25nIGFjdGl2ZSBjbGFzc2VzDQogKi8NCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoNCgkvKioNCgkgKiBDcmVhdGVzIGEgY2Fyb3VzZWwuDQoJICogQGNsYXNzIFRoZSBPd2wgQ2Fyb3VzZWwuDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8alF1ZXJ5fSBlbGVtZW50IC0gVGhlIGVsZW1lbnQgdG8gY3JlYXRlIHRoZSBjYXJvdXNlbCBmb3IuDQoJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIFRoZSBvcHRpb25zDQoJICovDQoJZnVuY3Rpb24gT3dsKGVsZW1lbnQsIG9wdGlvbnMpIHsNCg0KCQkvKioNCgkJICogQ3VycmVudCBzZXR0aW5ncyBmb3IgdGhlIGNhcm91c2VsLg0KCQkgKiBAcHVibGljDQoJCSAqLw0KCQl0aGlzLnNldHRpbmdzID0gbnVsbDsNCg0KCQkvKioNCgkJICogQ3VycmVudCBvcHRpb25zIHNldCBieSB0aGUgY2FsbGVyIGluY2x1ZGluZyBkZWZhdWx0cy4NCgkJICogQHB1YmxpYw0KCQkgKi8NCgkJdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIE93bC5EZWZhdWx0cywgb3B0aW9ucyk7DQoNCgkJLyoqDQoJCSAqIFBsdWdpbiBlbGVtZW50Lg0KCQkgKiBAcHVibGljDQoJCSAqLw0KCQl0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KTsNCg0KCQkvKioNCgkJICogUHJveGllZCBldmVudCBoYW5kbGVycy4NCgkJICogQHByb3RlY3RlZA0KCQkgKi8NCgkJdGhpcy5faGFuZGxlcnMgPSB7fTsNCg0KCQkvKioNCgkJICogUmVmZXJlbmNlcyB0byB0aGUgcnVubmluZyBwbHVnaW5zIG9mIHRoaXMgY2Fyb3VzZWwuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX3BsdWdpbnMgPSB7fTsNCg0KCQkvKioNCgkJICogQ3VycmVudGx5IHN1cHByZXNzZWQgZXZlbnRzIHRvIHByZXZlbnQgdGhlbSBmcm9tIGJlaW5nIHJldHJpZ2dlcmVkLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl0aGlzLl9zdXByZXNzID0ge307DQoNCgkJLyoqDQoJCSAqIEFic29sdXRlIGN1cnJlbnQgcG9zaXRpb24uDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX2N1cnJlbnQgPSBudWxsOw0KDQoJCS8qKg0KCQkgKiBBbmltYXRpb24gc3BlZWQgaW4gbWlsbGlzZWNvbmRzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl0aGlzLl9zcGVlZCA9IG51bGw7DQoNCgkJLyoqDQoJCSAqIENvb3JkaW5hdGVzIG9mIGFsbCBpdGVtcyBpbiBwaXhlbC4NCgkJICogQHRvZG8gVGhlIG5hbWUgb2YgdGhpcyBtZW1iZXIgaXMgbWlzc2xlYWRpbmcuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX2Nvb3JkaW5hdGVzID0gW107DQoNCgkJLyoqDQoJCSAqIEN1cnJlbnQgYnJlYWtwb2ludC4NCgkJICogQHRvZG8gUmVhbCBtZWRpYSBxdWVyaWVzIHdvdWxkIGJlIG5pY2UuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX2JyZWFrcG9pbnQgPSBudWxsOw0KDQoJCS8qKg0KCQkgKiBDdXJyZW50IHdpZHRoIG9mIHRoZSBwbHVnaW4gZWxlbWVudC4NCgkJICovDQoJCXRoaXMuX3dpZHRoID0gbnVsbDsNCg0KCQkvKioNCgkJICogQWxsIHJlYWwgaXRlbXMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX2l0ZW1zID0gW107DQoNCgkJLyoqDQoJCSAqIEFsbCBjbG9uZWQgaXRlbXMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX2Nsb25lcyA9IFtdOw0KDQoJCS8qKg0KCQkgKiBNZXJnZSB2YWx1ZXMgb2YgYWxsIGl0ZW1zLg0KCQkgKiBAdG9kbyBNYXliZSB0aGlzIGNvdWxkIGJlIHBhcnQgb2YgYSBwbHVnaW4uDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXRoaXMuX21lcmdlcnMgPSBbXTsNCg0KCQkvKioNCgkJICogV2lkdGhzIG9mIGFsbCBpdGVtcy4NCgkJICovDQoJCXRoaXMuX3dpZHRocyA9IFtdOw0KDQoJCS8qKg0KCQkgKiBJbnZhbGlkYXRlZCBwYXJ0cyB3aXRoaW4gdGhlIHVwZGF0ZSBwcm9jZXNzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl0aGlzLl9pbnZhbGlkYXRlZCA9IHt9Ow0KDQoJCS8qKg0KCQkgKiBPcmRlcmVkIGxpc3Qgb2Ygd29ya2VycyBmb3IgdGhlIHVwZGF0ZSBwcm9jZXNzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl0aGlzLl9waXBlID0gW107DQoNCgkJLyoqDQoJCSAqIEN1cnJlbnQgc3RhdGUgaW5mb3JtYXRpb24gZm9yIHRoZSBkcmFnIG9wZXJhdGlvbi4NCgkJICogQHRvZG8gIzI2MQ0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl0aGlzLl9kcmFnID0gew0KCQkJdGltZTogbnVsbCwNCgkJCXRhcmdldDogbnVsbCwNCgkJCXBvaW50ZXI6IG51bGwsDQoJCQlzdGFnZTogew0KCQkJCXN0YXJ0OiBudWxsLA0KCQkJCWN1cnJlbnQ6IG51bGwNCgkJCX0sDQoJCQlkaXJlY3Rpb246IG51bGwNCgkJfTsNCg0KCQkvKioNCgkJICogQ3VycmVudCBzdGF0ZSBpbmZvcm1hdGlvbiBhbmQgdGhlaXIgdGFncy4NCgkJICogQHR5cGUge09iamVjdH0NCgkJICogQHByb3RlY3RlZA0KCQkgKi8NCgkJdGhpcy5fc3RhdGVzID0gew0KCQkJY3VycmVudDoge30sDQoJCQl0YWdzOiB7DQoJCQkJJ2luaXRpYWxpemluZyc6IFsgJ2J1c3knIF0sDQoJCQkJJ2FuaW1hdGluZyc6IFsgJ2J1c3knIF0sDQoJCQkJJ2RyYWdnaW5nJzogWyAnaW50ZXJhY3RpbmcnIF0NCgkJCX0NCgkJfTsNCg0KCQkkLmVhY2goWyAnb25SZXNpemUnLCAnb25UaHJvdHRsZWRSZXNpemUnIF0sICQucHJveHkoZnVuY3Rpb24oaSwgaGFuZGxlcikgew0KCQkJdGhpcy5faGFuZGxlcnNbaGFuZGxlcl0gPSAkLnByb3h5KHRoaXNbaGFuZGxlcl0sIHRoaXMpOw0KCQl9LCB0aGlzKSk7DQoNCgkJJC5lYWNoKE93bC5QbHVnaW5zLCAkLnByb3h5KGZ1bmN0aW9uKGtleSwgcGx1Z2luKSB7DQoJCQl0aGlzLl9wbHVnaW5zW2tleS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIGtleS5zbGljZSgxKV0NCgkJCQk9IG5ldyBwbHVnaW4odGhpcyk7DQoJCX0sIHRoaXMpKTsNCg0KCQkkLmVhY2goT3dsLldvcmtlcnMsICQucHJveHkoZnVuY3Rpb24ocHJpb3JpdHksIHdvcmtlcikgew0KCQkJdGhpcy5fcGlwZS5wdXNoKHsNCgkJCQknZmlsdGVyJzogd29ya2VyLmZpbHRlciwNCgkJCQkncnVuJzogJC5wcm94eSh3b3JrZXIucnVuLCB0aGlzKQ0KCQkJfSk7DQoJCX0sIHRoaXMpKTsNCg0KCQl0aGlzLnNldHVwKCk7DQoJCXRoaXMuaW5pdGlhbGl6ZSgpOw0KCX0NCg0KCS8qKg0KCSAqIERlZmF1bHQgb3B0aW9ucyBmb3IgdGhlIGNhcm91c2VsLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglPd2wuRGVmYXVsdHMgPSB7DQoJCWl0ZW1zOiAzLA0KCQlsb29wOiBmYWxzZSwNCgkJY2VudGVyOiBmYWxzZSwNCgkJcmV3aW5kOiBmYWxzZSwNCgkJY2hlY2tWaXNpYmlsaXR5OiB0cnVlLA0KDQoJCW1vdXNlRHJhZzogdHJ1ZSwNCgkJdG91Y2hEcmFnOiB0cnVlLA0KCQlwdWxsRHJhZzogdHJ1ZSwNCgkJZnJlZURyYWc6IGZhbHNlLA0KDQoJCW1hcmdpbjogMCwNCgkJc3RhZ2VQYWRkaW5nOiAwLA0KDQoJCW1lcmdlOiBmYWxzZSwNCgkJbWVyZ2VGaXQ6IHRydWUsDQoJCWF1dG9XaWR0aDogZmFsc2UsDQoNCgkJc3RhcnRQb3NpdGlvbjogMCwNCgkJcnRsOiBmYWxzZSwNCg0KCQlzbWFydFNwZWVkOiAyNTAsDQoJCWZsdWlkU3BlZWQ6IGZhbHNlLA0KCQlkcmFnRW5kU3BlZWQ6IGZhbHNlLA0KDQoJCXJlc3BvbnNpdmU6IHt9LA0KCQlyZXNwb25zaXZlUmVmcmVzaFJhdGU6IDIwMCwNCgkJcmVzcG9uc2l2ZUJhc2VFbGVtZW50OiB3aW5kb3csDQoNCgkJZmFsbGJhY2tFYXNpbmc6ICdzd2luZycsDQoJCXNsaWRlVHJhbnNpdGlvbjogJycsDQoNCgkJaW5mbzogZmFsc2UsDQoNCgkJbmVzdGVkSXRlbVNlbGVjdG9yOiBmYWxzZSwNCgkJaXRlbUVsZW1lbnQ6ICdkaXYnLA0KCQlzdGFnZUVsZW1lbnQ6ICdkaXYnLA0KDQoJCXJlZnJlc2hDbGFzczogJ293bC1yZWZyZXNoJywNCgkJbG9hZGVkQ2xhc3M6ICdvd2wtbG9hZGVkJywNCgkJbG9hZGluZ0NsYXNzOiAnb3dsLWxvYWRpbmcnLA0KCQlydGxDbGFzczogJ293bC1ydGwnLA0KCQlyZXNwb25zaXZlQ2xhc3M6ICdvd2wtcmVzcG9uc2l2ZScsDQoJCWRyYWdDbGFzczogJ293bC1kcmFnJywNCgkJaXRlbUNsYXNzOiAnb3dsLWl0ZW0nLA0KCQlzdGFnZUNsYXNzOiAnb3dsLXN0YWdlJywNCgkJc3RhZ2VPdXRlckNsYXNzOiAnb3dsLXN0YWdlLW91dGVyJywNCgkJZ3JhYkNsYXNzOiAnb3dsLWdyYWInDQoJfTsNCg0KCS8qKg0KCSAqIEVudW1lcmF0aW9uIGZvciB3aWR0aC4NCgkgKiBAcHVibGljDQoJICogQHJlYWRvbmx5DQoJICogQGVudW0ge1N0cmluZ30NCgkgKi8NCglPd2wuV2lkdGggPSB7DQoJCURlZmF1bHQ6ICdkZWZhdWx0JywNCgkJSW5uZXI6ICdpbm5lcicsDQoJCU91dGVyOiAnb3V0ZXInDQoJfTsNCg0KCS8qKg0KCSAqIEVudW1lcmF0aW9uIGZvciB0eXBlcy4NCgkgKiBAcHVibGljDQoJICogQHJlYWRvbmx5DQoJICogQGVudW0ge1N0cmluZ30NCgkgKi8NCglPd2wuVHlwZSA9IHsNCgkJRXZlbnQ6ICdldmVudCcsDQoJCVN0YXRlOiAnc3RhdGUnDQoJfTsNCg0KCS8qKg0KCSAqIENvbnRhaW5zIGFsbCByZWdpc3RlcmVkIHBsdWdpbnMuDQoJICogQHB1YmxpYw0KCSAqLw0KCU93bC5QbHVnaW5zID0ge307DQoNCgkvKioNCgkgKiBMaXN0IG9mIHdvcmtlcnMgaW52b2x2ZWQgaW4gdGhlIHVwZGF0ZSBwcm9jZXNzLg0KCSAqLw0KCU93bC5Xb3JrZXJzID0gWyB7DQoJCWZpbHRlcjogWyAnd2lkdGgnLCAnc2V0dGluZ3MnIF0sDQoJCXJ1bjogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLl93aWR0aCA9IHRoaXMuJGVsZW1lbnQud2lkdGgoKTsNCgkJfQ0KCX0sIHsNCgkJZmlsdGVyOiBbICd3aWR0aCcsICdpdGVtcycsICdzZXR0aW5ncycgXSwNCgkJcnVuOiBmdW5jdGlvbihjYWNoZSkgew0KCQkJY2FjaGUuY3VycmVudCA9IHRoaXMuX2l0ZW1zICYmIHRoaXMuX2l0ZW1zW3RoaXMucmVsYXRpdmUodGhpcy5fY3VycmVudCldOw0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ2l0ZW1zJywgJ3NldHRpbmdzJyBdLA0KCQlydW46IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy4kc3RhZ2UuY2hpbGRyZW4oJy5jbG9uZWQnKS5yZW1vdmUoKTsNCgkJfQ0KCX0sIHsNCgkJZmlsdGVyOiBbICd3aWR0aCcsICdpdGVtcycsICdzZXR0aW5ncycgXSwNCgkJcnVuOiBmdW5jdGlvbihjYWNoZSkgew0KCQkJdmFyIG1hcmdpbiA9IHRoaXMuc2V0dGluZ3MubWFyZ2luIHx8ICcnLA0KCQkJCWdyaWQgPSAhdGhpcy5zZXR0aW5ncy5hdXRvV2lkdGgsDQoJCQkJcnRsID0gdGhpcy5zZXR0aW5ncy5ydGwsDQoJCQkJY3NzID0gew0KCQkJCQknd2lkdGgnOiAnYXV0bycsDQoJCQkJCSdtYXJnaW4tbGVmdCc6IHJ0bCA/IG1hcmdpbiA6ICcnLA0KCQkJCQknbWFyZ2luLXJpZ2h0JzogcnRsID8gJycgOiBtYXJnaW4NCgkJCQl9Ow0KDQoJCQkhZ3JpZCAmJiB0aGlzLiRzdGFnZS5jaGlsZHJlbigpLmNzcyhjc3MpOw0KDQoJCQljYWNoZS5jc3MgPSBjc3M7DQoJCX0NCgl9LCB7DQoJCWZpbHRlcjogWyAnd2lkdGgnLCAnaXRlbXMnLCAnc2V0dGluZ3MnIF0sDQoJCXJ1bjogZnVuY3Rpb24oY2FjaGUpIHsNCgkJCXZhciB3aWR0aCA9ICh0aGlzLndpZHRoKCkgLyB0aGlzLnNldHRpbmdzLml0ZW1zKS50b0ZpeGVkKDMpIC0gdGhpcy5zZXR0aW5ncy5tYXJnaW4sDQoJCQkJbWVyZ2UgPSBudWxsLA0KCQkJCWl0ZXJhdG9yID0gdGhpcy5faXRlbXMubGVuZ3RoLA0KCQkJCWdyaWQgPSAhdGhpcy5zZXR0aW5ncy5hdXRvV2lkdGgsDQoJCQkJd2lkdGhzID0gW107DQoNCgkJCWNhY2hlLml0ZW1zID0gew0KCQkJCW1lcmdlOiBmYWxzZSwNCgkJCQl3aWR0aDogd2lkdGgNCgkJCX07DQoNCgkJCXdoaWxlIChpdGVyYXRvci0tKSB7DQoJCQkJbWVyZ2UgPSB0aGlzLl9tZXJnZXJzW2l0ZXJhdG9yXTsNCgkJCQltZXJnZSA9IHRoaXMuc2V0dGluZ3MubWVyZ2VGaXQgJiYgTWF0aC5taW4obWVyZ2UsIHRoaXMuc2V0dGluZ3MuaXRlbXMpIHx8IG1lcmdlOw0KDQoJCQkJY2FjaGUuaXRlbXMubWVyZ2UgPSBtZXJnZSA+IDEgfHwgY2FjaGUuaXRlbXMubWVyZ2U7DQoNCgkJCQl3aWR0aHNbaXRlcmF0b3JdID0gIWdyaWQgPyB0aGlzLl9pdGVtc1tpdGVyYXRvcl0ud2lkdGgoKSA6IHdpZHRoICogbWVyZ2U7DQoJCQl9DQoNCgkJCXRoaXMuX3dpZHRocyA9IHdpZHRoczsNCgkJfQ0KCX0sIHsNCgkJZmlsdGVyOiBbICdpdGVtcycsICdzZXR0aW5ncycgXSwNCgkJcnVuOiBmdW5jdGlvbigpIHsNCgkJCXZhciBjbG9uZXMgPSBbXSwNCgkJCQlpdGVtcyA9IHRoaXMuX2l0ZW1zLA0KCQkJCXNldHRpbmdzID0gdGhpcy5zZXR0aW5ncywNCgkJCQkvLyBUT0RPOiBTaG91bGQgYmUgY29tcHV0ZWQgZnJvbSBudW1iZXIgb2YgbWluIHdpZHRoIGl0ZW1zIGluIHN0YWdlDQoJCQkJdmlldyA9IE1hdGgubWF4KHNldHRpbmdzLml0ZW1zICogMiwgNCksDQoJCQkJc2l6ZSA9IE1hdGguY2VpbChpdGVtcy5sZW5ndGggLyAyKSAqIDIsDQoJCQkJcmVwZWF0ID0gc2V0dGluZ3MubG9vcCAmJiBpdGVtcy5sZW5ndGggPyBzZXR0aW5ncy5yZXdpbmQgPyB2aWV3IDogTWF0aC5tYXgodmlldywgc2l6ZSkgOiAwLA0KCQkJCWFwcGVuZCA9ICcnLA0KCQkJCXByZXBlbmQgPSAnJzsNCg0KCQkJcmVwZWF0IC89IDI7DQoNCgkJCXdoaWxlIChyZXBlYXQgPiAwKSB7DQoJCQkJLy8gU3dpdGNoIHRvIG9ubHkgdXNpbmcgYXBwZW5kZWQgY2xvbmVzDQoJCQkJY2xvbmVzLnB1c2godGhpcy5ub3JtYWxpemUoY2xvbmVzLmxlbmd0aCAvIDIsIHRydWUpKTsNCgkJCQlhcHBlbmQgPSBhcHBlbmQgKyBpdGVtc1tjbG9uZXNbY2xvbmVzLmxlbmd0aCAtIDFdXVswXS5vdXRlckhUTUw7DQoJCQkJY2xvbmVzLnB1c2godGhpcy5ub3JtYWxpemUoaXRlbXMubGVuZ3RoIC0gMSAtIChjbG9uZXMubGVuZ3RoIC0gMSkgLyAyLCB0cnVlKSk7DQoJCQkJcHJlcGVuZCA9IGl0ZW1zW2Nsb25lc1tjbG9uZXMubGVuZ3RoIC0gMV1dWzBdLm91dGVySFRNTCArIHByZXBlbmQ7DQoJCQkJcmVwZWF0IC09IDE7DQoJCQl9DQoNCgkJCXRoaXMuX2Nsb25lcyA9IGNsb25lczsNCg0KCQkJJChhcHBlbmQpLmFkZENsYXNzKCdjbG9uZWQnKS5hcHBlbmRUbyh0aGlzLiRzdGFnZSk7DQoJCQkkKHByZXBlbmQpLmFkZENsYXNzKCdjbG9uZWQnKS5wcmVwZW5kVG8odGhpcy4kc3RhZ2UpOw0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ3dpZHRoJywgJ2l0ZW1zJywgJ3NldHRpbmdzJyBdLA0KCQlydW46IGZ1bmN0aW9uKCkgew0KCQkJdmFyIHJ0bCA9IHRoaXMuc2V0dGluZ3MucnRsID8gMSA6IC0xLA0KCQkJCXNpemUgPSB0aGlzLl9jbG9uZXMubGVuZ3RoICsgdGhpcy5faXRlbXMubGVuZ3RoLA0KCQkJCWl0ZXJhdG9yID0gLTEsDQoJCQkJcHJldmlvdXMgPSAwLA0KCQkJCWN1cnJlbnQgPSAwLA0KCQkJCWNvb3JkaW5hdGVzID0gW107DQoNCgkJCXdoaWxlICgrK2l0ZXJhdG9yIDwgc2l6ZSkgew0KCQkJCXByZXZpb3VzID0gY29vcmRpbmF0ZXNbaXRlcmF0b3IgLSAxXSB8fCAwOw0KCQkJCWN1cnJlbnQgPSB0aGlzLl93aWR0aHNbdGhpcy5yZWxhdGl2ZShpdGVyYXRvcildICsgdGhpcy5zZXR0aW5ncy5tYXJnaW47DQoJCQkJY29vcmRpbmF0ZXMucHVzaChwcmV2aW91cyArIGN1cnJlbnQgKiBydGwpOw0KCQkJfQ0KDQoJCQl0aGlzLl9jb29yZGluYXRlcyA9IGNvb3JkaW5hdGVzOw0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ3dpZHRoJywgJ2l0ZW1zJywgJ3NldHRpbmdzJyBdLA0KCQlydW46IGZ1bmN0aW9uKCkgew0KCQkJdmFyIHBhZGRpbmcgPSB0aGlzLnNldHRpbmdzLnN0YWdlUGFkZGluZywNCgkJCQljb29yZGluYXRlcyA9IHRoaXMuX2Nvb3JkaW5hdGVzLA0KCQkJCWNzcyA9IHsNCgkJCQkJJ3dpZHRoJzogTWF0aC5jZWlsKE1hdGguYWJzKGNvb3JkaW5hdGVzW2Nvb3JkaW5hdGVzLmxlbmd0aCAtIDFdKSkgKyBwYWRkaW5nICogMiwNCgkJCQkJJ3BhZGRpbmctbGVmdCc6IHBhZGRpbmcgfHwgJycsDQoJCQkJCSdwYWRkaW5nLXJpZ2h0JzogcGFkZGluZyB8fCAnJw0KCQkJCX07DQoNCgkJCXRoaXMuJHN0YWdlLmNzcyhjc3MpOw0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ3dpZHRoJywgJ2l0ZW1zJywgJ3NldHRpbmdzJyBdLA0KCQlydW46IGZ1bmN0aW9uKGNhY2hlKSB7DQoJCQl2YXIgaXRlcmF0b3IgPSB0aGlzLl9jb29yZGluYXRlcy5sZW5ndGgsDQoJCQkJZ3JpZCA9ICF0aGlzLnNldHRpbmdzLmF1dG9XaWR0aCwNCgkJCQlpdGVtcyA9IHRoaXMuJHN0YWdlLmNoaWxkcmVuKCk7DQoNCgkJCWlmIChncmlkICYmIGNhY2hlLml0ZW1zLm1lcmdlKSB7DQoJCQkJd2hpbGUgKGl0ZXJhdG9yLS0pIHsNCgkJCQkJY2FjaGUuY3NzLndpZHRoID0gdGhpcy5fd2lkdGhzW3RoaXMucmVsYXRpdmUoaXRlcmF0b3IpXTsNCgkJCQkJaXRlbXMuZXEoaXRlcmF0b3IpLmNzcyhjYWNoZS5jc3MpOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAoZ3JpZCkgew0KCQkJCWNhY2hlLmNzcy53aWR0aCA9IGNhY2hlLml0ZW1zLndpZHRoOw0KCQkJCWl0ZW1zLmNzcyhjYWNoZS5jc3MpOw0KCQkJfQ0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ2l0ZW1zJyBdLA0KCQlydW46IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5fY29vcmRpbmF0ZXMubGVuZ3RoIDwgMSAmJiB0aGlzLiRzdGFnZS5yZW1vdmVBdHRyKCdzdHlsZScpOw0KCQl9DQoJfSwgew0KCQlmaWx0ZXI6IFsgJ3dpZHRoJywgJ2l0ZW1zJywgJ3NldHRpbmdzJyBdLA0KCQlydW46IGZ1bmN0aW9uKGNhY2hlKSB7DQoJCQljYWNoZS5jdXJyZW50ID0gY2FjaGUuY3VycmVudCA/IHRoaXMuJHN0YWdlLmNoaWxkcmVuKCkuaW5kZXgoY2FjaGUuY3VycmVudCkgOiAwOw0KCQkJY2FjaGUuY3VycmVudCA9IE1hdGgubWF4KHRoaXMubWluaW11bSgpLCBNYXRoLm1pbih0aGlzLm1heGltdW0oKSwgY2FjaGUuY3VycmVudCkpOw0KCQkJdGhpcy5yZXNldChjYWNoZS5jdXJyZW50KTsNCgkJfQ0KCX0sIHsNCgkJZmlsdGVyOiBbICdwb3NpdGlvbicgXSwNCgkJcnVuOiBmdW5jdGlvbigpIHsNCgkJCXRoaXMuYW5pbWF0ZSh0aGlzLmNvb3JkaW5hdGVzKHRoaXMuX2N1cnJlbnQpKTsNCgkJfQ0KCX0sIHsNCgkJZmlsdGVyOiBbICd3aWR0aCcsICdwb3NpdGlvbicsICdpdGVtcycsICdzZXR0aW5ncycgXSwNCgkJcnVuOiBmdW5jdGlvbigpIHsNCgkJCXZhciBydGwgPSB0aGlzLnNldHRpbmdzLnJ0bCA/IDEgOiAtMSwNCgkJCQlwYWRkaW5nID0gdGhpcy5zZXR0aW5ncy5zdGFnZVBhZGRpbmcgKiAyLA0KCQkJCWJlZ2luID0gdGhpcy5jb29yZGluYXRlcyh0aGlzLmN1cnJlbnQoKSkgKyBwYWRkaW5nLA0KCQkJCWVuZCA9IGJlZ2luICsgdGhpcy53aWR0aCgpICogcnRsLA0KCQkJCWlubmVyLCBvdXRlciwgbWF0Y2hlcyA9IFtdLCBpLCBuOw0KDQoJCQlmb3IgKGkgPSAwLCBuID0gdGhpcy5fY29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7DQoJCQkJaW5uZXIgPSB0aGlzLl9jb29yZGluYXRlc1tpIC0gMV0gfHwgMDsNCgkJCQlvdXRlciA9IE1hdGguYWJzKHRoaXMuX2Nvb3JkaW5hdGVzW2ldKSArIHBhZGRpbmcgKiBydGw7DQoNCgkJCQlpZiAoKHRoaXMub3AoaW5uZXIsICc8PScsIGJlZ2luKSAmJiAodGhpcy5vcChpbm5lciwgJz4nLCBlbmQpKSkNCgkJCQkJfHwgKHRoaXMub3Aob3V0ZXIsICc8JywgYmVnaW4pICYmIHRoaXMub3Aob3V0ZXIsICc+JywgZW5kKSkpIHsNCgkJCQkJbWF0Y2hlcy5wdXNoKGkpOw0KCQkJCX0NCgkJCX0NCg0KCQkJdGhpcy4kc3RhZ2UuY2hpbGRyZW4oJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQl0aGlzLiRzdGFnZS5jaGlsZHJlbignOmVxKCcgKyBtYXRjaGVzLmpvaW4oJyksIDplcSgnKSArICcpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KDQoJCQl0aGlzLiRzdGFnZS5jaGlsZHJlbignLmNlbnRlcicpLnJlbW92ZUNsYXNzKCdjZW50ZXInKTsNCgkJCWlmICh0aGlzLnNldHRpbmdzLmNlbnRlcikgew0KCQkJCXRoaXMuJHN0YWdlLmNoaWxkcmVuKCkuZXEodGhpcy5jdXJyZW50KCkpLmFkZENsYXNzKCdjZW50ZXInKTsNCgkJCX0NCgkJfQ0KCX0gXTsNCg0KCS8qKg0KCSAqIENyZWF0ZSB0aGUgc3RhZ2UgRE9NIGVsZW1lbnQNCgkgKi8NCglPd2wucHJvdG90eXBlLmluaXRpYWxpemVTdGFnZSA9IGZ1bmN0aW9uKCkgew0KCQl0aGlzLiRzdGFnZSA9IHRoaXMuJGVsZW1lbnQuZmluZCgnLicgKyB0aGlzLnNldHRpbmdzLnN0YWdlQ2xhc3MpOw0KDQoJCS8vIGlmIHRoZSBzdGFnZSBpcyBhbHJlYWR5IGluIHRoZSBET00sIGdyYWIgaXQgYW5kIHNraXAgc3RhZ2UgaW5pdGlhbGl6YXRpb24NCgkJaWYgKHRoaXMuJHN0YWdlLmxlbmd0aCkgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJdGhpcy4kZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubG9hZGluZ0NsYXNzKTsNCg0KCQkvLyBjcmVhdGUgc3RhZ2UNCgkJdGhpcy4kc3RhZ2UgPSAkKCc8JyArIHRoaXMuc2V0dGluZ3Muc3RhZ2VFbGVtZW50ICsgJz4nLCB7DQoJCQkiY2xhc3MiOiB0aGlzLnNldHRpbmdzLnN0YWdlQ2xhc3MNCgkJfSkud3JhcCggJCggJzxkaXYvPicsIHsNCgkJCSJjbGFzcyI6IHRoaXMuc2V0dGluZ3Muc3RhZ2VPdXRlckNsYXNzDQoJCX0pKTsNCg0KCQkvLyBhcHBlbmQgc3RhZ2UNCgkJdGhpcy4kZWxlbWVudC5hcHBlbmQodGhpcy4kc3RhZ2UucGFyZW50KCkpOw0KCX07DQoNCgkvKioNCgkgKiBDcmVhdGUgaXRlbSBET00gZWxlbWVudHMNCgkgKi8NCglPd2wucHJvdG90eXBlLmluaXRpYWxpemVJdGVtcyA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgJGl0ZW1zID0gdGhpcy4kZWxlbWVudC5maW5kKCcub3dsLWl0ZW0nKTsNCg0KCQkvLyBpZiB0aGUgaXRlbXMgYXJlIGFscmVhZHkgaW4gdGhlIERPTSwgZ3JhYiB0aGVtIGFuZCBza2lwIGl0ZW0gaW5pdGlhbGl6YXRpb24NCgkJaWYgKCRpdGVtcy5sZW5ndGgpIHsNCgkJCXRoaXMuX2l0ZW1zID0gJGl0ZW1zLmdldCgpLm1hcChmdW5jdGlvbihpdGVtKSB7DQoJCQkJcmV0dXJuICQoaXRlbSk7DQoJCQl9KTsNCg0KCQkJdGhpcy5fbWVyZ2VycyA9IHRoaXMuX2l0ZW1zLm1hcChmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gMTsNCgkJCX0pOw0KDQoJCQl0aGlzLnJlZnJlc2goKTsNCg0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJLy8gYXBwZW5kIGNvbnRlbnQNCgkJdGhpcy5yZXBsYWNlKHRoaXMuJGVsZW1lbnQuY2hpbGRyZW4oKS5ub3QodGhpcy4kc3RhZ2UucGFyZW50KCkpKTsNCg0KCQkvLyBjaGVjayB2aXNpYmlsaXR5DQoJCWlmICh0aGlzLmlzVmlzaWJsZSgpKSB7DQoJCQkvLyB1cGRhdGUgdmlldw0KCQkJdGhpcy5yZWZyZXNoKCk7DQoJCX0gZWxzZSB7DQoJCQkvLyBpbnZhbGlkYXRlIHdpZHRoDQoJCQl0aGlzLmludmFsaWRhdGUoJ3dpZHRoJyk7DQoJCX0NCg0KCQl0aGlzLiRlbGVtZW50DQoJCQkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmxvYWRpbmdDbGFzcykNCgkJCS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubG9hZGVkQ2xhc3MpOw0KCX07DQoNCgkvKioNCgkgKiBJbml0aWFsaXplcyB0aGUgY2Fyb3VzZWwuDQoJICogQHByb3RlY3RlZA0KCSAqLw0KCU93bC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkgew0KCQl0aGlzLmVudGVyKCdpbml0aWFsaXppbmcnKTsNCgkJdGhpcy50cmlnZ2VyKCdpbml0aWFsaXplJyk7DQoNCgkJdGhpcy4kZWxlbWVudC50b2dnbGVDbGFzcyh0aGlzLnNldHRpbmdzLnJ0bENsYXNzLCB0aGlzLnNldHRpbmdzLnJ0bCk7DQoNCgkJaWYgKHRoaXMuc2V0dGluZ3MuYXV0b1dpZHRoICYmICF0aGlzLmlzKCdwcmUtbG9hZGluZycpKSB7DQoJCQl2YXIgaW1ncywgbmVzdGVkU2VsZWN0b3IsIHdpZHRoOw0KCQkJaW1ncyA9IHRoaXMuJGVsZW1lbnQuZmluZCgnaW1nJyk7DQoJCQluZXN0ZWRTZWxlY3RvciA9IHRoaXMuc2V0dGluZ3MubmVzdGVkSXRlbVNlbGVjdG9yID8gJy4nICsgdGhpcy5zZXR0aW5ncy5uZXN0ZWRJdGVtU2VsZWN0b3IgOiB1bmRlZmluZWQ7DQoJCQl3aWR0aCA9IHRoaXMuJGVsZW1lbnQuY2hpbGRyZW4obmVzdGVkU2VsZWN0b3IpLndpZHRoKCk7DQoNCgkJCWlmIChpbWdzLmxlbmd0aCAmJiB3aWR0aCA8PSAwKSB7DQoJCQkJdGhpcy5wcmVsb2FkQXV0b1dpZHRoSW1hZ2VzKGltZ3MpOw0KCQkJfQ0KCQl9DQoNCgkJdGhpcy5pbml0aWFsaXplU3RhZ2UoKTsNCgkJdGhpcy5pbml0aWFsaXplSXRlbXMoKTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBoYW5kbGVycw0KCQl0aGlzLnJlZ2lzdGVyRXZlbnRIYW5kbGVycygpOw0KDQoJCXRoaXMubGVhdmUoJ2luaXRpYWxpemluZycpOw0KCQl0aGlzLnRyaWdnZXIoJ2luaXRpYWxpemVkJyk7DQoJfTsNCg0KCS8qKg0KCSAqIEByZXR1cm5zIHtCb29sZWFufSB2aXNpYmlsaXR5IG9mICRlbGVtZW50DQoJICogICAgICAgICAgICAgICAgICAgIGlmIHlvdSBrbm93IHRoZSBjYXJvdXNlbCB3aWxsIGFsd2F5cyBiZSB2aXNpYmxlIHlvdSBjYW4gc2V0IGBjaGVja1Zpc2liaWxpdHlgIHRvIGBmYWxzZWAgdG8NCgkgKiAgICAgICAgICAgICAgICAgICAgcHJldmVudCB0aGUgZXhwZW5zaXZlIGJyb3dzZXIgbGF5b3V0IGZvcmNlZCByZWZsb3cgdGhlICRlbGVtZW50LmlzKCc6dmlzaWJsZScpIGRvZXMNCgkgKi8NCglPd2wucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja1Zpc2liaWxpdHkNCgkJCT8gdGhpcy4kZWxlbWVudC5pcygnOnZpc2libGUnKQ0KCQkJOiB0cnVlOw0KCX07DQoNCgkvKioNCgkgKiBTZXR1cHMgdGhlIGN1cnJlbnQgc2V0dGluZ3MuDQoJICogQHRvZG8gUmVtb3ZlIHJlc3BvbnNpdmUgY2xhc3Nlcy4gV2h5IHNob3VsZCBhZGFwdGl2ZSBkZXNpZ25zIGJlIGJyb3VnaHQgaW50byBJRTg/DQoJICogQHRvZG8gU3VwcG9ydCBmb3IgbWVkaWEgcXVlcmllcyBieSB1c2luZyBgbWF0Y2hNZWRpYWAgd291bGQgYmUgbmljZS4NCgkgKiBAcHVibGljDQoJICovDQoJT3dsLnByb3RvdHlwZS5zZXR1cCA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgdmlld3BvcnQgPSB0aGlzLnZpZXdwb3J0KCksDQoJCQlvdmVyd3JpdGVzID0gdGhpcy5vcHRpb25zLnJlc3BvbnNpdmUsDQoJCQltYXRjaCA9IC0xLA0KCQkJc2V0dGluZ3MgPSBudWxsOw0KDQoJCWlmICghb3ZlcndyaXRlcykgew0KCQkJc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zKTsNCgkJfSBlbHNlIHsNCgkJCSQuZWFjaChvdmVyd3JpdGVzLCBmdW5jdGlvbihicmVha3BvaW50KSB7DQoJCQkJaWYgKGJyZWFrcG9pbnQgPD0gdmlld3BvcnQgJiYgYnJlYWtwb2ludCA+IG1hdGNoKSB7DQoJCQkJCW1hdGNoID0gTnVtYmVyKGJyZWFrcG9pbnQpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQlzZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIG92ZXJ3cml0ZXNbbWF0Y2hdKTsNCgkJCWlmICh0eXBlb2Ygc2V0dGluZ3Muc3RhZ2VQYWRkaW5nID09PSAnZnVuY3Rpb24nKSB7DQoJCQkJc2V0dGluZ3Muc3RhZ2VQYWRkaW5nID0gc2V0dGluZ3Muc3RhZ2VQYWRkaW5nKCk7DQoJCQl9DQoJCQlkZWxldGUgc2V0dGluZ3MucmVzcG9uc2l2ZTsNCg0KCQkJLy8gcmVzcG9uc2l2ZSBjbGFzcw0KCQkJaWYgKHNldHRpbmdzLnJlc3BvbnNpdmVDbGFzcykgew0KCQkJCXRoaXMuJGVsZW1lbnQuYXR0cignY2xhc3MnLA0KCQkJCQl0aGlzLiRlbGVtZW50LmF0dHIoJ2NsYXNzJykucmVwbGFjZShuZXcgUmVnRXhwKCcoJyArIHRoaXMub3B0aW9ucy5yZXNwb25zaXZlQ2xhc3MgKyAnLSlcXFMrXFxzJywgJ2cnKSwgJyQxJyArIG1hdGNoKQ0KCQkJCSk7DQoJCQl9DQoJCX0NCg0KCQl0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHsgcHJvcGVydHk6IHsgbmFtZTogJ3NldHRpbmdzJywgdmFsdWU6IHNldHRpbmdzIH0gfSk7DQoJCXRoaXMuX2JyZWFrcG9pbnQgPSBtYXRjaDsNCgkJdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzOw0KCQl0aGlzLmludmFsaWRhdGUoJ3NldHRpbmdzJyk7DQoJCXRoaXMudHJpZ2dlcignY2hhbmdlZCcsIHsgcHJvcGVydHk6IHsgbmFtZTogJ3NldHRpbmdzJywgdmFsdWU6IHRoaXMuc2V0dGluZ3MgfSB9KTsNCgl9Ow0KDQoJLyoqDQoJICogVXBkYXRlcyBvcHRpb24gbG9naWMgaWYgbmVjZXNzZXJ5Lg0KCSAqIEBwcm90ZWN0ZWQNCgkgKi8NCglPd2wucHJvdG90eXBlLm9wdGlvbnNMb2dpYyA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5zZXR0aW5ncy5hdXRvV2lkdGgpIHsNCgkJCXRoaXMuc2V0dGluZ3Muc3RhZ2VQYWRkaW5nID0gZmFsc2U7DQoJCQl0aGlzLnNldHRpbmdzLm1lcmdlID0gZmFsc2U7DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogUHJlcGFyZXMgYW4gaXRlbSBiZWZvcmUgYWRkLg0KCSAqIEB0b2RvIFJlbmFtZSBldmVudCBwYXJhbWV0ZXIgYGNvbnRlbnRgIHRvIGBpdGVtYC4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHJldHVybnMge2pRdWVyeXxIVE1MRWxlbWVudH0gLSBUaGUgaXRlbSBjb250YWluZXIuDQoJICovDQoJT3dsLnByb3RvdHlwZS5wcmVwYXJlID0gZnVuY3Rpb24oaXRlbSkgew0KCQl2YXIgZXZlbnQgPSB0aGlzLnRyaWdnZXIoJ3ByZXBhcmUnLCB7IGNvbnRlbnQ6IGl0ZW0gfSk7DQoNCgkJaWYgKCFldmVudC5kYXRhKSB7DQoJCQlldmVudC5kYXRhID0gJCgnPCcgKyB0aGlzLnNldHRpbmdzLml0ZW1FbGVtZW50ICsgJy8+JykNCgkJCQkuYWRkQ2xhc3ModGhpcy5vcHRpb25zLml0ZW1DbGFzcykuYXBwZW5kKGl0ZW0pDQoJCX0NCg0KCQl0aGlzLnRyaWdnZXIoJ3ByZXBhcmVkJywgeyBjb250ZW50OiBldmVudC5kYXRhIH0pOw0KDQoJCXJldHVybiBldmVudC5kYXRhOw0KCX07DQoNCgkvKioNCgkgKiBVcGRhdGVzIHRoZSB2aWV3Lg0KCSAqIEBwdWJsaWMNCgkgKi8NCglPd2wucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgaSA9IDAsDQoJCQluID0gdGhpcy5fcGlwZS5sZW5ndGgsDQoJCQlmaWx0ZXIgPSAkLnByb3h5KGZ1bmN0aW9uKHApIHsgcmV0dXJuIHRoaXNbcF0gfSwgdGhpcy5faW52YWxpZGF0ZWQpLA0KCQkJY2FjaGUgPSB7fTsNCg0KCQl3aGlsZSAoaSA8IG4pIHsNCgkJCWlmICh0aGlzLl9pbnZhbGlkYXRlZC5hbGwgfHwgJC5ncmVwKHRoaXMuX3BpcGVbaV0uZmlsdGVyLCBmaWx0ZXIpLmxlbmd0aCA+IDApIHsNCgkJCQl0aGlzLl9waXBlW2ldLnJ1bihjYWNoZSk7DQoJCQl9DQoJCQlpKys7DQoJCX0NCg0KCQl0aGlzLl9pbnZhbGlkYXRlZCA9IHt9Ow0KDQoJCSF0aGlzLmlzKCd2YWxpZCcpICYmIHRoaXMuZW50ZXIoJ3ZhbGlkJyk7DQoJfTsNCg0KCS8qKg0KCSAqIEdldHMgdGhlIHdpZHRoIG9mIHRoZSB2aWV3Lg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge093bC5XaWR0aH0gW2RpbWVuc2lvbj1Pd2wuV2lkdGguRGVmYXVsdF0gLSBUaGUgZGltZW5zaW9uIHRvIHJldHVybi4NCgkgKiBAcmV0dXJucyB7TnVtYmVyfSAtIFRoZSB3aWR0aCBvZiB0aGUgdmlldyBpbiBwaXhlbC4NCgkgKi8NCglPd2wucHJvdG90eXBlLndpZHRoID0gZnVuY3Rpb24oZGltZW5zaW9uKSB7DQoJCWRpbWVuc2lvbiA9IGRpbWVuc2lvbiB8fCBPd2wuV2lkdGguRGVmYXVsdDsNCgkJc3dpdGNoIChkaW1lbnNpb24pIHsNCgkJCWNhc2UgT3dsLldpZHRoLklubmVyOg0KCQkJY2FzZSBPd2wuV2lkdGguT3V0ZXI6DQoJCQkJcmV0dXJuIHRoaXMuX3dpZHRoOw0KCQkJZGVmYXVsdDoNCgkJCQlyZXR1cm4gdGhpcy5fd2lkdGggLSB0aGlzLnNldHRpbmdzLnN0YWdlUGFkZGluZyAqIDIgKyB0aGlzLnNldHRpbmdzLm1hcmdpbjsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBSZWZyZXNoZXMgdGhlIGNhcm91c2VsIHByaW1hcmlseSBmb3IgYWRhcHRpdmUgcHVycG9zZXMuDQoJICogQHB1YmxpYw0KCSAqLw0KCU93bC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uKCkgew0KCQl0aGlzLmVudGVyKCdyZWZyZXNoaW5nJyk7DQoJCXRoaXMudHJpZ2dlcigncmVmcmVzaCcpOw0KDQoJCXRoaXMuc2V0dXAoKTsNCg0KCQl0aGlzLm9wdGlvbnNMb2dpYygpOw0KDQoJCXRoaXMuJGVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLnJlZnJlc2hDbGFzcyk7DQoNCgkJdGhpcy51cGRhdGUoKTsNCg0KCQl0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5yZWZyZXNoQ2xhc3MpOw0KDQoJCXRoaXMubGVhdmUoJ3JlZnJlc2hpbmcnKTsNCgkJdGhpcy50cmlnZ2VyKCdyZWZyZXNoZWQnKTsNCgl9Ow0KDQoJLyoqDQoJICogQ2hlY2tzIHdpbmRvdyBgcmVzaXplYCBldmVudC4NCgkgKiBAcHJvdGVjdGVkDQoJICovDQoJT3dsLnByb3RvdHlwZS5vblRocm90dGxlZFJlc2l6ZSA9IGZ1bmN0aW9uKCkgew0KCQl3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMucmVzaXplVGltZXIpOw0KCQl0aGlzLnJlc2l6ZVRpbWVyID0gd2luZG93LnNldFRpbWVvdXQodGhpcy5faGFuZGxlcnMub25SZXNpemUsIHRoaXMuc2V0dGluZ3MucmVzcG9uc2l2ZVJlZnJlc2hSYXRlKTsNCgl9Ow0KDQoJLyoqDQoJICogQ2hlY2tzIHdpbmRvdyBgcmVzaXplYCBldmVudC4NCgkgKiBAcHJvdGVjdGVkDQoJICovDQoJT3dsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uKCkgew0KCQlpZiAoIXRoaXMuX2l0ZW1zLmxlbmd0aCkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoNCgkJaWYgKHRoaXMuX3dpZHRoID09PSB0aGlzLiRlbGVtZW50LndpZHRoKCkpIHsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCWlmICghdGhpcy5pc1Zpc2libGUoKSkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoNCgkJdGhpcy5lbnRlcigncmVzaXppbmcnKTsNCg0KCQlpZiAodGhpcy50cmlnZ2VyKCdyZXNpemUnKS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgew0KCQkJdGhpcy5sZWF2ZSgncmVzaXppbmcnKTsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCXRoaXMuaW52YWxpZGF0ZSgnd2lkdGgnKTsNCg0KCQl0aGlzLnJlZnJlc2goKTsNCg0KCQl0aGlzLmxlYXZlKCdyZXNpemluZycpOw0KCQl0aGlzLnRyaWdnZXIoJ3Jlc2l6ZWQnKTsNCgl9Ow0KDQoJLyoqDQoJICogUmVnaXN0ZXJzIGV2ZW50IGhhbmRsZXJzLg0KCSAqIEB0b2RvIENoZWNrIGBtc1BvaW50ZXJFbmFibGVkYA0KCSAqIEB0b2RvICMyNjENCgkgKiBAcHJvdGVjdGVkDQoJICovDQoJT3dsLnByb3RvdHlwZS5yZWdpc3RlckV2ZW50SGFuZGxlcnMgPSBmdW5jdGlvbigpIHsNCgkJaWYgKCQuc3VwcG9ydC50cmFuc2l0aW9uKSB7DQoJCQl0aGlzLiRzdGFnZS5vbigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQgKyAnLm93bC5jb3JlJywgJC5wcm94eSh0aGlzLm9uVHJhbnNpdGlvbkVuZCwgdGhpcykpOw0KCQl9DQoNCgkJaWYgKHRoaXMuc2V0dGluZ3MucmVzcG9uc2l2ZSAhPT0gZmFsc2UpIHsNCgkJCXRoaXMub24od2luZG93LCAncmVzaXplJywgdGhpcy5faGFuZGxlcnMub25UaHJvdHRsZWRSZXNpemUpOw0KCQl9DQoNCgkJaWYgKHRoaXMuc2V0dGluZ3MubW91c2VEcmFnKSB7DQoJCQl0aGlzLiRlbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5kcmFnQ2xhc3MpOw0KCQkJdGhpcy4kc3RhZ2Uub24oJ21vdXNlZG93bi5vd2wuY29yZScsICQucHJveHkodGhpcy5vbkRyYWdTdGFydCwgdGhpcykpOw0KCQkJdGhpcy4kc3RhZ2Uub24oJ2RyYWdzdGFydC5vd2wuY29yZSBzZWxlY3RzdGFydC5vd2wuY29yZScsIGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2UgfSk7DQoJCX0NCg0KCQlpZiAodGhpcy5zZXR0aW5ncy50b3VjaERyYWcpew0KCQkJdGhpcy4kc3RhZ2Uub24oJ3RvdWNoc3RhcnQub3dsLmNvcmUnLCAkLnByb3h5KHRoaXMub25EcmFnU3RhcnQsIHRoaXMpKTsNCgkJCXRoaXMuJHN0YWdlLm9uKCd0b3VjaGNhbmNlbC5vd2wuY29yZScsICQucHJveHkodGhpcy5vbkRyYWdFbmQsIHRoaXMpKTsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBIYW5kbGVzIGB0b3VjaHN0YXJ0YCBhbmQgYG1vdXNlZG93bmAgZXZlbnRzLg0KCSAqIEB0b2RvIEhvcml6b250YWwgc3dpcGUgdGhyZXNob2xkIGFzIG9wdGlvbg0KCSAqIEB0b2RvICMyNjENCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQgLSBUaGUgZXZlbnQgYXJndW1lbnRzLg0KCSAqLw0KCU93bC5wcm90b3R5cGUub25EcmFnU3RhcnQgPSBmdW5jdGlvbihldmVudCkgew0KCQl2YXIgc3RhZ2UgPSBudWxsOw0KDQoJCWlmIChldmVudC53aGljaCA9PT0gMykgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJaWYgKCQuc3VwcG9ydC50cmFuc2Zvcm0pIHsNCgkJCXN0YWdlID0gdGhpcy4kc3RhZ2UuY3NzKCd0cmFuc2Zvcm0nKS5yZXBsYWNlKC8uKlwofFwpfCAvZywgJycpLnNwbGl0KCcsJyk7DQoJCQlzdGFnZSA9IHsNCgkJCQl4OiBzdGFnZVtzdGFnZS5sZW5ndGggPT09IDE2ID8gMTIgOiA0XSwNCgkJCQl5OiBzdGFnZVtzdGFnZS5sZW5ndGggPT09IDE2ID8gMTMgOiA1XQ0KCQkJfTsNCgkJfSBlbHNlIHsNCgkJCXN0YWdlID0gdGhpcy4kc3RhZ2UucG9zaXRpb24oKTsNCgkJCXN0YWdlID0gew0KCQkJCXg6IHRoaXMuc2V0dGluZ3MucnRsID8NCgkJCQkJc3RhZ2UubGVmdCArIHRoaXMuJHN0YWdlLndpZHRoKCkgLSB0aGlzLndpZHRoKCkgKyB0aGlzLnNldHRpbmdzLm1hcmdpbiA6DQoJCQkJCXN0YWdlLmxlZnQsDQoJCQkJeTogc3RhZ2UudG9wDQoJCQl9Ow0KCQl9DQoNCgkJaWYgKHRoaXMuaXMoJ2FuaW1hdGluZycpKSB7DQoJCQkkLnN1cHBvcnQudHJhbnNmb3JtID8gdGhpcy5hbmltYXRlKHN0YWdlLngpIDogdGhpcy4kc3RhZ2Uuc3RvcCgpDQoJCQl0aGlzLmludmFsaWRhdGUoJ3Bvc2l0aW9uJyk7DQoJCX0NCg0KCQl0aGlzLiRlbGVtZW50LnRvZ2dsZUNsYXNzKHRoaXMub3B0aW9ucy5ncmFiQ2xhc3MsIGV2ZW50LnR5cGUgPT09ICdtb3VzZWRvd24nKTsNCg0KCQl0aGlzLnNwZWVkKDApOw0KDQoJCXRoaXMuX2RyYWcudGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KCQl0aGlzLl9kcmFnLnRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KTsNCgkJdGhpcy5fZHJhZy5zdGFnZS5zdGFydCA9IHN0YWdlOw0KCQl0aGlzLl9kcmFnLnN0YWdlLmN1cnJlbnQgPSBzdGFnZTsNCgkJdGhpcy5fZHJhZy5wb2ludGVyID0gdGhpcy5wb2ludGVyKGV2ZW50KTsNCg0KCQkkKGRvY3VtZW50KS5vbignbW91c2V1cC5vd2wuY29yZSB0b3VjaGVuZC5vd2wuY29yZScsICQucHJveHkodGhpcy5vbkRyYWdFbmQsIHRoaXMpKTsNCg0KCQkkKGRvY3VtZW50KS5vbmUoJ21vdXNlbW92ZS5vd2wuY29yZSB0b3VjaG1vdmUub3dsLmNvcmUnLCAkLnByb3h5KGZ1bmN0aW9uKGV2ZW50KSB7DQoJCQl2YXIgZGVsdGEgPSB0aGlzLmRpZmZlcmVuY2UodGhpcy5fZHJhZy5wb2ludGVyLCB0aGlzLnBvaW50ZXIoZXZlbnQpKTsNCg0KCQkJJChkb2N1bWVudCkub24oJ21vdXNlbW92ZS5vd2wuY29yZSB0b3VjaG1vdmUub3dsLmNvcmUnLCAkLnByb3h5KHRoaXMub25EcmFnTW92ZSwgdGhpcykpOw0KDQoJCQlpZiAoTWF0aC5hYnMoZGVsdGEueCkgPCBNYXRoLmFicyhkZWx0YS55KSAmJiB0aGlzLmlzKCd2YWxpZCcpKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCQl0aGlzLmVudGVyKCdkcmFnZ2luZycpOw0KCQkJdGhpcy50cmlnZ2VyKCdkcmFnJyk7DQoJCX0sIHRoaXMpKTsNCgl9Ow0KDQoJLyoqDQoJICogSGFuZGxlcyB0aGUgYHRvdWNobW92ZWAgYW5kIGBtb3VzZW1vdmVgIGV2ZW50cy4NCgkgKiBAdG9kbyAjMjYxDQoJICogQHByb3RlY3RlZA0KCSAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IC0gVGhlIGV2ZW50IGFyZ3VtZW50cy4NCgkgKi8NCglPd2wucHJvdG90eXBlLm9uRHJhZ01vdmUgPSBmdW5jdGlvbihldmVudCkgew0KCQl2YXIgbWluaW11bSA9IG51bGwsDQoJCQltYXhpbXVtID0gbnVsbCwNCgkJCXB1bGwgPSBudWxsLA0KCQkJZGVsdGEgPSB0aGlzLmRpZmZlcmVuY2UodGhpcy5fZHJhZy5wb2ludGVyLCB0aGlzLnBvaW50ZXIoZXZlbnQpKSwNCgkJCXN0YWdlID0gdGhpcy5kaWZmZXJlbmNlKHRoaXMuX2RyYWcuc3RhZ2Uuc3RhcnQsIGRlbHRhKTsNCg0KCQlpZiAoIXRoaXMuaXMoJ2RyYWdnaW5nJykpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCgkJaWYgKHRoaXMuc2V0dGluZ3MubG9vcCkgew0KCQkJbWluaW11bSA9IHRoaXMuY29vcmRpbmF0ZXModGhpcy5taW5pbXVtKCkpOw0KCQkJbWF4aW11bSA9IHRoaXMuY29vcmRpbmF0ZXModGhpcy5tYXhpbXVtKCkgKyAxKSAtIG1pbmltdW07DQoJCQlzdGFnZS54ID0gKCgoc3RhZ2UueCAtIG1pbmltdW0pICUgbWF4aW11bSArIG1heGltdW0pICUgbWF4aW11bSkgKyBtaW5pbXVtOw0KCQl9IGVsc2Ugew0KCQkJbWluaW11bSA9IHRoaXMuc2V0dGluZ3MucnRsID8gdGhpcy5jb29yZGluYXRlcyh0aGlzLm1heGltdW0oKSkgOiB0aGlzLmNvb3JkaW5hdGVzKHRoaXMubWluaW11bSgpKTsNCgkJCW1heGltdW0gPSB0aGlzLnNldHRpbmdzLnJ0bCA/IHRoaXMuY29vcmRpbmF0ZXModGhpcy5taW5pbXVtKCkpIDogdGhpcy5jb29yZGluYXRlcyh0aGlzLm1heGltdW0oKSk7DQoJCQlwdWxsID0gdGhpcy5zZXR0aW5ncy5wdWxsRHJhZyA/IC0xICogZGVsdGEueCAvIDUgOiAwOw0KCQkJc3RhZ2UueCA9IE1hdGgubWF4KE1hdGgubWluKHN0YWdlLngsIG1pbmltdW0gKyBwdWxsKSwgbWF4aW11bSArIHB1bGwpOw0KCQl9DQoNCgkJdGhpcy5fZHJhZy5zdGFnZS5jdXJyZW50ID0gc3RhZ2U7DQoNCgkJdGhpcy5hbmltYXRlKHN0YWdlLngpOw0KCX07DQoNCgkvKioNCgkgKiBIYW5kbGVzIHRoZSBgdG91Y2hlbmRgIGFuZCBgbW91c2V1cGAgZXZlbnRzLg0KCSAqIEB0b2RvICMyNjENCgkgKiBAdG9kbyBUaHJlc2hvbGQgZm9yIGNsaWNrIGV2ZW50DQoJICogQHByb3RlY3RlZA0KCSAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IC0gVGhlIGV2ZW50IGFyZ3VtZW50cy4NCgkgKi8NCglPd2wucHJvdG90eXBlLm9uRHJhZ0VuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCXZhciBkZWx0YSA9IHRoaXMuZGlmZmVyZW5jZSh0aGlzLl9kcmFnLnBvaW50ZXIsIHRoaXMucG9pbnRlcihldmVudCkpLA0KCQkJc3RhZ2UgPSB0aGlzLl9kcmFnLnN0YWdlLmN1cnJlbnQsDQoJCQlkaXJlY3Rpb24gPSBkZWx0YS54ID4gMCBeIHRoaXMuc2V0dGluZ3MucnRsID8gJ2xlZnQnIDogJ3JpZ2h0JzsNCg0KCQkkKGRvY3VtZW50KS5vZmYoJy5vd2wuY29yZScpOw0KDQoJCXRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmdyYWJDbGFzcyk7DQoNCgkJaWYgKGRlbHRhLnggIT09IDAgJiYgdGhpcy5pcygnZHJhZ2dpbmcnKSB8fCAhdGhpcy5pcygndmFsaWQnKSkgew0KCQkJdGhpcy5zcGVlZCh0aGlzLnNldHRpbmdzLmRyYWdFbmRTcGVlZCB8fCB0aGlzLnNldHRpbmdzLnNtYXJ0U3BlZWQpOw0KCQkJdGhpcy5jdXJyZW50KHRoaXMuY2xvc2VzdChzdGFnZS54LCBkZWx0YS54ICE9PSAwID8gZGlyZWN0aW9uIDogdGhpcy5fZHJhZy5kaXJlY3Rpb24pKTsNCgkJCXRoaXMuaW52YWxpZGF0ZSgncG9zaXRpb24nKTsNCgkJCXRoaXMudXBkYXRlKCk7DQoNCgkJCXRoaXMuX2RyYWcuZGlyZWN0aW9uID0gZGlyZWN0aW9uOw0KDQoJCQlpZiAoTWF0aC5hYnMoZGVsdGEueCkgPiAzIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5fZHJhZy50aW1lID4gMzAwKSB7DQoJCQkJdGhpcy5fZHJhZy50YXJnZXQub25lKCdjbGljay5vd2wuY29yZScsIGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH0pOw0KCQkJfQ0KCQl9DQoNCgkJaWYgKCF0aGlzLmlzKCdkcmFnZ2luZycpKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl0aGlzLmxlYXZlKCdkcmFnZ2luZycpOw0KCQl0aGlzLnRyaWdnZXIoJ2RyYWdnZWQnKTsNCgl9Ow0KDQoJLyoqDQoJICogR2V0cyBhYnNvbHV0ZSBwb3NpdGlvbiBvZiB0aGUgY2xvc2VzdCBpdGVtIGZvciBhIGNvb3JkaW5hdGUuDQoJICogQHRvZG8gU2V0dGluZyBgZnJlZURyYWdgIG1ha2VzIGBjbG9zZXN0YCBub3QgcmV1c2FibGUuIFNlZSAjMTY1Lg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge051bWJlcn0gY29vcmRpbmF0ZSAtIFRoZSBjb29yZGluYXRlIGluIHBpeGVsLg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBkaXJlY3Rpb24gLSBUaGUgZGlyZWN0aW9uIHRvIGNoZWNrIGZvciB0aGUgY2xvc2VzdCBpdGVtLiBFdGhlciBgbGVmdGAgb3IgYHJpZ2h0YC4NCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IC0gVGhlIGFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSBjbG9zZXN0IGl0ZW0uDQoJICovDQoJT3dsLnByb3RvdHlwZS5jbG9zZXN0ID0gZnVuY3Rpb24oY29vcmRpbmF0ZSwgZGlyZWN0aW9uKSB7DQoJCXZhciBwb3NpdGlvbiA9IC0xLA0KCQkJcHVsbCA9IDMwLA0KCQkJd2lkdGggPSB0aGlzLndpZHRoKCksDQoJCQljb29yZGluYXRlcyA9IHRoaXMuY29vcmRpbmF0ZXMoKTsNCg0KCQlpZiAoIXRoaXMuc2V0dGluZ3MuZnJlZURyYWcpIHsNCgkJCS8vIGNoZWNrIGNsb3Nlc3QgaXRlbQ0KCQkJJC5lYWNoKGNvb3JkaW5hdGVzLCAkLnByb3h5KGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkgew0KCQkJCS8vIG9uIGEgbGVmdCBwdWxsLCBjaGVjayBvbiBjdXJyZW50IGluZGV4DQoJCQkJaWYgKGRpcmVjdGlvbiA9PT0gJ2xlZnQnICYmIGNvb3JkaW5hdGUgPiB2YWx1ZSAtIHB1bGwgJiYgY29vcmRpbmF0ZSA8IHZhbHVlICsgcHVsbCkgew0KCQkJCQlwb3NpdGlvbiA9IGluZGV4Ow0KCQkJCS8vIG9uIGEgcmlnaHQgcHVsbCwgY2hlY2sgb24gcHJldmlvdXMgaW5kZXgNCgkJCQkvLyB0byBkbyBzbywgc3VidHJhY3Qgd2lkdGggZnJvbSB2YWx1ZSBhbmQgc2V0IHBvc2l0aW9uID0gaW5kZXggKyAxDQoJCQkJfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgY29vcmRpbmF0ZSA+IHZhbHVlIC0gd2lkdGggLSBwdWxsICYmIGNvb3JkaW5hdGUgPCB2YWx1ZSAtIHdpZHRoICsgcHVsbCkgew0KCQkJCQlwb3NpdGlvbiA9IGluZGV4ICsgMTsNCgkJCQl9IGVsc2UgaWYgKHRoaXMub3AoY29vcmRpbmF0ZSwgJzwnLCB2YWx1ZSkNCgkJCQkJJiYgdGhpcy5vcChjb29yZGluYXRlLCAnPicsIGNvb3JkaW5hdGVzW2luZGV4ICsgMV0gIT09IHVuZGVmaW5lZCA/IGNvb3JkaW5hdGVzW2luZGV4ICsgMV0gOiB2YWx1ZSAtIHdpZHRoKSkgew0KCQkJCQlwb3NpdGlvbiA9IGRpcmVjdGlvbiA9PT0gJ2xlZnQnID8gaW5kZXggKyAxIDogaW5kZXg7DQoJCQkJfQ0KCQkJCXJldHVybiBwb3NpdGlvbiA9PT0gLTE7DQoJCQl9LCB0aGlzKSk7DQoJCX0NCg0KCQlpZiAoIXRoaXMuc2V0dGluZ3MubG9vcCkgew0KCQkJLy8gbm9uIGxvb3AgYm91bmRyaWVzDQoJCQlpZiAodGhpcy5vcChjb29yZGluYXRlLCAnPicsIGNvb3JkaW5hdGVzW3RoaXMubWluaW11bSgpXSkpIHsNCgkJCQlwb3NpdGlvbiA9IGNvb3JkaW5hdGUgPSB0aGlzLm1pbmltdW0oKTsNCgkJCX0gZWxzZSBpZiAodGhpcy5vcChjb29yZGluYXRlLCAnPCcsIGNvb3JkaW5hdGVzW3RoaXMubWF4aW11bSgpXSkpIHsNCgkJCQlwb3NpdGlvbiA9IGNvb3JkaW5hdGUgPSB0aGlzLm1heGltdW0oKTsNCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBwb3NpdGlvbjsNCgl9Ow0KDQoJLyoqDQoJICogQW5pbWF0ZXMgdGhlIHN0YWdlLg0KCSAqIEB0b2RvICMyNzANCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IGNvb3JkaW5hdGUgLSBUaGUgY29vcmRpbmF0ZSBpbiBwaXhlbHMuDQoJICovDQoJT3dsLnByb3RvdHlwZS5hbmltYXRlID0gZnVuY3Rpb24oY29vcmRpbmF0ZSkgew0KCQl2YXIgYW5pbWF0ZSA9IHRoaXMuc3BlZWQoKSA+IDA7DQoNCgkJdGhpcy5pcygnYW5pbWF0aW5nJykgJiYgdGhpcy5vblRyYW5zaXRpb25FbmQoKTsNCg0KCQlpZiAoYW5pbWF0ZSkgew0KCQkJdGhpcy5lbnRlcignYW5pbWF0aW5nJyk7DQoJCQl0aGlzLnRyaWdnZXIoJ3RyYW5zbGF0ZScpOw0KCQl9DQoNCgkJaWYgKCQuc3VwcG9ydC50cmFuc2Zvcm0zZCAmJiAkLnN1cHBvcnQudHJhbnNpdGlvbikgew0KCQkJdGhpcy4kc3RhZ2UuY3NzKHsNCgkJCQl0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgnICsgY29vcmRpbmF0ZSArICdweCwwcHgsMHB4KScsDQoJCQkJdHJhbnNpdGlvbjogKHRoaXMuc3BlZWQoKSAvIDEwMDApICsgJ3MnICsgKA0KCQkJCQl0aGlzLnNldHRpbmdzLnNsaWRlVHJhbnNpdGlvbiA/ICcgJyArIHRoaXMuc2V0dGluZ3Muc2xpZGVUcmFuc2l0aW9uIDogJycNCgkJCQkpDQoJCQl9KTsNCgkJfSBlbHNlIGlmIChhbmltYXRlKSB7DQoJCQl0aGlzLiRzdGFnZS5hbmltYXRlKHsNCgkJCQlsZWZ0OiBjb29yZGluYXRlICsgJ3B4Jw0KCQkJfSwgdGhpcy5zcGVlZCgpLCB0aGlzLnNldHRpbmdzLmZhbGxiYWNrRWFzaW5nLCAkLnByb3h5KHRoaXMub25UcmFuc2l0aW9uRW5kLCB0aGlzKSk7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLiRzdGFnZS5jc3Moew0KCQkJCWxlZnQ6IGNvb3JkaW5hdGUgKyAncHgnDQoJCQl9KTsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBDaGVja3Mgd2hldGhlciB0aGUgY2Fyb3VzZWwgaXMgaW4gYSBzcGVjaWZpYyBzdGF0ZSBvciBub3QuDQoJICogQHBhcmFtIHtTdHJpbmd9IHN0YXRlIC0gVGhlIHN0YXRlIHRvIGNoZWNrLg0KCSAqIEByZXR1cm5zIHtCb29sZWFufSAtIFRoZSBmbGFnIHdoaWNoIGluZGljYXRlcyBpZiB0aGUgY2Fyb3VzZWwgaXMgYnVzeS4NCgkgKi8NCglPd2wucHJvdG90eXBlLmlzID0gZnVuY3Rpb24oc3RhdGUpIHsNCgkJcmV0dXJuIHRoaXMuX3N0YXRlcy5jdXJyZW50W3N0YXRlXSAmJiB0aGlzLl9zdGF0ZXMuY3VycmVudFtzdGF0ZV0gPiAwOw0KCX07DQoNCgkvKioNCgkgKiBTZXRzIHRoZSBhYnNvbHV0ZSBwb3NpdGlvbiBvZiB0aGUgY3VycmVudCBpdGVtLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge051bWJlcn0gW3Bvc2l0aW9uXSAtIFRoZSBuZXcgYWJzb2x1dGUgcG9zaXRpb24gb3Igbm90aGluZyB0byBsZWF2ZSBpdCB1bmNoYW5nZWQuDQoJICogQHJldHVybnMge051bWJlcn0gLSBUaGUgYWJzb2x1dGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgaXRlbS4NCgkgKi8NCglPd2wucHJvdG90eXBlLmN1cnJlbnQgPSBmdW5jdGlvbihwb3NpdGlvbikgew0KCQlpZiAocG9zaXRpb24gPT09IHVuZGVmaW5lZCkgew0KCQkJcmV0dXJuIHRoaXMuX2N1cnJlbnQ7DQoJCX0NCg0KCQlpZiAodGhpcy5faXRlbXMubGVuZ3RoID09PSAwKSB7DQoJCQlyZXR1cm4gdW5kZWZpbmVkOw0KCQl9DQoNCgkJcG9zaXRpb24gPSB0aGlzLm5vcm1hbGl6ZShwb3NpdGlvbik7DQoNCgkJaWYgKHRoaXMuX2N1cnJlbnQgIT09IHBvc2l0aW9uKSB7DQoJCQl2YXIgZXZlbnQgPSB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHsgcHJvcGVydHk6IHsgbmFtZTogJ3Bvc2l0aW9uJywgdmFsdWU6IHBvc2l0aW9uIH0gfSk7DQoNCgkJCWlmIChldmVudC5kYXRhICE9PSB1bmRlZmluZWQpIHsNCgkJCQlwb3NpdGlvbiA9IHRoaXMubm9ybWFsaXplKGV2ZW50LmRhdGEpOw0KCQkJfQ0KDQoJCQl0aGlzLl9jdXJyZW50ID0gcG9zaXRpb247DQoNCgkJCXRoaXMuaW52YWxpZGF0ZSgncG9zaXRpb24nKTsNCg0KCQkJdGhpcy50cmlnZ2VyKCdjaGFuZ2VkJywgeyBwcm9wZXJ0eTogeyBuYW1lOiAncG9zaXRpb24nLCB2YWx1ZTogdGhpcy5fY3VycmVudCB9IH0pOw0KCQl9DQoNCgkJcmV0dXJuIHRoaXMuX2N1cnJlbnQ7DQoJfTsNCg0KCS8qKg0KCSAqIEludmFsaWRhdGVzIHRoZSBnaXZlbiBwYXJ0IG9mIHRoZSB1cGRhdGUgcm91dGluZS4NCgkgKiBAcGFyYW0ge1N0cmluZ30gW3BhcnRdIC0gVGhlIHBhcnQgdG8gaW52YWxpZGF0ZS4NCgkgKiBAcmV0dXJucyB7QXJyYXkuPFN0cmluZz59IC0gVGhlIGludmFsaWRhdGVkIHBhcnRzLg0KCSAqLw0KCU93bC5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uKHBhcnQpIHsNCgkJaWYgKCQudHlwZShwYXJ0KSA9PT0gJ3N0cmluZycpIHsNCgkJCXRoaXMuX2ludmFsaWRhdGVkW3BhcnRdID0gdHJ1ZTsNCgkJCXRoaXMuaXMoJ3ZhbGlkJykgJiYgdGhpcy5sZWF2ZSgndmFsaWQnKTsNCgkJfQ0KCQlyZXR1cm4gJC5tYXAodGhpcy5faW52YWxpZGF0ZWQsIGZ1bmN0aW9uKHYsIGkpIHsgcmV0dXJuIGkgfSk7DQoJfTsNCg0KCS8qKg0KCSAqIFJlc2V0cyB0aGUgYWJzb2x1dGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgaXRlbS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uIC0gVGhlIGFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSBuZXcgaXRlbS4NCgkgKi8NCglPd2wucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24ocG9zaXRpb24pIHsNCgkJcG9zaXRpb24gPSB0aGlzLm5vcm1hbGl6ZShwb3NpdGlvbik7DQoNCgkJaWYgKHBvc2l0aW9uID09PSB1bmRlZmluZWQpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXRoaXMuX3NwZWVkID0gMDsNCgkJdGhpcy5fY3VycmVudCA9IHBvc2l0aW9uOw0KDQoJCXRoaXMuc3VwcHJlc3MoWyAndHJhbnNsYXRlJywgJ3RyYW5zbGF0ZWQnIF0pOw0KDQoJCXRoaXMuYW5pbWF0ZSh0aGlzLmNvb3JkaW5hdGVzKHBvc2l0aW9uKSk7DQoNCgkJdGhpcy5yZWxlYXNlKFsgJ3RyYW5zbGF0ZScsICd0cmFuc2xhdGVkJyBdKTsNCgl9Ow0KDQoJLyoqDQoJICogTm9ybWFsaXplcyBhbiBhYnNvbHV0ZSBvciBhIHJlbGF0aXZlIHBvc2l0aW9uIG9mIGFuIGl0ZW0uDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBwb3NpdGlvbiAtIFRoZSBhYnNvbHV0ZSBvciByZWxhdGl2ZSBwb3NpdGlvbiB0byBub3JtYWxpemUuDQoJICogQHBhcmFtIHtCb29sZWFufSBbcmVsYXRpdmU9ZmFsc2VdIC0gV2hldGhlciB0aGUgZ2l2ZW4gcG9zaXRpb24gaXMgcmVsYXRpdmUgb3Igbm90Lg0KCSAqIEByZXR1cm5zIHtOdW1iZXJ9IC0gVGhlIG5vcm1hbGl6ZWQgcG9zaXRpb24uDQoJICovDQoJT3dsLnByb3RvdHlwZS5ub3JtYWxpemUgPSBmdW5jdGlvbihwb3NpdGlvbiwgcmVsYXRpdmUpIHsNCgkJdmFyIG4gPSB0aGlzLl9pdGVtcy5sZW5ndGgsDQoJCQltID0gcmVsYXRpdmUgPyAwIDogdGhpcy5fY2xvbmVzLmxlbmd0aDsNCg0KCQlpZiAoIXRoaXMuaXNOdW1lcmljKHBvc2l0aW9uKSB8fCBuIDwgMSkgew0KCQkJcG9zaXRpb24gPSB1bmRlZmluZWQ7DQoJCX0gZWxzZSBpZiAocG9zaXRpb24gPCAwIHx8IHBvc2l0aW9uID49IG4gKyBtKSB7DQoJCQlwb3NpdGlvbiA9ICgocG9zaXRpb24gLSBtIC8gMikgJSBuICsgbikgJSBuICsgbSAvIDI7DQoJCX0NCg0KCQlyZXR1cm4gcG9zaXRpb247DQoJfTsNCg0KCS8qKg0KCSAqIENvbnZlcnRzIGFuIGFic29sdXRlIHBvc2l0aW9uIG9mIGFuIGl0ZW0gaW50byBhIHJlbGF0aXZlIG9uZS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uIC0gVGhlIGFic29sdXRlIHBvc2l0aW9uIHRvIGNvbnZlcnQuDQoJICogQHJldHVybnMge051bWJlcn0gLSBUaGUgY29udmVydGVkIHBvc2l0aW9uLg0KCSAqLw0KCU93bC5wcm90b3R5cGUucmVsYXRpdmUgPSBmdW5jdGlvbihwb3NpdGlvbikgew0KCQlwb3NpdGlvbiAtPSB0aGlzLl9jbG9uZXMubGVuZ3RoIC8gMjsNCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKHBvc2l0aW9uLCB0cnVlKTsNCgl9Ow0KDQoJLyoqDQoJICogR2V0cyB0aGUgbWF4aW11bSBwb3NpdGlvbiBmb3IgdGhlIGN1cnJlbnQgaXRlbS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtCb29sZWFufSBbcmVsYXRpdmU9ZmFsc2VdIC0gV2hldGhlciB0byByZXR1cm4gYW4gYWJzb2x1dGUgcG9zaXRpb24gb3IgYSByZWxhdGl2ZSBwb3NpdGlvbi4NCgkgKiBAcmV0dXJucyB7TnVtYmVyfQ0KCSAqLw0KCU93bC5wcm90b3R5cGUubWF4aW11bSA9IGZ1bmN0aW9uKHJlbGF0aXZlKSB7DQoJCXZhciBzZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3MsDQoJCQltYXhpbXVtID0gdGhpcy5fY29vcmRpbmF0ZXMubGVuZ3RoLA0KCQkJaXRlcmF0b3IsDQoJCQlyZWNpcHJvY2FsSXRlbXNXaWR0aCwNCgkJCWVsZW1lbnRXaWR0aDsNCg0KCQlpZiAoc2V0dGluZ3MubG9vcCkgew0KCQkJbWF4aW11bSA9IHRoaXMuX2Nsb25lcy5sZW5ndGggLyAyICsgdGhpcy5faXRlbXMubGVuZ3RoIC0gMTsNCgkJfSBlbHNlIGlmIChzZXR0aW5ncy5hdXRvV2lkdGggfHwgc2V0dGluZ3MubWVyZ2UpIHsNCgkJCWl0ZXJhdG9yID0gdGhpcy5faXRlbXMubGVuZ3RoOw0KCQkJaWYgKGl0ZXJhdG9yKSB7DQoJCQkJcmVjaXByb2NhbEl0ZW1zV2lkdGggPSB0aGlzLl9pdGVtc1stLWl0ZXJhdG9yXS53aWR0aCgpOw0KCQkJCWVsZW1lbnRXaWR0aCA9IHRoaXMuJGVsZW1lbnQud2lkdGgoKTsNCgkJCQl3aGlsZSAoaXRlcmF0b3ItLSkgew0KCQkJCQlyZWNpcHJvY2FsSXRlbXNXaWR0aCArPSB0aGlzLl9pdGVtc1tpdGVyYXRvcl0ud2lkdGgoKSArIHRoaXMuc2V0dGluZ3MubWFyZ2luOw0KCQkJCQlpZiAocmVjaXByb2NhbEl0ZW1zV2lkdGggPiBlbGVtZW50V2lkdGgpIHsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJbWF4aW11bSA9IGl0ZXJhdG9yICsgMTsNCgkJfSBlbHNlIGlmIChzZXR0aW5ncy5jZW50ZXIpIHsNCgkJCW1heGltdW0gPSB0aGlzLl9pdGVtcy5sZW5ndGggLSAxOw0KCQl9IGVsc2Ugew0KCQkJbWF4aW11bSA9IHRoaXMuX2l0ZW1zLmxlbmd0aCAtIHNldHRpbmdzLml0ZW1zOw0KCQl9DQoNCgkJaWYgKHJlbGF0aXZlKSB7DQoJCQltYXhpbXVtIC09IHRoaXMuX2Nsb25lcy5sZW5ndGggLyAyOw0KCQl9DQoNCgkJcmV0dXJuIE1hdGgubWF4KG1heGltdW0sIDApOw0KCX07DQoNCgkvKioNCgkgKiBHZXRzIHRoZSBtaW5pbXVtIHBvc2l0aW9uIGZvciB0aGUgY3VycmVudCBpdGVtLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge0Jvb2xlYW59IFtyZWxhdGl2ZT1mYWxzZV0gLSBXaGV0aGVyIHRvIHJldHVybiBhbiBhYnNvbHV0ZSBwb3NpdGlvbiBvciBhIHJlbGF0aXZlIHBvc2l0aW9uLg0KCSAqIEByZXR1cm5zIHtOdW1iZXJ9DQoJICovDQoJT3dsLnByb3RvdHlwZS5taW5pbXVtID0gZnVuY3Rpb24ocmVsYXRpdmUpIHsNCgkJcmV0dXJuIHJlbGF0aXZlID8gMCA6IHRoaXMuX2Nsb25lcy5sZW5ndGggLyAyOw0KCX07DQoNCgkvKioNCgkgKiBHZXRzIGFuIGl0ZW0gYXQgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSBwb3NpdGlvbi4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IFtwb3NpdGlvbl0gLSBUaGUgcmVsYXRpdmUgcG9zaXRpb24gb2YgdGhlIGl0ZW0uDQoJICogQHJldHVybiB7alF1ZXJ5fEFycmF5LjxqUXVlcnk+fSAtIFRoZSBpdGVtIGF0IHRoZSBnaXZlbiBwb3NpdGlvbiBvciBhbGwgaXRlbXMgaWYgbm8gcG9zaXRpb24gd2FzIGdpdmVuLg0KCSAqLw0KCU93bC5wcm90b3R5cGUuaXRlbXMgPSBmdW5jdGlvbihwb3NpdGlvbikgew0KCQlpZiAocG9zaXRpb24gPT09IHVuZGVmaW5lZCkgew0KCQkJcmV0dXJuIHRoaXMuX2l0ZW1zLnNsaWNlKCk7DQoJCX0NCg0KCQlwb3NpdGlvbiA9IHRoaXMubm9ybWFsaXplKHBvc2l0aW9uLCB0cnVlKTsNCgkJcmV0dXJuIHRoaXMuX2l0ZW1zW3Bvc2l0aW9uXTsNCgl9Ow0KDQoJLyoqDQoJICogR2V0cyBhbiBpdGVtIGF0IHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgcG9zaXRpb24uDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBbcG9zaXRpb25dIC0gVGhlIHJlbGF0aXZlIHBvc2l0aW9uIG9mIHRoZSBpdGVtLg0KCSAqIEByZXR1cm4ge2pRdWVyeXxBcnJheS48alF1ZXJ5Pn0gLSBUaGUgaXRlbSBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24gb3IgYWxsIGl0ZW1zIGlmIG5vIHBvc2l0aW9uIHdhcyBnaXZlbi4NCgkgKi8NCglPd2wucHJvdG90eXBlLm1lcmdlcnMgPSBmdW5jdGlvbihwb3NpdGlvbikgew0KCQlpZiAocG9zaXRpb24gPT09IHVuZGVmaW5lZCkgew0KCQkJcmV0dXJuIHRoaXMuX21lcmdlcnMuc2xpY2UoKTsNCgkJfQ0KDQoJCXBvc2l0aW9uID0gdGhpcy5ub3JtYWxpemUocG9zaXRpb24sIHRydWUpOw0KCQlyZXR1cm4gdGhpcy5fbWVyZ2Vyc1twb3NpdGlvbl07DQoJfTsNCg0KCS8qKg0KCSAqIEdldHMgdGhlIGFic29sdXRlIHBvc2l0aW9ucyBvZiBjbG9uZXMgZm9yIGFuIGl0ZW0uDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBbcG9zaXRpb25dIC0gVGhlIHJlbGF0aXZlIHBvc2l0aW9uIG9mIHRoZSBpdGVtLg0KCSAqIEByZXR1cm5zIHtBcnJheS48TnVtYmVyPn0gLSBUaGUgYWJzb2x1dGUgcG9zaXRpb25zIG9mIGNsb25lcyBmb3IgdGhlIGl0ZW0gb3IgYWxsIGlmIG5vIHBvc2l0aW9uIHdhcyBnaXZlbi4NCgkgKi8NCglPd2wucHJvdG90eXBlLmNsb25lcyA9IGZ1bmN0aW9uKHBvc2l0aW9uKSB7DQoJCXZhciBvZGQgPSB0aGlzLl9jbG9uZXMubGVuZ3RoIC8gMiwNCgkJCWV2ZW4gPSBvZGQgKyB0aGlzLl9pdGVtcy5sZW5ndGgsDQoJCQltYXAgPSBmdW5jdGlvbihpbmRleCkgeyByZXR1cm4gaW5kZXggJSAyID09PSAwID8gZXZlbiArIGluZGV4IC8gMiA6IG9kZCAtIChpbmRleCArIDEpIC8gMiB9Ow0KDQoJCWlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7DQoJCQlyZXR1cm4gJC5tYXAodGhpcy5fY2xvbmVzLCBmdW5jdGlvbih2LCBpKSB7IHJldHVybiBtYXAoaSkgfSk7DQoJCX0NCg0KCQlyZXR1cm4gJC5tYXAodGhpcy5fY2xvbmVzLCBmdW5jdGlvbih2LCBpKSB7IHJldHVybiB2ID09PSBwb3NpdGlvbiA/IG1hcChpKSA6IG51bGwgfSk7DQoJfTsNCg0KCS8qKg0KCSAqIFNldHMgdGhlIGN1cnJlbnQgYW5pbWF0aW9uIHNwZWVkLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSBhbmltYXRpb24gc3BlZWQgaW4gbWlsbGlzZWNvbmRzIG9yIG5vdGhpbmcgdG8gbGVhdmUgaXQgdW5jaGFuZ2VkLg0KCSAqIEByZXR1cm5zIHtOdW1iZXJ9IC0gVGhlIGN1cnJlbnQgYW5pbWF0aW9uIHNwZWVkIGluIG1pbGxpc2Vjb25kcy4NCgkgKi8NCglPd2wucHJvdG90eXBlLnNwZWVkID0gZnVuY3Rpb24oc3BlZWQpIHsNCgkJaWYgKHNwZWVkICE9PSB1bmRlZmluZWQpIHsNCgkJCXRoaXMuX3NwZWVkID0gc3BlZWQ7DQoJCX0NCg0KCQlyZXR1cm4gdGhpcy5fc3BlZWQ7DQoJfTsNCg0KCS8qKg0KCSAqIEdldHMgdGhlIGNvb3JkaW5hdGUgb2YgYW4gaXRlbS4NCgkgKiBAdG9kbyBUaGUgbmFtZSBvZiB0aGlzIG1ldGhvZCBpcyBtaXNzbGVhbmRpbmcuDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBwb3NpdGlvbiAtIFRoZSBhYnNvbHV0ZSBwb3NpdGlvbiBvZiB0aGUgaXRlbSB3aXRoaW4gYG1pbmltdW0oKWAgYW5kIGBtYXhpbXVtKClgLg0KCSAqIEByZXR1cm5zIHtOdW1iZXJ8QXJyYXkuPE51bWJlcj59IC0gVGhlIGNvb3JkaW5hdGUgb2YgdGhlIGl0ZW0gaW4gcGl4ZWwgb3IgYWxsIGNvb3JkaW5hdGVzLg0KCSAqLw0KCU93bC5wcm90b3R5cGUuY29vcmRpbmF0ZXMgPSBmdW5jdGlvbihwb3NpdGlvbikgew0KCQl2YXIgbXVsdGlwbGllciA9IDEsDQoJCQluZXdQb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwNCgkJCWNvb3JkaW5hdGU7DQoNCgkJaWYgKHBvc2l0aW9uID09PSB1bmRlZmluZWQpIHsNCgkJCXJldHVybiAkLm1hcCh0aGlzLl9jb29yZGluYXRlcywgJC5wcm94eShmdW5jdGlvbihjb29yZGluYXRlLCBpbmRleCkgew0KCQkJCXJldHVybiB0aGlzLmNvb3JkaW5hdGVzKGluZGV4KTsNCgkJCX0sIHRoaXMpKTsNCgkJfQ0KDQoJCWlmICh0aGlzLnNldHRpbmdzLmNlbnRlcikgew0KCQkJaWYgKHRoaXMuc2V0dGluZ3MucnRsKSB7DQoJCQkJbXVsdGlwbGllciA9IC0xOw0KCQkJCW5ld1Bvc2l0aW9uID0gcG9zaXRpb24gKyAxOw0KCQkJfQ0KDQoJCQljb29yZGluYXRlID0gdGhpcy5fY29vcmRpbmF0ZXNbcG9zaXRpb25dOw0KCQkJY29vcmRpbmF0ZSArPSAodGhpcy53aWR0aCgpIC0gY29vcmRpbmF0ZSArICh0aGlzLl9jb29yZGluYXRlc1tuZXdQb3NpdGlvbl0gfHwgMCkpIC8gMiAqIG11bHRpcGxpZXI7DQoJCX0gZWxzZSB7DQoJCQljb29yZGluYXRlID0gdGhpcy5fY29vcmRpbmF0ZXNbbmV3UG9zaXRpb25dIHx8IDA7DQoJCX0NCg0KCQljb29yZGluYXRlID0gTWF0aC5jZWlsKGNvb3JkaW5hdGUpOw0KDQoJCXJldHVybiBjb29yZGluYXRlOw0KCX07DQoNCgkvKioNCgkgKiBDYWxjdWxhdGVzIHRoZSBzcGVlZCBmb3IgYSB0cmFuc2xhdGlvbi4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtOdW1iZXJ9IGZyb20gLSBUaGUgYWJzb2x1dGUgcG9zaXRpb24gb2YgdGhlIHN0YXJ0IGl0ZW0uDQoJICogQHBhcmFtIHtOdW1iZXJ9IHRvIC0gVGhlIGFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSB0YXJnZXQgaXRlbS4NCgkgKiBAcGFyYW0ge051bWJlcn0gW2ZhY3Rvcj11bmRlZmluZWRdIC0gVGhlIHRpbWUgZmFjdG9yIGluIG1pbGxpc2Vjb25kcy4NCgkgKiBAcmV0dXJucyB7TnVtYmVyfSAtIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyBmb3IgdGhlIHRyYW5zbGF0aW9uLg0KCSAqLw0KCU93bC5wcm90b3R5cGUuZHVyYXRpb24gPSBmdW5jdGlvbihmcm9tLCB0bywgZmFjdG9yKSB7DQoJCWlmIChmYWN0b3IgPT09IDApIHsNCgkJCXJldHVybiAwOw0KCQl9DQoNCgkJcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KE1hdGguYWJzKHRvIC0gZnJvbSksIDEpLCA2KSAqIE1hdGguYWJzKChmYWN0b3IgfHwgdGhpcy5zZXR0aW5ncy5zbWFydFNwZWVkKSk7DQoJfTsNCg0KCS8qKg0KCSAqIFNsaWRlcyB0byB0aGUgc3BlY2lmaWVkIGl0ZW0uDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiBvZiB0aGUgaXRlbS4NCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyBmb3IgdGhlIHRyYW5zaXRpb24uDQoJICovDQoJT3dsLnByb3RvdHlwZS50byA9IGZ1bmN0aW9uKHBvc2l0aW9uLCBzcGVlZCkgew0KCQl2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudCgpLA0KCQkJcmV2ZXJ0ID0gbnVsbCwNCgkJCWRpc3RhbmNlID0gcG9zaXRpb24gLSB0aGlzLnJlbGF0aXZlKGN1cnJlbnQpLA0KCQkJZGlyZWN0aW9uID0gKGRpc3RhbmNlID4gMCkgLSAoZGlzdGFuY2UgPCAwKSwNCgkJCWl0ZW1zID0gdGhpcy5faXRlbXMubGVuZ3RoLA0KCQkJbWluaW11bSA9IHRoaXMubWluaW11bSgpLA0KCQkJbWF4aW11bSA9IHRoaXMubWF4aW11bSgpOw0KDQoJCWlmICh0aGlzLnNldHRpbmdzLmxvb3ApIHsNCgkJCWlmICghdGhpcy5zZXR0aW5ncy5yZXdpbmQgJiYgTWF0aC5hYnMoZGlzdGFuY2UpID4gaXRlbXMgLyAyKSB7DQoJCQkJZGlzdGFuY2UgKz0gZGlyZWN0aW9uICogLTEgKiBpdGVtczsNCgkJCX0NCg0KCQkJcG9zaXRpb24gPSBjdXJyZW50ICsgZGlzdGFuY2U7DQoJCQlyZXZlcnQgPSAoKHBvc2l0aW9uIC0gbWluaW11bSkgJSBpdGVtcyArIGl0ZW1zKSAlIGl0ZW1zICsgbWluaW11bTsNCg0KCQkJaWYgKHJldmVydCAhPT0gcG9zaXRpb24gJiYgcmV2ZXJ0IC0gZGlzdGFuY2UgPD0gbWF4aW11bSAmJiByZXZlcnQgLSBkaXN0YW5jZSA+IDApIHsNCgkJCQljdXJyZW50ID0gcmV2ZXJ0IC0gZGlzdGFuY2U7DQoJCQkJcG9zaXRpb24gPSByZXZlcnQ7DQoJCQkJdGhpcy5yZXNldChjdXJyZW50KTsNCgkJCX0NCgkJfSBlbHNlIGlmICh0aGlzLnNldHRpbmdzLnJld2luZCkgew0KCQkJbWF4aW11bSArPSAxOw0KCQkJcG9zaXRpb24gPSAocG9zaXRpb24gJSBtYXhpbXVtICsgbWF4aW11bSkgJSBtYXhpbXVtOw0KCQl9IGVsc2Ugew0KCQkJcG9zaXRpb24gPSBNYXRoLm1heChtaW5pbXVtLCBNYXRoLm1pbihtYXhpbXVtLCBwb3NpdGlvbikpOw0KCQl9DQoNCgkJdGhpcy5zcGVlZCh0aGlzLmR1cmF0aW9uKGN1cnJlbnQsIHBvc2l0aW9uLCBzcGVlZCkpOw0KCQl0aGlzLmN1cnJlbnQocG9zaXRpb24pOw0KDQoJCWlmICh0aGlzLmlzVmlzaWJsZSgpKSB7DQoJCQl0aGlzLnVwZGF0ZSgpOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFNsaWRlcyB0byB0aGUgbmV4dCBpdGVtLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyBmb3IgdGhlIHRyYW5zaXRpb24uDQoJICovDQoJT3dsLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oc3BlZWQpIHsNCgkJc3BlZWQgPSBzcGVlZCB8fCBmYWxzZTsNCgkJdGhpcy50byh0aGlzLnJlbGF0aXZlKHRoaXMuY3VycmVudCgpKSArIDEsIHNwZWVkKTsNCgl9Ow0KDQoJLyoqDQoJICogU2xpZGVzIHRvIHRoZSBwcmV2aW91cyBpdGVtLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcyBmb3IgdGhlIHRyYW5zaXRpb24uDQoJICovDQoJT3dsLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24oc3BlZWQpIHsNCgkJc3BlZWQgPSBzcGVlZCB8fCBmYWxzZTsNCgkJdGhpcy50byh0aGlzLnJlbGF0aXZlKHRoaXMuY3VycmVudCgpKSAtIDEsIHNwZWVkKTsNCgl9Ow0KDQoJLyoqDQoJICogSGFuZGxlcyB0aGUgZW5kIG9mIGFuIGFuaW1hdGlvbi4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQgLSBUaGUgZXZlbnQgYXJndW1lbnRzLg0KCSAqLw0KCU93bC5wcm90b3R5cGUub25UcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24oZXZlbnQpIHsNCg0KCQkvLyBpZiBjc3MyIGFuaW1hdGlvbiB0aGVuIGV2ZW50IG9iamVjdCBpcyB1bmRlZmluZWQNCgkJaWYgKGV2ZW50ICE9PSB1bmRlZmluZWQpIHsNCgkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KDQoJCQkvLyBDYXRjaCBvbmx5IG93bC1zdGFnZSB0cmFuc2l0aW9uRW5kIGV2ZW50DQoJCQlpZiAoKGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50IHx8IGV2ZW50Lm9yaWdpbmFsVGFyZ2V0KSAhPT0gdGhpcy4kc3RhZ2UuZ2V0KDApKSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9DQoNCgkJdGhpcy5sZWF2ZSgnYW5pbWF0aW5nJyk7DQoJCXRoaXMudHJpZ2dlcigndHJhbnNsYXRlZCcpOw0KCX07DQoNCgkvKioNCgkgKiBHZXRzIHZpZXdwb3J0IHdpZHRoLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IC0gVGhlIHdpZHRoIGluIHBpeGVsLg0KCSAqLw0KCU93bC5wcm90b3R5cGUudmlld3BvcnQgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHdpZHRoOw0KCQlpZiAodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVCYXNlRWxlbWVudCAhPT0gd2luZG93KSB7DQoJCQl3aWR0aCA9ICQodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVCYXNlRWxlbWVudCkud2lkdGgoKTsNCgkJfSBlbHNlIGlmICh3aW5kb3cuaW5uZXJXaWR0aCkgew0KCQkJd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsNCgkJfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSB7DQoJCQl3aWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsNCgkJfSBlbHNlIHsNCgkJCWNvbnNvbGUud2FybignQ2FuIG5vdCBkZXRlY3Qgdmlld3BvcnQgd2lkdGguJyk7DQoJCX0NCgkJcmV0dXJuIHdpZHRoOw0KCX07DQoNCgkvKioNCgkgKiBSZXBsYWNlcyB0aGUgY3VycmVudCBjb250ZW50Lg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge0hUTUxFbGVtZW50fGpRdWVyeXxTdHJpbmd9IGNvbnRlbnQgLSBUaGUgbmV3IGNvbnRlbnQuDQoJICovDQoJT3dsLnByb3RvdHlwZS5yZXBsYWNlID0gZnVuY3Rpb24oY29udGVudCkgew0KCQl0aGlzLiRzdGFnZS5lbXB0eSgpOw0KCQl0aGlzLl9pdGVtcyA9IFtdOw0KDQoJCWlmIChjb250ZW50KSB7DQoJCQljb250ZW50ID0gKGNvbnRlbnQgaW5zdGFuY2VvZiBqUXVlcnkpID8gY29udGVudCA6ICQoY29udGVudCk7DQoJCX0NCg0KCQlpZiAodGhpcy5zZXR0aW5ncy5uZXN0ZWRJdGVtU2VsZWN0b3IpIHsNCgkJCWNvbnRlbnQgPSBjb250ZW50LmZpbmQoJy4nICsgdGhpcy5zZXR0aW5ncy5uZXN0ZWRJdGVtU2VsZWN0b3IpOw0KCQl9DQoNCgkJY29udGVudC5maWx0ZXIoZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5ub2RlVHlwZSA9PT0gMTsNCgkJfSkuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGluZGV4LCBpdGVtKSB7DQoJCQlpdGVtID0gdGhpcy5wcmVwYXJlKGl0ZW0pOw0KCQkJdGhpcy4kc3RhZ2UuYXBwZW5kKGl0ZW0pOw0KCQkJdGhpcy5faXRlbXMucHVzaChpdGVtKTsNCgkJCXRoaXMuX21lcmdlcnMucHVzaChpdGVtLmZpbmQoJ1tkYXRhLW1lcmdlXScpLmFkZEJhY2soJ1tkYXRhLW1lcmdlXScpLmF0dHIoJ2RhdGEtbWVyZ2UnKSAqIDEgfHwgMSk7DQoJCX0sIHRoaXMpKTsNCg0KCQl0aGlzLnJlc2V0KHRoaXMuaXNOdW1lcmljKHRoaXMuc2V0dGluZ3Muc3RhcnRQb3NpdGlvbikgPyB0aGlzLnNldHRpbmdzLnN0YXJ0UG9zaXRpb24gOiAwKTsNCg0KCQl0aGlzLmludmFsaWRhdGUoJ2l0ZW1zJyk7DQoJfTsNCg0KCS8qKg0KCSAqIEFkZHMgYW4gaXRlbS4NCgkgKiBAdG9kbyBVc2UgYGl0ZW1gIGluc3RlYWQgb2YgYGNvbnRlbnRgIGZvciB0aGUgZXZlbnQgYXJndW1lbnRzLg0KCSAqIEBwdWJsaWMNCgkgKiBAcGFyYW0ge0hUTUxFbGVtZW50fGpRdWVyeXxTdHJpbmd9IGNvbnRlbnQgLSBUaGUgaXRlbSBjb250ZW50IHRvIGFkZC4NCgkgKiBAcGFyYW0ge051bWJlcn0gW3Bvc2l0aW9uXSAtIFRoZSByZWxhdGl2ZSBwb3NpdGlvbiBhdCB3aGljaCB0byBpbnNlcnQgdGhlIGl0ZW0gb3RoZXJ3aXNlIHRoZSBpdGVtIHdpbGwgYmUgYWRkZWQgdG8gdGhlIGVuZC4NCgkgKi8NCglPd2wucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGNvbnRlbnQsIHBvc2l0aW9uKSB7DQoJCXZhciBjdXJyZW50ID0gdGhpcy5yZWxhdGl2ZSh0aGlzLl9jdXJyZW50KTsNCg0KCQlwb3NpdGlvbiA9IHBvc2l0aW9uID09PSB1bmRlZmluZWQgPyB0aGlzLl9pdGVtcy5sZW5ndGggOiB0aGlzLm5vcm1hbGl6ZShwb3NpdGlvbiwgdHJ1ZSk7DQoJCWNvbnRlbnQgPSBjb250ZW50IGluc3RhbmNlb2YgalF1ZXJ5ID8gY29udGVudCA6ICQoY29udGVudCk7DQoNCgkJdGhpcy50cmlnZ2VyKCdhZGQnLCB7IGNvbnRlbnQ6IGNvbnRlbnQsIHBvc2l0aW9uOiBwb3NpdGlvbiB9KTsNCg0KCQljb250ZW50ID0gdGhpcy5wcmVwYXJlKGNvbnRlbnQpOw0KDQoJCWlmICh0aGlzLl9pdGVtcy5sZW5ndGggPT09IDAgfHwgcG9zaXRpb24gPT09IHRoaXMuX2l0ZW1zLmxlbmd0aCkgew0KCQkJdGhpcy5faXRlbXMubGVuZ3RoID09PSAwICYmIHRoaXMuJHN0YWdlLmFwcGVuZChjb250ZW50KTsNCgkJCXRoaXMuX2l0ZW1zLmxlbmd0aCAhPT0gMCAmJiB0aGlzLl9pdGVtc1twb3NpdGlvbiAtIDFdLmFmdGVyKGNvbnRlbnQpOw0KCQkJdGhpcy5faXRlbXMucHVzaChjb250ZW50KTsNCgkJCXRoaXMuX21lcmdlcnMucHVzaChjb250ZW50LmZpbmQoJ1tkYXRhLW1lcmdlXScpLmFkZEJhY2soJ1tkYXRhLW1lcmdlXScpLmF0dHIoJ2RhdGEtbWVyZ2UnKSAqIDEgfHwgMSk7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLl9pdGVtc1twb3NpdGlvbl0uYmVmb3JlKGNvbnRlbnQpOw0KCQkJdGhpcy5faXRlbXMuc3BsaWNlKHBvc2l0aW9uLCAwLCBjb250ZW50KTsNCgkJCXRoaXMuX21lcmdlcnMuc3BsaWNlKHBvc2l0aW9uLCAwLCBjb250ZW50LmZpbmQoJ1tkYXRhLW1lcmdlXScpLmFkZEJhY2soJ1tkYXRhLW1lcmdlXScpLmF0dHIoJ2RhdGEtbWVyZ2UnKSAqIDEgfHwgMSk7DQoJCX0NCg0KCQl0aGlzLl9pdGVtc1tjdXJyZW50XSAmJiB0aGlzLnJlc2V0KHRoaXMuX2l0ZW1zW2N1cnJlbnRdLmluZGV4KCkpOw0KDQoJCXRoaXMuaW52YWxpZGF0ZSgnaXRlbXMnKTsNCg0KCQl0aGlzLnRyaWdnZXIoJ2FkZGVkJywgeyBjb250ZW50OiBjb250ZW50LCBwb3NpdGlvbjogcG9zaXRpb24gfSk7DQoJfTsNCg0KCS8qKg0KCSAqIFJlbW92ZXMgYW4gaXRlbSBieSBpdHMgcG9zaXRpb24uDQoJICogQHRvZG8gVXNlIGBpdGVtYCBpbnN0ZWFkIG9mIGBjb250ZW50YCBmb3IgdGhlIGV2ZW50IGFyZ3VtZW50cy4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uIC0gVGhlIHJlbGF0aXZlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIHRvIHJlbW92ZS4NCgkgKi8NCglPd2wucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKHBvc2l0aW9uKSB7DQoJCXBvc2l0aW9uID0gdGhpcy5ub3JtYWxpemUocG9zaXRpb24sIHRydWUpOw0KDQoJCWlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl0aGlzLnRyaWdnZXIoJ3JlbW92ZScsIHsgY29udGVudDogdGhpcy5faXRlbXNbcG9zaXRpb25dLCBwb3NpdGlvbjogcG9zaXRpb24gfSk7DQoNCgkJdGhpcy5faXRlbXNbcG9zaXRpb25dLnJlbW92ZSgpOw0KCQl0aGlzLl9pdGVtcy5zcGxpY2UocG9zaXRpb24sIDEpOw0KCQl0aGlzLl9tZXJnZXJzLnNwbGljZShwb3NpdGlvbiwgMSk7DQoNCgkJdGhpcy5pbnZhbGlkYXRlKCdpdGVtcycpOw0KDQoJCXRoaXMudHJpZ2dlcigncmVtb3ZlZCcsIHsgY29udGVudDogbnVsbCwgcG9zaXRpb246IHBvc2l0aW9uIH0pOw0KCX07DQoNCgkvKioNCgkgKiBQcmVsb2FkcyBpbWFnZXMgd2l0aCBhdXRvIHdpZHRoLg0KCSAqIEB0b2RvIFJlcGxhY2UgYnkgYSBtb3JlIGdlbmVyaWMgYXBwcm9hY2gNCgkgKiBAcHJvdGVjdGVkDQoJICovDQoJT3dsLnByb3RvdHlwZS5wcmVsb2FkQXV0b1dpZHRoSW1hZ2VzID0gZnVuY3Rpb24oaW1hZ2VzKSB7DQoJCWltYWdlcy5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgZWxlbWVudCkgew0KCQkJdGhpcy5lbnRlcigncHJlLWxvYWRpbmcnKTsNCgkJCWVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KCQkJJChuZXcgSW1hZ2UoKSkub25lKCdsb2FkJywgJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJZWxlbWVudC5hdHRyKCdzcmMnLCBlLnRhcmdldC5zcmMpOw0KCQkJCWVsZW1lbnQuY3NzKCdvcGFjaXR5JywgMSk7DQoJCQkJdGhpcy5sZWF2ZSgncHJlLWxvYWRpbmcnKTsNCgkJCQkhdGhpcy5pcygncHJlLWxvYWRpbmcnKSAmJiAhdGhpcy5pcygnaW5pdGlhbGl6aW5nJykgJiYgdGhpcy5yZWZyZXNoKCk7DQoJCQl9LCB0aGlzKSkuYXR0cignc3JjJywgZWxlbWVudC5hdHRyKCdzcmMnKSB8fCBlbGVtZW50LmF0dHIoJ2RhdGEtc3JjJykgfHwgZWxlbWVudC5hdHRyKCdkYXRhLXNyYy1yZXRpbmEnKSk7DQoJCX0sIHRoaXMpKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVzdHJveXMgdGhlIGNhcm91c2VsLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglPd2wucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsNCg0KCQl0aGlzLiRlbGVtZW50Lm9mZignLm93bC5jb3JlJyk7DQoJCXRoaXMuJHN0YWdlLm9mZignLm93bC5jb3JlJyk7DQoJCSQoZG9jdW1lbnQpLm9mZignLm93bC5jb3JlJyk7DQoNCgkJaWYgKHRoaXMuc2V0dGluZ3MucmVzcG9uc2l2ZSAhPT0gZmFsc2UpIHsNCgkJCXdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5yZXNpemVUaW1lcik7DQoJCQl0aGlzLm9mZih3aW5kb3csICdyZXNpemUnLCB0aGlzLl9oYW5kbGVycy5vblRocm90dGxlZFJlc2l6ZSk7DQoJCX0NCg0KCQlmb3IgKHZhciBpIGluIHRoaXMuX3BsdWdpbnMpIHsNCgkJCXRoaXMuX3BsdWdpbnNbaV0uZGVzdHJveSgpOw0KCQl9DQoNCgkJdGhpcy4kc3RhZ2UuY2hpbGRyZW4oJy5jbG9uZWQnKS5yZW1vdmUoKTsNCg0KCQl0aGlzLiRzdGFnZS51bndyYXAoKTsNCgkJdGhpcy4kc3RhZ2UuY2hpbGRyZW4oKS5jb250ZW50cygpLnVud3JhcCgpOw0KCQl0aGlzLiRzdGFnZS5jaGlsZHJlbigpLnVud3JhcCgpOw0KCQl0aGlzLiRzdGFnZS5yZW1vdmUoKTsNCgkJdGhpcy4kZWxlbWVudA0KCQkJLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5yZWZyZXNoQ2xhc3MpDQoJCQkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmxvYWRpbmdDbGFzcykNCgkJCS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMubG9hZGVkQ2xhc3MpDQoJCQkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLnJ0bENsYXNzKQ0KCQkJLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5kcmFnQ2xhc3MpDQoJCQkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmdyYWJDbGFzcykNCgkJCS5hdHRyKCdjbGFzcycsIHRoaXMuJGVsZW1lbnQuYXR0cignY2xhc3MnKS5yZXBsYWNlKG5ldyBSZWdFeHAodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVDbGFzcyArICctXFxTK1xccycsICdnJyksICcnKSkNCgkJCS5yZW1vdmVEYXRhKCdvd2wuY2Fyb3VzZWwnKTsNCgl9Ow0KDQoJLyoqDQoJICogT3BlcmF0b3JzIHRvIGNhbGN1bGF0ZSByaWdodC10by1sZWZ0IGFuZCBsZWZ0LXRvLXJpZ2h0Lg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge051bWJlcn0gW2FdIC0gVGhlIGxlZnQgc2lkZSBvcGVyYW5kLg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBbb10gLSBUaGUgb3BlcmF0b3IuDQoJICogQHBhcmFtIHtOdW1iZXJ9IFtiXSAtIFRoZSByaWdodCBzaWRlIG9wZXJhbmQuDQoJICovDQoJT3dsLnByb3RvdHlwZS5vcCA9IGZ1bmN0aW9uKGEsIG8sIGIpIHsNCgkJdmFyIHJ0bCA9IHRoaXMuc2V0dGluZ3MucnRsOw0KCQlzd2l0Y2ggKG8pIHsNCgkJCWNhc2UgJzwnOg0KCQkJCXJldHVybiBydGwgPyBhID4gYiA6IGEgPCBiOw0KCQkJY2FzZSAnPic6DQoJCQkJcmV0dXJuIHJ0bCA/IGEgPCBiIDogYSA+IGI7DQoJCQljYXNlICc+PSc6DQoJCQkJcmV0dXJuIHJ0bCA/IGEgPD0gYiA6IGEgPj0gYjsNCgkJCWNhc2UgJzw9JzoNCgkJCQlyZXR1cm4gcnRsID8gYSA+PSBiIDogYSA8PSBiOw0KCQkJZGVmYXVsdDoNCgkJCQlicmVhazsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBBdHRhY2hlcyB0byBhbiBpbnRlcm5hbCBldmVudC4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudCAtIFRoZSBldmVudCBzb3VyY2UuDQoJICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IC0gVGhlIGV2ZW50IG5hbWUuDQoJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgZXZlbnQgaGFuZGxlciB0byBhdHRhY2guDQoJICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlIC0gV2V0aGVyIHRoZSBldmVudCBzaG91bGQgYmUgaGFuZGxlZCBhdCB0aGUgY2FwdHVyaW5nIHBoYXNlIG9yIG5vdC4NCgkgKi8NCglPd2wucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oZWxlbWVudCwgZXZlbnQsIGxpc3RlbmVyLCBjYXB0dXJlKSB7DQoJCWlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIsIGNhcHR1cmUpOw0KCQl9IGVsc2UgaWYgKGVsZW1lbnQuYXR0YWNoRXZlbnQpIHsNCgkJCWVsZW1lbnQuYXR0YWNoRXZlbnQoJ29uJyArIGV2ZW50LCBsaXN0ZW5lcik7DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogRGV0YWNoZXMgZnJvbSBhbiBpbnRlcm5hbCBldmVudC4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudCAtIFRoZSBldmVudCBzb3VyY2UuDQoJICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IC0gVGhlIGV2ZW50IG5hbWUuDQoJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgYXR0YWNoZWQgZXZlbnQgaGFuZGxlciB0byBkZXRhY2guDQoJICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlIC0gV2V0aGVyIHRoZSBhdHRhY2hlZCBldmVudCBoYW5kbGVyIHdhcyByZWdpc3RlcmVkIGFzIGEgY2FwdHVyaW5nIGxpc3RlbmVyIG9yIG5vdC4NCgkgKi8NCglPd2wucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKGVsZW1lbnQsIGV2ZW50LCBsaXN0ZW5lciwgY2FwdHVyZSkgew0KCQlpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7DQoJCQllbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGxpc3RlbmVyLCBjYXB0dXJlKTsNCgkJfSBlbHNlIGlmIChlbGVtZW50LmRldGFjaEV2ZW50KSB7DQoJCQllbGVtZW50LmRldGFjaEV2ZW50KCdvbicgKyBldmVudCwgbGlzdGVuZXIpOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFRyaWdnZXJzIGEgcHVibGljIGV2ZW50Lg0KCSAqIEB0b2RvIFJlbW92ZSBgc3RhdHVzYCwgYHJlbGF0ZWRUYXJnZXRgIHNob3VsZCBiZSB1c2VkIGluc3RlYWQuDQoJICogQHByb3RlY3RlZA0KCSAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIC0gVGhlIGV2ZW50IG5hbWUuDQoJICogQHBhcmFtIHsqfSBbZGF0YT1udWxsXSAtIFRoZSBldmVudCBkYXRhLg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZXNwYWNlPWNhcm91c2VsXSAtIFRoZSBldmVudCBuYW1lc3BhY2UuDQoJICogQHBhcmFtIHtTdHJpbmd9IFtzdGF0ZV0gLSBUaGUgc3RhdGUgd2hpY2ggaXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC4NCgkgKiBAcGFyYW0ge0Jvb2xlYW59IFtlbnRlcj1mYWxzZV0gLSBJbmRpY2F0ZXMgaWYgdGhlIGNhbGwgZW50ZXJzIHRoZSBzcGVjaWZpZWQgc3RhdGUgb3Igbm90Lg0KCSAqIEByZXR1cm5zIHtFdmVudH0gLSBUaGUgZXZlbnQgYXJndW1lbnRzLg0KCSAqLw0KCU93bC5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uKG5hbWUsIGRhdGEsIG5hbWVzcGFjZSwgc3RhdGUsIGVudGVyKSB7DQoJCXZhciBzdGF0dXMgPSB7DQoJCQlpdGVtOiB7IGNvdW50OiB0aGlzLl9pdGVtcy5sZW5ndGgsIGluZGV4OiB0aGlzLmN1cnJlbnQoKSB9DQoJCX0sIGhhbmRsZXIgPSAkLmNhbWVsQ2FzZSgNCgkJCSQuZ3JlcChbICdvbicsIG5hbWUsIG5hbWVzcGFjZSBdLCBmdW5jdGlvbih2KSB7IHJldHVybiB2IH0pDQoJCQkJLmpvaW4oJy0nKS50b0xvd2VyQ2FzZSgpDQoJCSksIGV2ZW50ID0gJC5FdmVudCgNCgkJCVsgbmFtZSwgJ293bCcsIG5hbWVzcGFjZSB8fCAnY2Fyb3VzZWwnIF0uam9pbignLicpLnRvTG93ZXJDYXNlKCksDQoJCQkkLmV4dGVuZCh7IHJlbGF0ZWRUYXJnZXQ6IHRoaXMgfSwgc3RhdHVzLCBkYXRhKQ0KCQkpOw0KDQoJCWlmICghdGhpcy5fc3VwcmVzc1tuYW1lXSkgew0KCQkJJC5lYWNoKHRoaXMuX3BsdWdpbnMsIGZ1bmN0aW9uKG5hbWUsIHBsdWdpbikgew0KCQkJCWlmIChwbHVnaW4ub25UcmlnZ2VyKSB7DQoJCQkJCXBsdWdpbi5vblRyaWdnZXIoZXZlbnQpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQl0aGlzLnJlZ2lzdGVyKHsgdHlwZTogT3dsLlR5cGUuRXZlbnQsIG5hbWU6IG5hbWUgfSk7DQoJCQl0aGlzLiRlbGVtZW50LnRyaWdnZXIoZXZlbnQpOw0KDQoJCQlpZiAodGhpcy5zZXR0aW5ncyAmJiB0eXBlb2YgdGhpcy5zZXR0aW5nc1toYW5kbGVyXSA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCXRoaXMuc2V0dGluZ3NbaGFuZGxlcl0uY2FsbCh0aGlzLCBldmVudCk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gZXZlbnQ7DQoJfTsNCg0KCS8qKg0KCSAqIEVudGVycyBhIHN0YXRlLg0KCSAqIEBwYXJhbSBuYW1lIC0gVGhlIHN0YXRlIG5hbWUuDQoJICovDQoJT3dsLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKG5hbWUpIHsNCgkJJC5lYWNoKFsgbmFtZSBdLmNvbmNhdCh0aGlzLl9zdGF0ZXMudGFnc1tuYW1lXSB8fCBbXSksICQucHJveHkoZnVuY3Rpb24oaSwgbmFtZSkgew0KCQkJaWYgKHRoaXMuX3N0YXRlcy5jdXJyZW50W25hbWVdID09PSB1bmRlZmluZWQpIHsNCgkJCQl0aGlzLl9zdGF0ZXMuY3VycmVudFtuYW1lXSA9IDA7DQoJCQl9DQoNCgkJCXRoaXMuX3N0YXRlcy5jdXJyZW50W25hbWVdKys7DQoJCX0sIHRoaXMpKTsNCgl9Ow0KDQoJLyoqDQoJICogTGVhdmVzIGEgc3RhdGUuDQoJICogQHBhcmFtIG5hbWUgLSBUaGUgc3RhdGUgbmFtZS4NCgkgKi8NCglPd2wucHJvdG90eXBlLmxlYXZlID0gZnVuY3Rpb24obmFtZSkgew0KCQkkLmVhY2goWyBuYW1lIF0uY29uY2F0KHRoaXMuX3N0YXRlcy50YWdzW25hbWVdIHx8IFtdKSwgJC5wcm94eShmdW5jdGlvbihpLCBuYW1lKSB7DQoJCQl0aGlzLl9zdGF0ZXMuY3VycmVudFtuYW1lXS0tOw0KCQl9LCB0aGlzKSk7DQoJfTsNCg0KCS8qKg0KCSAqIFJlZ2lzdGVycyBhbiBldmVudCBvciBzdGF0ZS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCAtIFRoZSBldmVudCBvciBzdGF0ZSB0byByZWdpc3Rlci4NCgkgKi8NCglPd2wucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24ob2JqZWN0KSB7DQoJCWlmIChvYmplY3QudHlwZSA9PT0gT3dsLlR5cGUuRXZlbnQpIHsNCgkJCWlmICghJC5ldmVudC5zcGVjaWFsW29iamVjdC5uYW1lXSkgew0KCQkJCSQuZXZlbnQuc3BlY2lhbFtvYmplY3QubmFtZV0gPSB7fTsNCgkJCX0NCg0KCQkJaWYgKCEkLmV2ZW50LnNwZWNpYWxbb2JqZWN0Lm5hbWVdLm93bCkgew0KCQkJCXZhciBfZGVmYXVsdCA9ICQuZXZlbnQuc3BlY2lhbFtvYmplY3QubmFtZV0uX2RlZmF1bHQ7DQoJCQkJJC5ldmVudC5zcGVjaWFsW29iamVjdC5uYW1lXS5fZGVmYXVsdCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJaWYgKF9kZWZhdWx0ICYmIF9kZWZhdWx0LmFwcGx5ICYmICghZS5uYW1lc3BhY2UgfHwgZS5uYW1lc3BhY2UuaW5kZXhPZignb3dsJykgPT09IC0xKSkgew0KCQkJCQkJcmV0dXJuIF9kZWZhdWx0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQkJCX0NCgkJCQkJcmV0dXJuIGUubmFtZXNwYWNlICYmIGUubmFtZXNwYWNlLmluZGV4T2YoJ293bCcpID4gLTE7DQoJCQkJfTsNCgkJCQkkLmV2ZW50LnNwZWNpYWxbb2JqZWN0Lm5hbWVdLm93bCA9IHRydWU7DQoJCQl9DQoJCX0gZWxzZSBpZiAob2JqZWN0LnR5cGUgPT09IE93bC5UeXBlLlN0YXRlKSB7DQoJCQlpZiAoIXRoaXMuX3N0YXRlcy50YWdzW29iamVjdC5uYW1lXSkgew0KCQkJCXRoaXMuX3N0YXRlcy50YWdzW29iamVjdC5uYW1lXSA9IG9iamVjdC50YWdzOw0KCQkJfSBlbHNlIHsNCgkJCQl0aGlzLl9zdGF0ZXMudGFnc1tvYmplY3QubmFtZV0gPSB0aGlzLl9zdGF0ZXMudGFnc1tvYmplY3QubmFtZV0uY29uY2F0KG9iamVjdC50YWdzKTsNCgkJCX0NCg0KCQkJdGhpcy5fc3RhdGVzLnRhZ3Nbb2JqZWN0Lm5hbWVdID0gJC5ncmVwKHRoaXMuX3N0YXRlcy50YWdzW29iamVjdC5uYW1lXSwgJC5wcm94eShmdW5jdGlvbih0YWcsIGkpIHsNCgkJCQlyZXR1cm4gJC5pbkFycmF5KHRhZywgdGhpcy5fc3RhdGVzLnRhZ3Nbb2JqZWN0Lm5hbWVdKSA9PT0gaTsNCgkJCX0sIHRoaXMpKTsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBTdXBwcmVzc2VzIGV2ZW50cy4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtBcnJheS48U3RyaW5nPn0gZXZlbnRzIC0gVGhlIGV2ZW50cyB0byBzdXBwcmVzcy4NCgkgKi8NCglPd2wucHJvdG90eXBlLnN1cHByZXNzID0gZnVuY3Rpb24oZXZlbnRzKSB7DQoJCSQuZWFjaChldmVudHMsICQucHJveHkoZnVuY3Rpb24oaW5kZXgsIGV2ZW50KSB7DQoJCQl0aGlzLl9zdXByZXNzW2V2ZW50XSA9IHRydWU7DQoJCX0sIHRoaXMpKTsNCgl9Ow0KDQoJLyoqDQoJICogUmVsZWFzZXMgc3VwcHJlc3NlZCBldmVudHMuDQoJICogQHByb3RlY3RlZA0KCSAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IGV2ZW50cyAtIFRoZSBldmVudHMgdG8gcmVsZWFzZS4NCgkgKi8NCglPd2wucHJvdG90eXBlLnJlbGVhc2UgPSBmdW5jdGlvbihldmVudHMpIHsNCgkJJC5lYWNoKGV2ZW50cywgJC5wcm94eShmdW5jdGlvbihpbmRleCwgZXZlbnQpIHsNCgkJCWRlbGV0ZSB0aGlzLl9zdXByZXNzW2V2ZW50XTsNCgkJfSwgdGhpcykpOw0KCX07DQoNCgkvKioNCgkgKiBHZXRzIHVuaWZpZWQgcG9pbnRlciBjb29yZGluYXRlcyBmcm9tIGV2ZW50Lg0KCSAqIEB0b2RvICMyNjENCgkgKiBAcHJvdGVjdGVkDQoJICogQHBhcmFtIHtFdmVudH0gLSBUaGUgYG1vdXNlZG93bmAgb3IgYHRvdWNoc3RhcnRgIGV2ZW50Lg0KCSAqIEByZXR1cm5zIHtPYmplY3R9IC0gQ29udGFpbnMgYHhgIGFuZCBgeWAgY29vcmRpbmF0ZXMgb2YgY3VycmVudCBwb2ludGVyIHBvc2l0aW9uLg0KCSAqLw0KCU93bC5wcm90b3R5cGUucG9pbnRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCXZhciByZXN1bHQgPSB7IHg6IG51bGwsIHk6IG51bGwgfTsNCg0KCQlldmVudCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgfHwgZXZlbnQgfHwgd2luZG93LmV2ZW50Ow0KDQoJCWV2ZW50ID0gZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzLmxlbmd0aCA/DQoJCQlldmVudC50b3VjaGVzWzBdIDogZXZlbnQuY2hhbmdlZFRvdWNoZXMgJiYgZXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoID8NCgkJCQlldmVudC5jaGFuZ2VkVG91Y2hlc1swXSA6IGV2ZW50Ow0KDQoJCWlmIChldmVudC5wYWdlWCkgew0KCQkJcmVzdWx0LnggPSBldmVudC5wYWdlWDsNCgkJCXJlc3VsdC55ID0gZXZlbnQucGFnZVk7DQoJCX0gZWxzZSB7DQoJCQlyZXN1bHQueCA9IGV2ZW50LmNsaWVudFg7DQoJCQlyZXN1bHQueSA9IGV2ZW50LmNsaWVudFk7DQoJCX0NCg0KCQlyZXR1cm4gcmVzdWx0Ow0KCX07DQoNCgkvKioNCgkgKiBEZXRlcm1pbmVzIGlmIHRoZSBpbnB1dCBpcyBhIE51bWJlciBvciBzb21ldGhpbmcgdGhhdCBjYW4gYmUgY29lcmNlZCB0byBhIE51bWJlcg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd8T2JqZWN0fEFycmF5fEJvb2xlYW58UmVnRXhwfEZ1bmN0aW9ufFN5bWJvbH0gLSBUaGUgaW5wdXQgdG8gYmUgdGVzdGVkDQoJICogQHJldHVybnMge0Jvb2xlYW59IC0gQW4gaW5kaWNhdGlvbiBpZiB0aGUgaW5wdXQgaXMgYSBOdW1iZXIgb3IgY2FuIGJlIGNvZXJjZWQgdG8gYSBOdW1iZXINCgkgKi8NCglPd2wucHJvdG90eXBlLmlzTnVtZXJpYyA9IGZ1bmN0aW9uKG51bWJlcikgew0KCQlyZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobnVtYmVyKSk7DQoJfTsNCg0KCS8qKg0KCSAqIEdldHMgdGhlIGRpZmZlcmVuY2Ugb2YgdHdvIHZlY3RvcnMuDQoJICogQHRvZG8gIzI2MQ0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge09iamVjdH0gLSBUaGUgZmlyc3QgdmVjdG9yLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSAtIFRoZSBzZWNvbmQgdmVjdG9yLg0KCSAqIEByZXR1cm5zIHtPYmplY3R9IC0gVGhlIGRpZmZlcmVuY2UuDQoJICovDQoJT3dsLnByb3RvdHlwZS5kaWZmZXJlbmNlID0gZnVuY3Rpb24oZmlyc3QsIHNlY29uZCkgew0KCQlyZXR1cm4gew0KCQkJeDogZmlyc3QueCAtIHNlY29uZC54LA0KCQkJeTogZmlyc3QueSAtIHNlY29uZC55DQoJCX07DQoJfTsNCg0KCS8qKg0KCSAqIFRoZSBqUXVlcnkgUGx1Z2luIGZvciB0aGUgT3dsIENhcm91c2VsDQoJICogQHRvZG8gTmF2aWdhdGlvbiBwbHVnaW4gYG5leHRgIGFuZCBgcHJldmANCgkgKiBAcHVibGljDQoJICovDQoJJC5mbi5vd2xDYXJvdXNlbCA9IGZ1bmN0aW9uKG9wdGlvbikgew0KCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7DQoNCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCXZhciAkdGhpcyA9ICQodGhpcyksDQoJCQkJZGF0YSA9ICR0aGlzLmRhdGEoJ293bC5jYXJvdXNlbCcpOw0KDQoJCQlpZiAoIWRhdGEpIHsNCgkJCQlkYXRhID0gbmV3IE93bCh0aGlzLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbik7DQoJCQkJJHRoaXMuZGF0YSgnb3dsLmNhcm91c2VsJywgZGF0YSk7DQoNCgkJCQkkLmVhY2goWw0KCQkJCQknbmV4dCcsICdwcmV2JywgJ3RvJywgJ2Rlc3Ryb3knLCAncmVmcmVzaCcsICdyZXBsYWNlJywgJ2FkZCcsICdyZW1vdmUnDQoJCQkJXSwgZnVuY3Rpb24oaSwgZXZlbnQpIHsNCgkJCQkJZGF0YS5yZWdpc3Rlcih7IHR5cGU6IE93bC5UeXBlLkV2ZW50LCBuYW1lOiBldmVudCB9KTsNCgkJCQkJZGF0YS4kZWxlbWVudC5vbihldmVudCArICcub3dsLmNhcm91c2VsLmNvcmUnLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQkJCWlmIChlLm5hbWVzcGFjZSAmJiBlLnJlbGF0ZWRUYXJnZXQgIT09IHRoaXMpIHsNCgkJCQkJCQl0aGlzLnN1cHByZXNzKFsgZXZlbnQgXSk7DQoJCQkJCQkJZGF0YVtldmVudF0uYXBwbHkodGhpcywgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsNCgkJCQkJCQl0aGlzLnJlbGVhc2UoWyBldmVudCBdKTsNCgkJCQkJCX0NCgkJCQkJfSwgZGF0YSkpOw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJyAmJiBvcHRpb24uY2hhckF0KDApICE9PSAnXycpIHsNCgkJCQlkYXRhW29wdGlvbl0uYXBwbHkoZGF0YSwgYXJncyk7DQoJCQl9DQoJCX0pOw0KCX07DQoNCgkvKioNCgkgKiBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBqUXVlcnkgUGx1Z2luDQoJICogQHB1YmxpYw0KCSAqLw0KCSQuZm4ub3dsQ2Fyb3VzZWwuQ29uc3RydWN0b3IgPSBPd2w7DQoNCn0pKHdpbmRvdy5aZXB0byB8fCB3aW5kb3cualF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50KTsNCg0KLyoqDQogKiBBdXRvUmVmcmVzaCBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEFydHVzIEtvbGFub3dza2kNCiAqIEBhdXRob3IgRGF2aWQgRGV1dHNjaA0KICogQGxpY2Vuc2UgVGhlIE1JVCBMaWNlbnNlIChNSVQpDQogKi8NCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoNCgkvKioNCgkgKiBDcmVhdGVzIHRoZSBhdXRvIHJlZnJlc2ggcGx1Z2luLg0KCSAqIEBjbGFzcyBUaGUgQXV0byBSZWZyZXNoIFBsdWdpbg0KCSAqIEBwYXJhbSB7T3dsfSBjYXJvdXNlbCAtIFRoZSBPd2wgQ2Fyb3VzZWwNCgkgKi8NCgl2YXIgQXV0b1JlZnJlc2ggPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KCQkvKioNCgkJICogUmVmZXJlbmNlIHRvIHRoZSBjb3JlLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPd2x9DQoJCSAqLw0KCQl0aGlzLl9jb3JlID0gY2Fyb3VzZWw7DQoNCgkJLyoqDQoJCSAqIFJlZnJlc2ggaW50ZXJ2YWwuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge251bWJlcn0NCgkJICovDQoJCXRoaXMuX2ludGVydmFsID0gbnVsbDsNCg0KCQkvKioNCgkJICogV2hldGhlciB0aGUgZWxlbWVudCBpcyBjdXJyZW50bHkgdmlzaWJsZSBvciBub3QuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge0Jvb2xlYW59DQoJCSAqLw0KCQl0aGlzLl92aXNpYmxlID0gbnVsbDsNCg0KCQkvKioNCgkJICogQWxsIGV2ZW50IGhhbmRsZXJzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9oYW5kbGVycyA9IHsNCgkJCSdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UgJiYgdGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvUmVmcmVzaCkgew0KCQkJCQl0aGlzLndhdGNoKCk7DQoJCQkJfQ0KCQkJfSwgdGhpcykNCgkJfTsNCg0KCQkvLyBzZXQgZGVmYXVsdCBvcHRpb25zDQoJCXRoaXMuX2NvcmUub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBBdXRvUmVmcmVzaC5EZWZhdWx0cywgdGhpcy5fY29yZS5vcHRpb25zKTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBoYW5kbGVycw0KCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglBdXRvUmVmcmVzaC5EZWZhdWx0cyA9IHsNCgkJYXV0b1JlZnJlc2g6IHRydWUsDQoJCWF1dG9SZWZyZXNoSW50ZXJ2YWw6IDUwMA0KCX07DQoNCgkvKioNCgkgKiBXYXRjaGVzIHRoZSBlbGVtZW50Lg0KCSAqLw0KCUF1dG9SZWZyZXNoLnByb3RvdHlwZS53YXRjaCA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5faW50ZXJ2YWwpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXRoaXMuX3Zpc2libGUgPSB0aGlzLl9jb3JlLmlzVmlzaWJsZSgpOw0KCQl0aGlzLl9pbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgkLnByb3h5KHRoaXMucmVmcmVzaCwgdGhpcyksIHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b1JlZnJlc2hJbnRlcnZhbCk7DQoJfTsNCg0KCS8qKg0KCSAqIFJlZnJlc2hlcyB0aGUgZWxlbWVudC4NCgkgKi8NCglBdXRvUmVmcmVzaC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5fY29yZS5pc1Zpc2libGUoKSA9PT0gdGhpcy5fdmlzaWJsZSkgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJdGhpcy5fdmlzaWJsZSA9ICF0aGlzLl92aXNpYmxlOw0KDQoJCXRoaXMuX2NvcmUuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoJ293bC1oaWRkZW4nLCAhdGhpcy5fdmlzaWJsZSk7DQoNCgkJdGhpcy5fdmlzaWJsZSAmJiAodGhpcy5fY29yZS5pbnZhbGlkYXRlKCd3aWR0aCcpICYmIHRoaXMuX2NvcmUucmVmcmVzaCgpKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVzdHJveXMgdGhlIHBsdWdpbi4NCgkgKi8NCglBdXRvUmVmcmVzaC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgaGFuZGxlciwgcHJvcGVydHk7DQoNCgkJd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpOw0KDQoJCWZvciAoaGFuZGxlciBpbiB0aGlzLl9oYW5kbGVycykgew0KCQkJdGhpcy5fY29yZS4kZWxlbWVudC5vZmYoaGFuZGxlciwgdGhpcy5faGFuZGxlcnNbaGFuZGxlcl0pOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPSAnZnVuY3Rpb24nICYmICh0aGlzW3Byb3BlcnR5XSA9IG51bGwpOw0KCQl9DQoJfTsNCg0KCSQuZm4ub3dsQ2Fyb3VzZWwuQ29uc3RydWN0b3IuUGx1Z2lucy5BdXRvUmVmcmVzaCA9IEF1dG9SZWZyZXNoOw0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7DQoNCi8qKg0KICogTGF6eSBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEJhcnRvc3ogV29qY2llY2hvd3NraQ0KICogQGF1dGhvciBEYXZpZCBEZXV0c2NoDQogKiBAbGljZW5zZSBUaGUgTUlUIExpY2Vuc2UgKE1JVCkNCiAqLw0KOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsNCg0KCS8qKg0KCSAqIENyZWF0ZXMgdGhlIGxhenkgcGx1Z2luLg0KCSAqIEBjbGFzcyBUaGUgTGF6eSBQbHVnaW4NCgkgKiBAcGFyYW0ge093bH0gY2Fyb3VzZWwgLSBUaGUgT3dsIENhcm91c2VsDQoJICovDQoJdmFyIExhenkgPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KDQoJCS8qKg0KCQkgKiBSZWZlcmVuY2UgdG8gdGhlIGNvcmUuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge093bH0NCgkJICovDQoJCXRoaXMuX2NvcmUgPSBjYXJvdXNlbDsNCg0KCQkvKioNCgkJICogQWxyZWFkeSBsb2FkZWQgaXRlbXMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge0FycmF5LjxqUXVlcnk+fQ0KCQkgKi8NCgkJdGhpcy5fbG9hZGVkID0gW107DQoNCgkJLyoqDQoJCSAqIEV2ZW50IGhhbmRsZXJzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9oYW5kbGVycyA9IHsNCgkJCSdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwgY2hhbmdlLm93bC5jYXJvdXNlbCByZXNpemVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmICghZS5uYW1lc3BhY2UpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCWlmICghdGhpcy5fY29yZS5zZXR0aW5ncyB8fCAhdGhpcy5fY29yZS5zZXR0aW5ncy5sYXp5TG9hZCkgew0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJaWYgKChlLnByb3BlcnR5ICYmIGUucHJvcGVydHkubmFtZSA9PSAncG9zaXRpb24nKSB8fCBlLnR5cGUgPT0gJ2luaXRpYWxpemVkJykgew0KCQkJCQl2YXIgc2V0dGluZ3MgPSB0aGlzLl9jb3JlLnNldHRpbmdzLA0KCQkJCQkJbiA9IChzZXR0aW5ncy5jZW50ZXIgJiYgTWF0aC5jZWlsKHNldHRpbmdzLml0ZW1zIC8gMikgfHwgc2V0dGluZ3MuaXRlbXMpLA0KCQkJCQkJaSA9ICgoc2V0dGluZ3MuY2VudGVyICYmIG4gKiAtMSkgfHwgMCksDQoJCQkJCQlwb3NpdGlvbiA9IChlLnByb3BlcnR5ICYmIGUucHJvcGVydHkudmFsdWUgIT09IHVuZGVmaW5lZCA/IGUucHJvcGVydHkudmFsdWUgOiB0aGlzLl9jb3JlLmN1cnJlbnQoKSkgKyBpLA0KCQkJCQkJY2xvbmVzID0gdGhpcy5fY29yZS5jbG9uZXMoKS5sZW5ndGgsDQoJCQkJCQlsb2FkID0gJC5wcm94eShmdW5jdGlvbihpLCB2KSB7IHRoaXMubG9hZCh2KSB9LCB0aGlzKTsNCgkJCQkJLy9UT0RPOiBOZWVkIGRvY3VtZW50YXRpb24gZm9yIHRoaXMgbmV3IG9wdGlvbg0KCQkJCQlpZiAoc2V0dGluZ3MubGF6eUxvYWRFYWdlciA+IDApIHsNCgkJCQkJCW4gKz0gc2V0dGluZ3MubGF6eUxvYWRFYWdlcjsNCgkJCQkJCS8vIElmIHRoZSBjYXJvdXNlbCBpcyBsb29waW5nIGFsc28gcHJlbG9hZCBpbWFnZXMgdGhhdCBhcmUgdG8gdGhlICJsZWZ0Ig0KCQkJCQkJaWYgKHNldHRpbmdzLmxvb3ApIHsNCiAgICAgICAgICAgICAgcG9zaXRpb24gLT0gc2V0dGluZ3MubGF6eUxvYWRFYWdlcjsNCiAgICAgICAgICAgICAgbisrOw0KICAgICAgICAgICAgfQ0KCQkJCQl9DQoNCgkJCQkJd2hpbGUgKGkrKyA8IG4pIHsNCgkJCQkJCXRoaXMubG9hZChjbG9uZXMgLyAyICsgdGhpcy5fY29yZS5yZWxhdGl2ZShwb3NpdGlvbikpOw0KCQkJCQkJY2xvbmVzICYmICQuZWFjaCh0aGlzLl9jb3JlLmNsb25lcyh0aGlzLl9jb3JlLnJlbGF0aXZlKHBvc2l0aW9uKSksIGxvYWQpOw0KCQkJCQkJcG9zaXRpb24rKzsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0sIHRoaXMpDQoJCX07DQoNCgkJLy8gc2V0IHRoZSBkZWZhdWx0IG9wdGlvbnMNCgkJdGhpcy5fY29yZS5vcHRpb25zID0gJC5leHRlbmQoe30sIExhenkuRGVmYXVsdHMsIHRoaXMuX2NvcmUub3B0aW9ucyk7DQoNCgkJLy8gcmVnaXN0ZXIgZXZlbnQgaGFuZGxlcg0KCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglMYXp5LkRlZmF1bHRzID0gew0KCQlsYXp5TG9hZDogZmFsc2UsDQoJCWxhenlMb2FkRWFnZXI6IDANCgl9Ow0KDQoJLyoqDQoJICogTG9hZHMgYWxsIHJlc291cmNlcyBvZiBhbiBpdGVtIGF0IHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uDQoJICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uIC0gVGhlIGFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSBpdGVtLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKi8NCglMYXp5LnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24ocG9zaXRpb24pIHsNCgkJdmFyICRpdGVtID0gdGhpcy5fY29yZS4kc3RhZ2UuY2hpbGRyZW4oKS5lcShwb3NpdGlvbiksDQoJCQkkZWxlbWVudHMgPSAkaXRlbSAmJiAkaXRlbS5maW5kKCcub3dsLWxhenknKTsNCg0KCQlpZiAoISRlbGVtZW50cyB8fCAkLmluQXJyYXkoJGl0ZW0uZ2V0KDApLCB0aGlzLl9sb2FkZWQpID4gLTEpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCSRlbGVtZW50cy5lYWNoKCQucHJveHkoZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHsNCgkJCXZhciAkZWxlbWVudCA9ICQoZWxlbWVudCksIGltYWdlLA0KICAgICAgICAgICAgICAgIHVybCA9ICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEgJiYgJGVsZW1lbnQuYXR0cignZGF0YS1zcmMtcmV0aW5hJykpIHx8ICRlbGVtZW50LmF0dHIoJ2RhdGEtc3JjJykgfHwgJGVsZW1lbnQuYXR0cignZGF0YS1zcmNzZXQnKTsNCg0KCQkJdGhpcy5fY29yZS50cmlnZ2VyKCdsb2FkJywgeyBlbGVtZW50OiAkZWxlbWVudCwgdXJsOiB1cmwgfSwgJ2xhenknKTsNCg0KCQkJaWYgKCRlbGVtZW50LmlzKCdpbWcnKSkgew0KCQkJCSRlbGVtZW50Lm9uZSgnbG9hZC5vd2wubGF6eScsICQucHJveHkoZnVuY3Rpb24oKSB7DQoJCQkJCSRlbGVtZW50LmNzcygnb3BhY2l0eScsIDEpOw0KCQkJCQl0aGlzLl9jb3JlLnRyaWdnZXIoJ2xvYWRlZCcsIHsgZWxlbWVudDogJGVsZW1lbnQsIHVybDogdXJsIH0sICdsYXp5Jyk7DQoJCQkJfSwgdGhpcykpLmF0dHIoJ3NyYycsIHVybCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKCRlbGVtZW50LmlzKCdzb3VyY2UnKSkgew0KICAgICAgICAgICAgICAgICRlbGVtZW50Lm9uZSgnbG9hZC5vd2wubGF6eScsICQucHJveHkoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvcmUudHJpZ2dlcignbG9hZGVkJywgeyBlbGVtZW50OiAkZWxlbWVudCwgdXJsOiB1cmwgfSwgJ2xhenknKTsNCiAgICAgICAgICAgICAgICB9LCB0aGlzKSkuYXR0cignc3Jjc2V0JywgdXJsKTsNCgkJCX0gZWxzZSB7DQoJCQkJaW1hZ2UgPSBuZXcgSW1hZ2UoKTsNCgkJCQlpbWFnZS5vbmxvYWQgPSAkLnByb3h5KGZ1bmN0aW9uKCkgew0KCQkJCQkkZWxlbWVudC5jc3Moew0KCQkJCQkJJ2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKCInICsgdXJsICsgJyIpJywNCgkJCQkJCSdvcGFjaXR5JzogJzEnDQoJCQkJCX0pOw0KCQkJCQl0aGlzLl9jb3JlLnRyaWdnZXIoJ2xvYWRlZCcsIHsgZWxlbWVudDogJGVsZW1lbnQsIHVybDogdXJsIH0sICdsYXp5Jyk7DQoJCQkJfSwgdGhpcyk7DQoJCQkJaW1hZ2Uuc3JjID0gdXJsOw0KCQkJfQ0KCQl9LCB0aGlzKSk7DQoNCgkJdGhpcy5fbG9hZGVkLnB1c2goJGl0ZW0uZ2V0KDApKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVzdHJveXMgdGhlIHBsdWdpbi4NCgkgKiBAcHVibGljDQoJICovDQoJTGF6eS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgaGFuZGxlciwgcHJvcGVydHk7DQoNCgkJZm9yIChoYW5kbGVyIGluIHRoaXMuaGFuZGxlcnMpIHsNCgkJCXRoaXMuX2NvcmUuJGVsZW1lbnQub2ZmKGhhbmRsZXIsIHRoaXMuaGFuZGxlcnNbaGFuZGxlcl0pOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPSAnZnVuY3Rpb24nICYmICh0aGlzW3Byb3BlcnR5XSA9IG51bGwpOw0KCQl9DQoJfTsNCg0KCSQuZm4ub3dsQ2Fyb3VzZWwuQ29uc3RydWN0b3IuUGx1Z2lucy5MYXp5ID0gTGF6eTsNCg0KfSkod2luZG93LlplcHRvIHx8IHdpbmRvdy5qUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpOw0KDQovKioNCiAqIEF1dG9IZWlnaHQgUGx1Z2luDQogKiBAdmVyc2lvbiAyLjMuNA0KICogQGF1dGhvciBCYXJ0b3N6IFdvamNpZWNob3dza2kNCiAqIEBhdXRob3IgRGF2aWQgRGV1dHNjaA0KICogQGxpY2Vuc2UgVGhlIE1JVCBMaWNlbnNlIChNSVQpDQogKi8NCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoNCgkvKioNCgkgKiBDcmVhdGVzIHRoZSBhdXRvIGhlaWdodCBwbHVnaW4uDQoJICogQGNsYXNzIFRoZSBBdXRvIEhlaWdodCBQbHVnaW4NCgkgKiBAcGFyYW0ge093bH0gY2Fyb3VzZWwgLSBUaGUgT3dsIENhcm91c2VsDQoJICovDQoJdmFyIEF1dG9IZWlnaHQgPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KCQkvKioNCgkJICogUmVmZXJlbmNlIHRvIHRoZSBjb3JlLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPd2x9DQoJCSAqLw0KCQl0aGlzLl9jb3JlID0gY2Fyb3VzZWw7DQoNCgkJdGhpcy5fcHJldmlvdXNIZWlnaHQgPSBudWxsOw0KDQoJCS8qKg0KCQkgKiBBbGwgZXZlbnQgaGFuZGxlcnMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge09iamVjdH0NCgkJICovDQoJCXRoaXMuX2hhbmRsZXJzID0gew0KCQkJJ2luaXRpYWxpemVkLm93bC5jYXJvdXNlbCByZWZyZXNoZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b0hlaWdodCkgew0KCQkJCQl0aGlzLnVwZGF0ZSgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ2NoYW5nZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b0hlaWdodCAmJiBlLnByb3BlcnR5Lm5hbWUgPT09ICdwb3NpdGlvbicpew0KCQkJCQl0aGlzLnVwZGF0ZSgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ2xvYWRlZC5vd2wubGF6eSc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9jb3JlLnNldHRpbmdzLmF1dG9IZWlnaHQNCgkJCQkJJiYgZS5lbGVtZW50LmNsb3Nlc3QoJy4nICsgdGhpcy5fY29yZS5zZXR0aW5ncy5pdGVtQ2xhc3MpLmluZGV4KCkgPT09IHRoaXMuX2NvcmUuY3VycmVudCgpKSB7DQoJCQkJCXRoaXMudXBkYXRlKCk7DQoJCQkJfQ0KCQkJfSwgdGhpcykNCgkJfTsNCg0KCQkvLyBzZXQgZGVmYXVsdCBvcHRpb25zDQoJCXRoaXMuX2NvcmUub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBBdXRvSGVpZ2h0LkRlZmF1bHRzLCB0aGlzLl9jb3JlLm9wdGlvbnMpOw0KDQoJCS8vIHJlZ2lzdGVyIGV2ZW50IGhhbmRsZXJzDQoJCXRoaXMuX2NvcmUuJGVsZW1lbnQub24odGhpcy5faGFuZGxlcnMpOw0KCQl0aGlzLl9pbnRlcnZhbElkID0gbnVsbDsNCgkJdmFyIHJlZlRoaXMgPSB0aGlzOw0KDQoJCS8vIFRoZXNlIGNoYW5nZXMgaGF2ZSBiZWVuIHRha2VuIGZyb20gYSBQUiBieSBnYXZyb2NoZWxlZ25vdSBwcm9wb3NlZCBpbiAjMTU3NQ0KCQkvLyBhbmQgaGF2ZSBiZWVuIG1hZGUgY29tcGF0aWJsZSB3aXRoIHRoZSBsYXRlc3QgalF1ZXJ5IHZlcnNpb24NCgkJJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQoJCQlpZiAocmVmVGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvSGVpZ2h0KSB7DQoJCQkJcmVmVGhpcy51cGRhdGUoKTsNCgkJCX0NCgkJfSk7DQoNCgkJLy8gQXV0b3Jlc2l6ZSB0aGUgaGVpZ2h0IG9mIHRoZSBjYXJvdXNlbCB3aGVuIHdpbmRvdyBpcyByZXNpemVkDQoJCS8vIFdoZW4gY2Fyb3VzZWwgaGFzIGltYWdlcywgdGhlIGhlaWdodCBpcyBkZXBlbmRlbnQgb24gdGhlIHdpZHRoDQoJCS8vIGFuZCBzaG91bGQgYWxzbyBjaGFuZ2Ugb24gcmVzaXplDQoJCSQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7DQoJCQlpZiAocmVmVGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvSGVpZ2h0KSB7DQoJCQkJaWYgKHJlZlRoaXMuX2ludGVydmFsSWQgIT0gbnVsbCkgew0KCQkJCQljbGVhclRpbWVvdXQocmVmVGhpcy5faW50ZXJ2YWxJZCk7DQoJCQkJfQ0KDQoJCQkJcmVmVGhpcy5faW50ZXJ2YWxJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCXJlZlRoaXMudXBkYXRlKCk7DQoJCQkJfSwgMjUwKTsNCgkJCX0NCgkJfSk7DQoNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglBdXRvSGVpZ2h0LkRlZmF1bHRzID0gew0KCQlhdXRvSGVpZ2h0OiBmYWxzZSwNCgkJYXV0b0hlaWdodENsYXNzOiAnb3dsLWhlaWdodCcNCgl9Ow0KDQoJLyoqDQoJICogVXBkYXRlcyB0aGUgdmlldy4NCgkgKi8NCglBdXRvSGVpZ2h0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHN0YXJ0ID0gdGhpcy5fY29yZS5fY3VycmVudCwNCgkJCWVuZCA9IHN0YXJ0ICsgdGhpcy5fY29yZS5zZXR0aW5ncy5pdGVtcywNCgkJCWxhenlMb2FkRW5hYmxlZCA9IHRoaXMuX2NvcmUuc2V0dGluZ3MubGF6eUxvYWQsDQoJCQl2aXNpYmxlID0gdGhpcy5fY29yZS4kc3RhZ2UuY2hpbGRyZW4oKS50b0FycmF5KCkuc2xpY2Uoc3RhcnQsIGVuZCksDQoJCQloZWlnaHRzID0gW10sDQoJCQltYXhoZWlnaHQgPSAwOw0KDQoJCSQuZWFjaCh2aXNpYmxlLCBmdW5jdGlvbihpbmRleCwgaXRlbSkgew0KCQkJaGVpZ2h0cy5wdXNoKCQoaXRlbSkuaGVpZ2h0KCkpOw0KCQl9KTsNCg0KCQltYXhoZWlnaHQgPSBNYXRoLm1heC5hcHBseShudWxsLCBoZWlnaHRzKTsNCg0KCQlpZiAobWF4aGVpZ2h0IDw9IDEgJiYgbGF6eUxvYWRFbmFibGVkICYmIHRoaXMuX3ByZXZpb3VzSGVpZ2h0KSB7DQoJCQltYXhoZWlnaHQgPSB0aGlzLl9wcmV2aW91c0hlaWdodDsNCgkJfQ0KDQoJCXRoaXMuX3ByZXZpb3VzSGVpZ2h0ID0gbWF4aGVpZ2h0Ow0KDQoJCXRoaXMuX2NvcmUuJHN0YWdlLnBhcmVudCgpDQoJCQkuaGVpZ2h0KG1heGhlaWdodCkNCgkJCS5hZGRDbGFzcyh0aGlzLl9jb3JlLnNldHRpbmdzLmF1dG9IZWlnaHRDbGFzcyk7DQoJfTsNCg0KCUF1dG9IZWlnaHQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsNCgkJdmFyIGhhbmRsZXIsIHByb3BlcnR5Ow0KDQoJCWZvciAoaGFuZGxlciBpbiB0aGlzLl9oYW5kbGVycykgew0KCQkJdGhpcy5fY29yZS4kZWxlbWVudC5vZmYoaGFuZGxlciwgdGhpcy5faGFuZGxlcnNbaGFuZGxlcl0pOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPT0gJ2Z1bmN0aW9uJyAmJiAodGhpc1twcm9wZXJ0eV0gPSBudWxsKTsNCgkJfQ0KCX07DQoNCgkkLmZuLm93bENhcm91c2VsLkNvbnN0cnVjdG9yLlBsdWdpbnMuQXV0b0hlaWdodCA9IEF1dG9IZWlnaHQ7DQoNCn0pKHdpbmRvdy5aZXB0byB8fCB3aW5kb3cualF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50KTsNCg0KLyoqDQogKiBWaWRlbyBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEJhcnRvc3ogV29qY2llY2hvd3NraQ0KICogQGF1dGhvciBEYXZpZCBEZXV0c2NoDQogKiBAbGljZW5zZSBUaGUgTUlUIExpY2Vuc2UgKE1JVCkNCiAqLw0KOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsNCg0KCS8qKg0KCSAqIENyZWF0ZXMgdGhlIHZpZGVvIHBsdWdpbi4NCgkgKiBAY2xhc3MgVGhlIFZpZGVvIFBsdWdpbg0KCSAqIEBwYXJhbSB7T3dsfSBjYXJvdXNlbCAtIFRoZSBPd2wgQ2Fyb3VzZWwNCgkgKi8NCgl2YXIgVmlkZW8gPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KCQkvKioNCgkJICogUmVmZXJlbmNlIHRvIHRoZSBjb3JlLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPd2x9DQoJCSAqLw0KCQl0aGlzLl9jb3JlID0gY2Fyb3VzZWw7DQoNCgkJLyoqDQoJCSAqIENhY2hlIGFsbCB2aWRlbyBVUkxzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl92aWRlb3MgPSB7fTsNCg0KCQkvKioNCgkJICogQ3VycmVudCBwbGF5aW5nIGl0ZW0uDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge2pRdWVyeX0NCgkJICovDQoJCXRoaXMuX3BsYXlpbmcgPSBudWxsOw0KDQoJCS8qKg0KCQkgKiBBbGwgZXZlbnQgaGFuZGxlcnMuDQoJCSAqIEB0b2RvIFRoZSBjbG9uZWQgY29udGVudCByZW1vdmFsZSBpcyB0b28gbGF0ZQ0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9oYW5kbGVycyA9IHsNCgkJCSdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UpIHsNCgkJCQkJdGhpcy5fY29yZS5yZWdpc3Rlcih7IHR5cGU6ICdzdGF0ZScsIG5hbWU6ICdwbGF5aW5nJywgdGFnczogWyAnaW50ZXJhY3RpbmcnIF0gfSk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkncmVzaXplLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9jb3JlLnNldHRpbmdzLnZpZGVvICYmIHRoaXMuaXNJbkZ1bGxTY3JlZW4oKSkgew0KCQkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkncmVmcmVzaGVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9jb3JlLmlzKCdyZXNpemluZycpKSB7DQoJCQkJCXRoaXMuX2NvcmUuJHN0YWdlLmZpbmQoJy5jbG9uZWQgLm93bC12aWRlby1mcmFtZScpLnJlbW92ZSgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ2NoYW5nZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIGUucHJvcGVydHkubmFtZSA9PT0gJ3Bvc2l0aW9uJyAmJiB0aGlzLl9wbGF5aW5nKSB7DQoJCQkJCXRoaXMuc3RvcCgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ3ByZXBhcmVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmICghZS5uYW1lc3BhY2UpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCXZhciAkZWxlbWVudCA9ICQoZS5jb250ZW50KS5maW5kKCcub3dsLXZpZGVvJyk7DQoNCgkJCQlpZiAoJGVsZW1lbnQubGVuZ3RoKSB7DQoJCQkJCSRlbGVtZW50LmNzcygnZGlzcGxheScsICdub25lJyk7DQoJCQkJCXRoaXMuZmV0Y2goJGVsZW1lbnQsICQoZS5jb250ZW50KSk7DQoJCQkJfQ0KCQkJfSwgdGhpcykNCgkJfTsNCg0KCQkvLyBzZXQgZGVmYXVsdCBvcHRpb25zDQoJCXRoaXMuX2NvcmUub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBWaWRlby5EZWZhdWx0cywgdGhpcy5fY29yZS5vcHRpb25zKTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBoYW5kbGVycw0KCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCg0KCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9uKCdjbGljay5vd2wudmlkZW8nLCAnLm93bC12aWRlby1wbGF5LWljb24nLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCXRoaXMucGxheShlKTsNCgkJfSwgdGhpcykpOw0KCX07DQoNCgkvKioNCgkgKiBEZWZhdWx0IG9wdGlvbnMuDQoJICogQHB1YmxpYw0KCSAqLw0KCVZpZGVvLkRlZmF1bHRzID0gew0KCQl2aWRlbzogZmFsc2UsDQoJCXZpZGVvSGVpZ2h0OiBmYWxzZSwNCgkJdmlkZW9XaWR0aDogZmFsc2UNCgl9Ow0KDQoJLyoqDQoJICogR2V0cyB0aGUgdmlkZW8gSUQgYW5kIHRoZSB0eXBlIChZb3VUdWJlL1ZpbWVvL3Z6YWFyIG9ubHkpLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge2pRdWVyeX0gdGFyZ2V0IC0gVGhlIHRhcmdldCBjb250YWluaW5nIHRoZSB2aWRlbyBkYXRhLg0KCSAqIEBwYXJhbSB7alF1ZXJ5fSBpdGVtIC0gVGhlIGl0ZW0gY29udGFpbmluZyB0aGUgdmlkZW8uDQoJICovDQoJVmlkZW8ucHJvdG90eXBlLmZldGNoID0gZnVuY3Rpb24odGFyZ2V0LCBpdGVtKSB7DQoJCQl2YXIgdHlwZSA9IChmdW5jdGlvbigpIHsNCgkJCQkJaWYgKHRhcmdldC5hdHRyKCdkYXRhLXZpbWVvLWlkJykpIHsNCgkJCQkJCXJldHVybiAndmltZW8nOw0KCQkJCQl9IGVsc2UgaWYgKHRhcmdldC5hdHRyKCdkYXRhLXZ6YWFyLWlkJykpIHsNCgkJCQkJCXJldHVybiAndnphYXInDQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZXR1cm4gJ3lvdXR1YmUnOw0KCQkJCQl9DQoJCQkJfSkoKSwNCgkJCQlpZCA9IHRhcmdldC5hdHRyKCdkYXRhLXZpbWVvLWlkJykgfHwgdGFyZ2V0LmF0dHIoJ2RhdGEteW91dHViZS1pZCcpIHx8IHRhcmdldC5hdHRyKCdkYXRhLXZ6YWFyLWlkJyksDQoJCQkJd2lkdGggPSB0YXJnZXQuYXR0cignZGF0YS13aWR0aCcpIHx8IHRoaXMuX2NvcmUuc2V0dGluZ3MudmlkZW9XaWR0aCwNCgkJCQloZWlnaHQgPSB0YXJnZXQuYXR0cignZGF0YS1oZWlnaHQnKSB8fCB0aGlzLl9jb3JlLnNldHRpbmdzLnZpZGVvSGVpZ2h0LA0KCQkJCXVybCA9IHRhcmdldC5hdHRyKCdocmVmJyk7DQoNCgkJaWYgKHVybCkgew0KDQoJCQkvKg0KCQkJCQlQYXJzZXMgdGhlIGlkJ3Mgb3V0IG9mIHRoZSBmb2xsb3dpbmcgdXJscyAoYW5kIHByb2JhYmx5IG1vcmUpOg0KCQkJCQlodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PTppZA0KCQkJCQlodHRwczovL3lvdXR1LmJlLzppZA0KCQkJCQlodHRwczovL3ZpbWVvLmNvbS86aWQNCgkJCQkJaHR0cHM6Ly92aW1lby5jb20vY2hhbm5lbHMvOmNoYW5uZWwvOmlkDQoJCQkJCWh0dHBzOi8vdmltZW8uY29tL2dyb3Vwcy86Z3JvdXAvdmlkZW9zLzppZA0KCQkJCQlodHRwczovL2FwcC52emFhci5jb20vdmlkZW9zLzppZA0KDQoJCQkJCVZpc3VhbCBleGFtcGxlOiBodHRwczovL3JlZ2V4cGVyLmNvbS8jKGh0dHAlM0ElN0NodHRwcyUzQSU3QyklNUMlMkYlNUMlMkYocGxheWVyLiU3Q3d3dy4lN0NhcHAuKSUzRih2aW1lbyU1Qy5jb20lN0N5b3V0dShiZSU1Qy5jb20lN0MlNUMuYmUlN0NiZSU1Qy5nb29nbGVhcGlzJTVDLmNvbSklN0N2emFhciU1Qy5jb20pJTVDJTJGKHZpZGVvJTVDJTJGJTdDdmlkZW9zJTVDJTJGJTdDZW1iZWQlNUMlMkYlN0NjaGFubmVscyU1QyUyRi4lMkIlNUMlMkYlN0Nncm91cHMlNUMlMkYuJTJCJTVDJTJGJTdDd2F0Y2glNUMlM0Z2JTNEJTdDdiU1QyUyRiklM0YoJTVCQS1aYS16MC05Ll8lMjUtJTVEKikoJTVDJTI2JTVDUyUyQiklM0YNCgkJCSovDQoNCgkJCWlkID0gdXJsLm1hdGNoKC8oaHR0cDp8aHR0cHM6fClcL1wvKHBsYXllci58d3d3LnxhcHAuKT8odmltZW9cLmNvbXx5b3V0dShiZVwuY29tfFwuYmV8YmVcLmdvb2dsZWFwaXNcLmNvbXxiZVwtbm9jb29raWVcLmNvbSl8dnphYXJcLmNvbSlcLyh2aWRlb1wvfHZpZGVvc1wvfGVtYmVkXC98Y2hhbm5lbHNcLy4rXC98Z3JvdXBzXC8uK1wvfHdhdGNoXD92PXx2XC8pPyhbQS1aYS16MC05Ll8lLV0qKShcJlxTKyk/Lyk7DQoNCgkJCWlmIChpZFszXS5pbmRleE9mKCd5b3V0dScpID4gLTEpIHsNCgkJCQl0eXBlID0gJ3lvdXR1YmUnOw0KCQkJfSBlbHNlIGlmIChpZFszXS5pbmRleE9mKCd2aW1lbycpID4gLTEpIHsNCgkJCQl0eXBlID0gJ3ZpbWVvJzsNCgkJCX0gZWxzZSBpZiAoaWRbM10uaW5kZXhPZigndnphYXInKSA+IC0xKSB7DQoJCQkJdHlwZSA9ICd2emFhcic7DQoJCQl9IGVsc2Ugew0KCQkJCXRocm93IG5ldyBFcnJvcignVmlkZW8gVVJMIG5vdCBzdXBwb3J0ZWQuJyk7DQoJCQl9DQoJCQlpZCA9IGlkWzZdOw0KCQl9IGVsc2Ugew0KCQkJdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHZpZGVvIFVSTC4nKTsNCgkJfQ0KDQoJCXRoaXMuX3ZpZGVvc1t1cmxdID0gew0KCQkJdHlwZTogdHlwZSwNCgkJCWlkOiBpZCwNCgkJCXdpZHRoOiB3aWR0aCwNCgkJCWhlaWdodDogaGVpZ2h0DQoJCX07DQoNCgkJaXRlbS5hdHRyKCdkYXRhLXZpZGVvJywgdXJsKTsNCg0KCQl0aGlzLnRodW1ibmFpbCh0YXJnZXQsIHRoaXMuX3ZpZGVvc1t1cmxdKTsNCgl9Ow0KDQoJLyoqDQoJICogQ3JlYXRlcyB2aWRlbyB0aHVtYm5haWwuDQoJICogQHByb3RlY3RlZA0KCSAqIEBwYXJhbSB7alF1ZXJ5fSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGNvbnRhaW5pbmcgdGhlIHZpZGVvIGRhdGEuDQoJICogQHBhcmFtIHtPYmplY3R9IGluZm8gLSBUaGUgdmlkZW8gaW5mbyBvYmplY3QuDQoJICogQHNlZSBgZmV0Y2hgDQoJICovDQoJVmlkZW8ucHJvdG90eXBlLnRodW1ibmFpbCA9IGZ1bmN0aW9uKHRhcmdldCwgdmlkZW8pIHsNCgkJdmFyIHRuTGluaywNCgkJCWljb24sDQoJCQlwYXRoLA0KCQkJZGltZW5zaW9ucyA9IHZpZGVvLndpZHRoICYmIHZpZGVvLmhlaWdodCA/ICd3aWR0aDonICsgdmlkZW8ud2lkdGggKyAncHg7aGVpZ2h0OicgKyB2aWRlby5oZWlnaHQgKyAncHg7JyA6ICcnLA0KCQkJY3VzdG9tVG4gPSB0YXJnZXQuZmluZCgnaW1nJyksDQoJCQlzcmNUeXBlID0gJ3NyYycsDQoJCQlsYXp5Q2xhc3MgPSAnJywNCgkJCXNldHRpbmdzID0gdGhpcy5fY29yZS5zZXR0aW5ncywNCgkJCWNyZWF0ZSA9IGZ1bmN0aW9uKHBhdGgpIHsNCgkJCQlpY29uID0gJzxkaXYgY2xhc3M9Im93bC12aWRlby1wbGF5LWljb24iPjwvZGl2Pic7DQoNCgkJCQlpZiAoc2V0dGluZ3MubGF6eUxvYWQpIHsNCgkJCQkJdG5MaW5rID0gJCgnPGRpdi8+Jyx7DQoJCQkJCQkiY2xhc3MiOiAnb3dsLXZpZGVvLXRuICcgKyBsYXp5Q2xhc3MsDQoJCQkJCQkic3JjVHlwZSI6IHBhdGgNCgkJCQkJfSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdG5MaW5rID0gJCggJzxkaXYvPicsIHsNCgkJCQkJCSJjbGFzcyI6ICJvd2wtdmlkZW8tdG4iLA0KCQkJCQkJInN0eWxlIjogJ29wYWNpdHk6MTtiYWNrZ3JvdW5kLWltYWdlOnVybCgnICsgcGF0aCArICcpJw0KCQkJCQl9KTsNCgkJCQl9DQoJCQkJdGFyZ2V0LmFmdGVyKHRuTGluayk7DQoJCQkJdGFyZ2V0LmFmdGVyKGljb24pOw0KCQkJfTsNCg0KCQkvLyB3cmFwIHZpZGVvIGNvbnRlbnQgaW50byBvd2wtdmlkZW8td3JhcHBlciBkaXYNCgkJdGFyZ2V0LndyYXAoICQoICc8ZGl2Lz4nLCB7DQoJCQkiY2xhc3MiOiAib3dsLXZpZGVvLXdyYXBwZXIiLA0KCQkJInN0eWxlIjogZGltZW5zaW9ucw0KCQl9KSk7DQoNCgkJaWYgKHRoaXMuX2NvcmUuc2V0dGluZ3MubGF6eUxvYWQpIHsNCgkJCXNyY1R5cGUgPSAnZGF0YS1zcmMnOw0KCQkJbGF6eUNsYXNzID0gJ293bC1sYXp5JzsNCgkJfQ0KDQoJCS8vIGN1c3RvbSB0aHVtYm5haWwNCgkJaWYgKGN1c3RvbVRuLmxlbmd0aCkgew0KCQkJY3JlYXRlKGN1c3RvbVRuLmF0dHIoc3JjVHlwZSkpOw0KCQkJY3VzdG9tVG4ucmVtb3ZlKCk7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQlpZiAodmlkZW8udHlwZSA9PT0gJ3lvdXR1YmUnKSB7DQoJCQlwYXRoID0gIi8vaW1nLnlvdXR1YmUuY29tL3ZpLyIgKyB2aWRlby5pZCArICIvaHFkZWZhdWx0LmpwZyI7DQoJCQljcmVhdGUocGF0aCk7DQoJCX0gZWxzZSBpZiAodmlkZW8udHlwZSA9PT0gJ3ZpbWVvJykgew0KCQkJJC5hamF4KHsNCgkJCQl0eXBlOiAnR0VUJywNCgkJCQl1cmw6ICcvL3ZpbWVvLmNvbS9hcGkvdjIvdmlkZW8vJyArIHZpZGVvLmlkICsgJy5qc29uJywNCgkJCQlqc29ucDogJ2NhbGxiYWNrJywNCgkJCQlkYXRhVHlwZTogJ2pzb25wJywNCgkJCQlzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7DQoJCQkJCXBhdGggPSBkYXRhWzBdLnRodW1ibmFpbF9sYXJnZTsNCgkJCQkJY3JlYXRlKHBhdGgpOw0KCQkJCX0NCgkJCX0pOw0KCQl9IGVsc2UgaWYgKHZpZGVvLnR5cGUgPT09ICd2emFhcicpIHsNCgkJCSQuYWpheCh7DQoJCQkJdHlwZTogJ0dFVCcsDQoJCQkJdXJsOiAnLy92emFhci5jb20vYXBpL3ZpZGVvcy8nICsgdmlkZW8uaWQgKyAnLmpzb24nLA0KCQkJCWpzb25wOiAnY2FsbGJhY2snLA0KCQkJCWRhdGFUeXBlOiAnanNvbnAnLA0KCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsNCgkJCQkJcGF0aCA9IGRhdGEuZnJhbWVncmFiX3VybDsNCgkJCQkJY3JlYXRlKHBhdGgpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFN0b3BzIHRoZSBjdXJyZW50IHZpZGVvLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglWaWRlby5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKCkgew0KCQl0aGlzLl9jb3JlLnRyaWdnZXIoJ3N0b3AnLCBudWxsLCAndmlkZW8nKTsNCgkJdGhpcy5fcGxheWluZy5maW5kKCcub3dsLXZpZGVvLWZyYW1lJykucmVtb3ZlKCk7DQoJCXRoaXMuX3BsYXlpbmcucmVtb3ZlQ2xhc3MoJ293bC12aWRlby1wbGF5aW5nJyk7DQoJCXRoaXMuX3BsYXlpbmcgPSBudWxsOw0KCQl0aGlzLl9jb3JlLmxlYXZlKCdwbGF5aW5nJyk7DQoJCXRoaXMuX2NvcmUudHJpZ2dlcignc3RvcHBlZCcsIG51bGwsICd2aWRlbycpOw0KCX07DQoNCgkvKioNCgkgKiBTdGFydHMgdGhlIGN1cnJlbnQgdmlkZW8uDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IC0gVGhlIGV2ZW50IGFyZ3VtZW50cy4NCgkgKi8NCglWaWRlby5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCXZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCksDQoJCQlpdGVtID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgdGhpcy5fY29yZS5zZXR0aW5ncy5pdGVtQ2xhc3MpLA0KCQkJdmlkZW8gPSB0aGlzLl92aWRlb3NbaXRlbS5hdHRyKCdkYXRhLXZpZGVvJyldLA0KCQkJd2lkdGggPSB2aWRlby53aWR0aCB8fCAnMTAwJScsDQoJCQloZWlnaHQgPSB2aWRlby5oZWlnaHQgfHwgdGhpcy5fY29yZS4kc3RhZ2UuaGVpZ2h0KCksDQoJCQlodG1sLA0KCQkJaWZyYW1lOw0KDQoJCWlmICh0aGlzLl9wbGF5aW5nKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl0aGlzLl9jb3JlLmVudGVyKCdwbGF5aW5nJyk7DQoJCXRoaXMuX2NvcmUudHJpZ2dlcigncGxheScsIG51bGwsICd2aWRlbycpOw0KDQoJCWl0ZW0gPSB0aGlzLl9jb3JlLml0ZW1zKHRoaXMuX2NvcmUucmVsYXRpdmUoaXRlbS5pbmRleCgpKSk7DQoNCgkJdGhpcy5fY29yZS5yZXNldChpdGVtLmluZGV4KCkpOw0KDQoJCWh0bWwgPSAkKCAnPGlmcmFtZSBmcmFtZWJvcmRlcj0iMCIgYWxsb3dmdWxsc2NyZWVuIG1vemFsbG93ZnVsbHNjcmVlbiB3ZWJraXRBbGxvd0Z1bGxTY3JlZW4gPjwvaWZyYW1lPicgKTsNCgkJaHRtbC5hdHRyKCAnaGVpZ2h0JywgaGVpZ2h0ICk7DQoJCWh0bWwuYXR0ciggJ3dpZHRoJywgd2lkdGggKTsNCgkJaWYgKHZpZGVvLnR5cGUgPT09ICd5b3V0dWJlJykgew0KCQkJaHRtbC5hdHRyKCAnc3JjJywgJy8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLycgKyB2aWRlby5pZCArICc/YXV0b3BsYXk9MSZyZWw9MCZ2PScgKyB2aWRlby5pZCApOw0KCQl9IGVsc2UgaWYgKHZpZGVvLnR5cGUgPT09ICd2aW1lbycpIHsNCgkJCWh0bWwuYXR0ciggJ3NyYycsICcvL3BsYXllci52aW1lby5jb20vdmlkZW8vJyArIHZpZGVvLmlkICsgJz9hdXRvcGxheT0xJyApOw0KCQl9IGVsc2UgaWYgKHZpZGVvLnR5cGUgPT09ICd2emFhcicpIHsNCgkJCWh0bWwuYXR0ciggJ3NyYycsICcvL3ZpZXcudnphYXIuY29tLycgKyB2aWRlby5pZCArICcvcGxheWVyP2F1dG9wbGF5PXRydWUnICk7DQoJCX0NCg0KCQlpZnJhbWUgPSAkKGh0bWwpLndyYXAoICc8ZGl2IGNsYXNzPSJvd2wtdmlkZW8tZnJhbWUiIC8+JyApLmluc2VydEFmdGVyKGl0ZW0uZmluZCgnLm93bC12aWRlbycpKTsNCg0KCQl0aGlzLl9wbGF5aW5nID0gaXRlbS5hZGRDbGFzcygnb3dsLXZpZGVvLXBsYXlpbmcnKTsNCgl9Ow0KDQoJLyoqDQoJICogQ2hlY2tzIHdoZXRoZXIgYW4gdmlkZW8gaXMgY3VycmVudGx5IGluIGZ1bGwgc2NyZWVuIG1vZGUgb3Igbm90Lg0KCSAqIEB0b2RvIEJhZCBzdHlsZSBiZWNhdXNlIGxvb2tzIGxpa2UgYSByZWFkb25seSBtZXRob2QgYnV0IGNoYW5nZXMgbWVtYmVycy4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHJldHVybnMge0Jvb2xlYW59DQoJICovDQoJVmlkZW8ucHJvdG90eXBlLmlzSW5GdWxsU2NyZWVuID0gZnVuY3Rpb24oKSB7DQoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQgfHwgZG9jdW1lbnQubW96RnVsbFNjcmVlbkVsZW1lbnQgfHwNCgkJCQlkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudDsNCg0KCQlyZXR1cm4gZWxlbWVudCAmJiAkKGVsZW1lbnQpLnBhcmVudCgpLmhhc0NsYXNzKCdvd2wtdmlkZW8tZnJhbWUnKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVzdHJveXMgdGhlIHBsdWdpbi4NCgkgKi8NCglWaWRlby5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgaGFuZGxlciwgcHJvcGVydHk7DQoNCgkJdGhpcy5fY29yZS4kZWxlbWVudC5vZmYoJ2NsaWNrLm93bC52aWRlbycpOw0KDQoJCWZvciAoaGFuZGxlciBpbiB0aGlzLl9oYW5kbGVycykgew0KCQkJdGhpcy5fY29yZS4kZWxlbWVudC5vZmYoaGFuZGxlciwgdGhpcy5faGFuZGxlcnNbaGFuZGxlcl0pOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPSAnZnVuY3Rpb24nICYmICh0aGlzW3Byb3BlcnR5XSA9IG51bGwpOw0KCQl9DQoJfTsNCg0KCSQuZm4ub3dsQ2Fyb3VzZWwuQ29uc3RydWN0b3IuUGx1Z2lucy5WaWRlbyA9IFZpZGVvOw0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7DQoNCi8qKg0KICogQW5pbWF0ZSBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEJhcnRvc3ogV29qY2llY2hvd3NraQ0KICogQGF1dGhvciBEYXZpZCBEZXV0c2NoDQogKiBAbGljZW5zZSBUaGUgTUlUIExpY2Vuc2UgKE1JVCkNCiAqLw0KOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsNCg0KCS8qKg0KCSAqIENyZWF0ZXMgdGhlIGFuaW1hdGUgcGx1Z2luLg0KCSAqIEBjbGFzcyBUaGUgTmF2aWdhdGlvbiBQbHVnaW4NCgkgKiBAcGFyYW0ge093bH0gc2NvcGUgLSBUaGUgT3dsIENhcm91c2VsDQoJICovDQoJdmFyIEFuaW1hdGUgPSBmdW5jdGlvbihzY29wZSkgew0KCQl0aGlzLmNvcmUgPSBzY29wZTsNCgkJdGhpcy5jb3JlLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQW5pbWF0ZS5EZWZhdWx0cywgdGhpcy5jb3JlLm9wdGlvbnMpOw0KCQl0aGlzLnN3YXBwaW5nID0gdHJ1ZTsNCgkJdGhpcy5wcmV2aW91cyA9IHVuZGVmaW5lZDsNCgkJdGhpcy5uZXh0ID0gdW5kZWZpbmVkOw0KDQoJCXRoaXMuaGFuZGxlcnMgPSB7DQoJCQknY2hhbmdlLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiBlLnByb3BlcnR5Lm5hbWUgPT0gJ3Bvc2l0aW9uJykgew0KCQkJCQl0aGlzLnByZXZpb3VzID0gdGhpcy5jb3JlLmN1cnJlbnQoKTsNCgkJCQkJdGhpcy5uZXh0ID0gZS5wcm9wZXJ0eS52YWx1ZTsNCgkJCQl9DQoJCQl9LCB0aGlzKSwNCgkJCSdkcmFnLm93bC5jYXJvdXNlbCBkcmFnZ2VkLm93bC5jYXJvdXNlbCB0cmFuc2xhdGVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSkgew0KCQkJCQl0aGlzLnN3YXBwaW5nID0gZS50eXBlID09ICd0cmFuc2xhdGVkJzsNCgkJCQl9DQoJCQl9LCB0aGlzKSwNCgkJCSd0cmFuc2xhdGUub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIHRoaXMuc3dhcHBpbmcgJiYgKHRoaXMuY29yZS5vcHRpb25zLmFuaW1hdGVPdXQgfHwgdGhpcy5jb3JlLm9wdGlvbnMuYW5pbWF0ZUluKSkgew0KCQkJCQl0aGlzLnN3YXAoKTsNCgkJCQl9DQoJCQl9LCB0aGlzKQ0KCQl9Ow0KDQoJCXRoaXMuY29yZS4kZWxlbWVudC5vbih0aGlzLmhhbmRsZXJzKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglBbmltYXRlLkRlZmF1bHRzID0gew0KCQlhbmltYXRlT3V0OiBmYWxzZSwNCgkJYW5pbWF0ZUluOiBmYWxzZQ0KCX07DQoNCgkvKioNCgkgKiBUb2dnbGVzIHRoZSBhbmltYXRpb24gY2xhc3NlcyB3aGVuZXZlciBhbiB0cmFuc2xhdGlvbnMgc3RhcnRzLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcmV0dXJucyB7Qm9vbGVhbnx1bmRlZmluZWR9DQoJICovDQoJQW5pbWF0ZS5wcm90b3R5cGUuc3dhcCA9IGZ1bmN0aW9uKCkgew0KDQoJCWlmICh0aGlzLmNvcmUuc2V0dGluZ3MuaXRlbXMgIT09IDEpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWlmICghJC5zdXBwb3J0LmFuaW1hdGlvbiB8fCAhJC5zdXBwb3J0LnRyYW5zaXRpb24pIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXRoaXMuY29yZS5zcGVlZCgwKTsNCg0KCQl2YXIgbGVmdCwNCgkJCWNsZWFyID0gJC5wcm94eSh0aGlzLmNsZWFyLCB0aGlzKSwNCgkJCXByZXZpb3VzID0gdGhpcy5jb3JlLiRzdGFnZS5jaGlsZHJlbigpLmVxKHRoaXMucHJldmlvdXMpLA0KCQkJbmV4dCA9IHRoaXMuY29yZS4kc3RhZ2UuY2hpbGRyZW4oKS5lcSh0aGlzLm5leHQpLA0KCQkJaW5jb21pbmcgPSB0aGlzLmNvcmUuc2V0dGluZ3MuYW5pbWF0ZUluLA0KCQkJb3V0Z29pbmcgPSB0aGlzLmNvcmUuc2V0dGluZ3MuYW5pbWF0ZU91dDsNCg0KCQlpZiAodGhpcy5jb3JlLmN1cnJlbnQoKSA9PT0gdGhpcy5wcmV2aW91cykgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJaWYgKG91dGdvaW5nKSB7DQoJCQlsZWZ0ID0gdGhpcy5jb3JlLmNvb3JkaW5hdGVzKHRoaXMucHJldmlvdXMpIC0gdGhpcy5jb3JlLmNvb3JkaW5hdGVzKHRoaXMubmV4dCk7DQoJCQlwcmV2aW91cy5vbmUoJC5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGNsZWFyKQ0KCQkJCS5jc3MoIHsgJ2xlZnQnOiBsZWZ0ICsgJ3B4JyB9ICkNCgkJCQkuYWRkQ2xhc3MoJ2FuaW1hdGVkIG93bC1hbmltYXRlZC1vdXQnKQ0KCQkJCS5hZGRDbGFzcyhvdXRnb2luZyk7DQoJCX0NCg0KCQlpZiAoaW5jb21pbmcpIHsNCgkJCW5leHQub25lKCQuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBjbGVhcikNCgkJCQkuYWRkQ2xhc3MoJ2FuaW1hdGVkIG93bC1hbmltYXRlZC1pbicpDQoJCQkJLmFkZENsYXNzKGluY29taW5nKTsNCgkJfQ0KCX07DQoNCglBbmltYXRlLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKGUpIHsNCgkJJChlLnRhcmdldCkuY3NzKCB7ICdsZWZ0JzogJycgfSApDQoJCQkucmVtb3ZlQ2xhc3MoJ2FuaW1hdGVkIG93bC1hbmltYXRlZC1vdXQgb3dsLWFuaW1hdGVkLWluJykNCgkJCS5yZW1vdmVDbGFzcyh0aGlzLmNvcmUuc2V0dGluZ3MuYW5pbWF0ZUluKQ0KCQkJLnJlbW92ZUNsYXNzKHRoaXMuY29yZS5zZXR0aW5ncy5hbmltYXRlT3V0KTsNCgkJdGhpcy5jb3JlLm9uVHJhbnNpdGlvbkVuZCgpOw0KCX07DQoNCgkvKioNCgkgKiBEZXN0cm95cyB0aGUgcGx1Z2luLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglBbmltYXRlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7DQoJCXZhciBoYW5kbGVyLCBwcm9wZXJ0eTsNCg0KCQlmb3IgKGhhbmRsZXIgaW4gdGhpcy5oYW5kbGVycykgew0KCQkJdGhpcy5jb3JlLiRlbGVtZW50Lm9mZihoYW5kbGVyLCB0aGlzLmhhbmRsZXJzW2hhbmRsZXJdKTsNCgkJfQ0KCQlmb3IgKHByb3BlcnR5IGluIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7DQoJCQl0eXBlb2YgdGhpc1twcm9wZXJ0eV0gIT0gJ2Z1bmN0aW9uJyAmJiAodGhpc1twcm9wZXJ0eV0gPSBudWxsKTsNCgkJfQ0KCX07DQoNCgkkLmZuLm93bENhcm91c2VsLkNvbnN0cnVjdG9yLlBsdWdpbnMuQW5pbWF0ZSA9IEFuaW1hdGU7DQoNCn0pKHdpbmRvdy5aZXB0byB8fCB3aW5kb3cualF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50KTsNCg0KLyoqDQogKiBBdXRvcGxheSBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEJhcnRvc3ogV29qY2llY2hvd3NraQ0KICogQGF1dGhvciBBcnR1cyBLb2xhbm93c2tpDQogKiBAYXV0aG9yIERhdmlkIERldXRzY2gNCiAqIEBhdXRob3IgVG9tIERlIENhbHV3w6kNCiAqIEBsaWNlbnNlIFRoZSBNSVQgTGljZW5zZSAoTUlUKQ0KICovDQo7KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgew0KDQoJLyoqDQoJICogQ3JlYXRlcyB0aGUgYXV0b3BsYXkgcGx1Z2luLg0KCSAqIEBjbGFzcyBUaGUgQXV0b3BsYXkgUGx1Z2luDQoJICogQHBhcmFtIHtPd2x9IHNjb3BlIC0gVGhlIE93bCBDYXJvdXNlbA0KCSAqLw0KCXZhciBBdXRvcGxheSA9IGZ1bmN0aW9uKGNhcm91c2VsKSB7DQoJCS8qKg0KCQkgKiBSZWZlcmVuY2UgdG8gdGhlIGNvcmUuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge093bH0NCgkJICovDQoJCXRoaXMuX2NvcmUgPSBjYXJvdXNlbDsNCg0KCQkvKioNCgkJICogVGhlIGF1dG9wbGF5IHRpbWVvdXQgaWQuDQoJCSAqIEB0eXBlIHtOdW1iZXJ9DQoJCSAqLw0KCQl0aGlzLl9jYWxsID0gbnVsbDsNCg0KCQkvKioNCgkJICogRGVwZW5kaW5nIG9uIHRoZSBzdGF0ZSBvZiB0aGUgcGx1Z2luLCB0aGlzIHZhcmlhYmxlIGNvbnRhaW5zIGVpdGhlcg0KCQkgKiB0aGUgc3RhcnQgdGltZSBvZiB0aGUgdGltZXIgb3IgdGhlIGN1cnJlbnQgdGltZXIgdmFsdWUgaWYgaXQncw0KCQkgKiBwYXVzZWQuIFNpbmNlIHdlIHN0YXJ0IGluIGEgcGF1c2VkIHN0YXRlIHdlIGluaXRpYWxpemUgdGhlIHRpbWVyDQoJCSAqIHZhbHVlLg0KCQkgKiBAdHlwZSB7TnVtYmVyfQ0KCQkgKi8NCgkJdGhpcy5fdGltZSA9IDA7DQoNCgkJLyoqDQoJCSAqIFN0b3JlcyB0aGUgdGltZW91dCBjdXJyZW50bHkgdXNlZC4NCgkJICogQHR5cGUge051bWJlcn0NCgkJICovDQoJCXRoaXMuX3RpbWVvdXQgPSAwOw0KDQoJCS8qKg0KCQkgKiBJbmRpY2F0ZXMgd2hlbmV2ZXIgdGhlIGF1dG9wbGF5IGlzIHBhdXNlZC4NCgkJICogQHR5cGUge0Jvb2xlYW59DQoJCSAqLw0KCQl0aGlzLl9wYXVzZWQgPSB0cnVlOw0KDQoJCS8qKg0KCQkgKiBBbGwgZXZlbnQgaGFuZGxlcnMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge09iamVjdH0NCgkJICovDQoJCXRoaXMuX2hhbmRsZXJzID0gew0KCQkJJ2NoYW5nZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIGUucHJvcGVydHkubmFtZSA9PT0gJ3NldHRpbmdzJykgew0KCQkJCQlpZiAodGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvcGxheSkgew0KCQkJCQkJdGhpcy5wbGF5KCk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLnN0b3AoKTsNCgkJCQkJfQ0KCQkJCX0gZWxzZSBpZiAoZS5uYW1lc3BhY2UgJiYgZS5wcm9wZXJ0eS5uYW1lID09PSAncG9zaXRpb24nICYmIHRoaXMuX3BhdXNlZCkgew0KCQkJCQkvLyBSZXNldCB0aGUgdGltZXIuIFRoaXMgY29kZSBpcyB0cmlnZ2VyZWQgd2hlbiB0aGUgcG9zaXRpb24NCgkJCQkJLy8gb2YgdGhlIGNhcm91c2VsIHdhcyBjaGFuZ2VkIHRocm91Z2ggdXNlciBpbnRlcmFjdGlvbi4NCgkJCQkJdGhpcy5fdGltZSA9IDA7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQknaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b3BsYXkpIHsNCgkJCQkJdGhpcy5wbGF5KCk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkncGxheS5vd2wuYXV0b3BsYXknOiAkLnByb3h5KGZ1bmN0aW9uKGUsIHQsIHMpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UpIHsNCgkJCQkJdGhpcy5wbGF5KHQsIHMpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ3N0b3Aub3dsLmF1dG9wbGF5JzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlKSB7DQoJCQkJCXRoaXMuc3RvcCgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ21vdXNlb3Zlci5vd2wuYXV0b3BsYXknOiAkLnByb3h5KGZ1bmN0aW9uKCkgew0KCQkJCWlmICh0aGlzLl9jb3JlLnNldHRpbmdzLmF1dG9wbGF5SG92ZXJQYXVzZSAmJiB0aGlzLl9jb3JlLmlzKCdyb3RhdGluZycpKSB7DQoJCQkJCXRoaXMucGF1c2UoKTsNCgkJCQl9DQoJCQl9LCB0aGlzKSwNCgkJCSdtb3VzZWxlYXZlLm93bC5hdXRvcGxheSc6ICQucHJveHkoZnVuY3Rpb24oKSB7DQoJCQkJaWYgKHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b3BsYXlIb3ZlclBhdXNlICYmIHRoaXMuX2NvcmUuaXMoJ3JvdGF0aW5nJykpIHsNCgkJCQkJdGhpcy5wbGF5KCk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkndG91Y2hzdGFydC5vd2wuY29yZSc6ICQucHJveHkoZnVuY3Rpb24oKSB7DQoJCQkJaWYgKHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b3BsYXlIb3ZlclBhdXNlICYmIHRoaXMuX2NvcmUuaXMoJ3JvdGF0aW5nJykpIHsNCgkJCQkJdGhpcy5wYXVzZSgpOw0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ3RvdWNoZW5kLm93bC5jb3JlJzogJC5wcm94eShmdW5jdGlvbigpIHsNCgkJCQlpZiAodGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvcGxheUhvdmVyUGF1c2UpIHsNCgkJCQkJdGhpcy5wbGF5KCk7DQoJCQkJfQ0KCQkJfSwgdGhpcykNCgkJfTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBoYW5kbGVycw0KCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCg0KCQkvLyBzZXQgZGVmYXVsdCBvcHRpb25zDQoJCXRoaXMuX2NvcmUub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBBdXRvcGxheS5EZWZhdWx0cywgdGhpcy5fY29yZS5vcHRpb25zKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglBdXRvcGxheS5EZWZhdWx0cyA9IHsNCgkJYXV0b3BsYXk6IGZhbHNlLA0KCQlhdXRvcGxheVRpbWVvdXQ6IDUwMDAsDQoJCWF1dG9wbGF5SG92ZXJQYXVzZTogZmFsc2UsDQoJCWF1dG9wbGF5U3BlZWQ6IGZhbHNlDQoJfTsNCg0KCS8qKg0KCSAqIFRyYW5zaXRpb24gdG8gdGhlIG5leHQgc2xpZGUgYW5kIHNldCBhIHRpbWVvdXQgZm9yIHRoZSBuZXh0IHRyYW5zaXRpb24uDQoJICogQHByaXZhdGUNCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSBhbmltYXRpb24gc3BlZWQgZm9yIHRoZSBhbmltYXRpb25zLg0KCSAqLw0KCUF1dG9wbGF5LnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uKHNwZWVkKSB7DQoJCXRoaXMuX2NhbGwgPSB3aW5kb3cuc2V0VGltZW91dCgNCgkJCSQucHJveHkodGhpcy5fbmV4dCwgdGhpcywgc3BlZWQpLA0KCQkJdGhpcy5fdGltZW91dCAqIChNYXRoLnJvdW5kKHRoaXMucmVhZCgpIC8gdGhpcy5fdGltZW91dCkgKyAxKSAtIHRoaXMucmVhZCgpDQoJCSk7DQoNCgkJaWYgKHRoaXMuX2NvcmUuaXMoJ2ludGVyYWN0aW5nJykgfHwgZG9jdW1lbnQuaGlkZGVuKSB7DQoJCQlyZXR1cm47DQoJCX0NCgkJdGhpcy5fY29yZS5uZXh0KHNwZWVkIHx8IHRoaXMuX2NvcmUuc2V0dGluZ3MuYXV0b3BsYXlTcGVlZCk7DQoJfQ0KDQoJLyoqDQoJICogUmVhZHMgdGhlIGN1cnJlbnQgdGltZXIgdmFsdWUgd2hlbiB0aGUgdGltZXIgaXMgcGxheWluZy4NCgkgKiBAcHVibGljDQoJICovDQoJQXV0b3BsYXkucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5fdGltZTsNCgl9Ow0KDQoJLyoqDQoJICogU3RhcnRzIHRoZSBhdXRvcGxheS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IFt0aW1lb3V0XSAtIFRoZSBpbnRlcnZhbCBiZWZvcmUgdGhlIG5leHQgYW5pbWF0aW9uIHN0YXJ0cy4NCgkgKiBAcGFyYW0ge051bWJlcn0gW3NwZWVkXSAtIFRoZSBhbmltYXRpb24gc3BlZWQgZm9yIHRoZSBhbmltYXRpb25zLg0KCSAqLw0KCUF1dG9wbGF5LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24odGltZW91dCwgc3BlZWQpIHsNCgkJdmFyIGVsYXBzZWQ7DQoNCgkJaWYgKCF0aGlzLl9jb3JlLmlzKCdyb3RhdGluZycpKSB7DQoJCQl0aGlzLl9jb3JlLmVudGVyKCdyb3RhdGluZycpOw0KCQl9DQoNCgkJdGltZW91dCA9IHRpbWVvdXQgfHwgdGhpcy5fY29yZS5zZXR0aW5ncy5hdXRvcGxheVRpbWVvdXQ7DQoNCgkJLy8gQ2FsY3VsYXRlIHRoZSBlbGFwc2VkIHRpbWUgc2luY2UgdGhlIGxhc3QgdHJhbnNpdGlvbi4gSWYgdGhlIGNhcm91c2VsDQoJCS8vIHdhc24ndCBwbGF5aW5nIHRoaXMgY2FsY3VsYXRpb24gd2lsbCB5aWVsZCB6ZXJvLg0KCQllbGFwc2VkID0gTWF0aC5taW4odGhpcy5fdGltZSAlICh0aGlzLl90aW1lb3V0IHx8IHRpbWVvdXQpLCB0aW1lb3V0KTsNCg0KCQlpZiAodGhpcy5fcGF1c2VkKSB7DQoJCQkvLyBTdGFydCB0aGUgY2xvY2suDQoJCQl0aGlzLl90aW1lID0gdGhpcy5yZWFkKCk7DQoJCQl0aGlzLl9wYXVzZWQgPSBmYWxzZTsNCgkJfSBlbHNlIHsNCgkJCS8vIENsZWFyIHRoZSBhY3RpdmUgdGltZW91dCB0byBhbGxvdyByZXBsYWNlbWVudC4NCgkJCXdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fY2FsbCk7DQoJCX0NCg0KCQkvLyBBZGp1c3QgdGhlIG9yaWdpbiBvZiB0aGUgdGltZXIgdG8gbWF0Y2ggdGhlIG5ldyB0aW1lb3V0IHZhbHVlLg0KCQl0aGlzLl90aW1lICs9IHRoaXMucmVhZCgpICUgdGltZW91dCAtIGVsYXBzZWQ7DQoNCgkJdGhpcy5fdGltZW91dCA9IHRpbWVvdXQ7DQoJCXRoaXMuX2NhbGwgPSB3aW5kb3cuc2V0VGltZW91dCgkLnByb3h5KHRoaXMuX25leHQsIHRoaXMsIHNwZWVkKSwgdGltZW91dCAtIGVsYXBzZWQpOw0KCX07DQoNCgkvKioNCgkgKiBTdG9wcyB0aGUgYXV0b3BsYXkuDQoJICogQHB1YmxpYw0KCSAqLw0KCUF1dG9wbGF5LnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLl9jb3JlLmlzKCdyb3RhdGluZycpKSB7DQoJCQkvLyBSZXNldCB0aGUgY2xvY2suDQoJCQl0aGlzLl90aW1lID0gMDsNCgkJCXRoaXMuX3BhdXNlZCA9IHRydWU7DQoNCgkJCXdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fY2FsbCk7DQoJCQl0aGlzLl9jb3JlLmxlYXZlKCdyb3RhdGluZycpOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFBhdXNlcyB0aGUgYXV0b3BsYXkuDQoJICogQHB1YmxpYw0KCSAqLw0KCUF1dG9wbGF5LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5fY29yZS5pcygncm90YXRpbmcnKSAmJiAhdGhpcy5fcGF1c2VkKSB7DQoJCQkvLyBQYXVzZSB0aGUgY2xvY2suDQoJCQl0aGlzLl90aW1lID0gdGhpcy5yZWFkKCk7DQoJCQl0aGlzLl9wYXVzZWQgPSB0cnVlOw0KDQoJCQl3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX2NhbGwpOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIERlc3Ryb3lzIHRoZSBwbHVnaW4uDQoJICovDQoJQXV0b3BsYXkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsNCgkJdmFyIGhhbmRsZXIsIHByb3BlcnR5Ow0KDQoJCXRoaXMuc3RvcCgpOw0KDQoJCWZvciAoaGFuZGxlciBpbiB0aGlzLl9oYW5kbGVycykgew0KCQkJdGhpcy5fY29yZS4kZWxlbWVudC5vZmYoaGFuZGxlciwgdGhpcy5faGFuZGxlcnNbaGFuZGxlcl0pOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPSAnZnVuY3Rpb24nICYmICh0aGlzW3Byb3BlcnR5XSA9IG51bGwpOw0KCQl9DQoJfTsNCg0KCSQuZm4ub3dsQ2Fyb3VzZWwuQ29uc3RydWN0b3IuUGx1Z2lucy5hdXRvcGxheSA9IEF1dG9wbGF5Ow0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7DQoNCi8qKg0KICogTmF2aWdhdGlvbiBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEFydHVzIEtvbGFub3dza2kNCiAqIEBhdXRob3IgRGF2aWQgRGV1dHNjaA0KICogQGxpY2Vuc2UgVGhlIE1JVCBMaWNlbnNlIChNSVQpDQogKi8NCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoJJ3VzZSBzdHJpY3QnOw0KDQoJLyoqDQoJICogQ3JlYXRlcyB0aGUgbmF2aWdhdGlvbiBwbHVnaW4uDQoJICogQGNsYXNzIFRoZSBOYXZpZ2F0aW9uIFBsdWdpbg0KCSAqIEBwYXJhbSB7T3dsfSBjYXJvdXNlbCAtIFRoZSBPd2wgQ2Fyb3VzZWwuDQoJICovDQoJdmFyIE5hdmlnYXRpb24gPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KCQkvKioNCgkJICogUmVmZXJlbmNlIHRvIHRoZSBjb3JlLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPd2x9DQoJCSAqLw0KCQl0aGlzLl9jb3JlID0gY2Fyb3VzZWw7DQoNCgkJLyoqDQoJCSAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBwbHVnaW4gaXMgaW5pdGlhbGl6ZWQgb3Igbm90Lg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtCb29sZWFufQ0KCQkgKi8NCgkJdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTsNCg0KCQkvKioNCgkJICogVGhlIGN1cnJlbnQgcGFnaW5nIGluZGV4ZXMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge0FycmF5fQ0KCQkgKi8NCgkJdGhpcy5fcGFnZXMgPSBbXTsNCg0KCQkvKioNCgkJICogQWxsIERPTSBlbGVtZW50cyBvZiB0aGUgdXNlciBpbnRlcmZhY2UuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge09iamVjdH0NCgkJICovDQoJCXRoaXMuX2NvbnRyb2xzID0ge307DQoNCgkJLyoqDQoJCSAqIE1hcmt1cCBmb3IgYW4gaW5kaWNhdG9yLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtBcnJheS48U3RyaW5nPn0NCgkJICovDQoJCXRoaXMuX3RlbXBsYXRlcyA9IFtdOw0KDQoJCS8qKg0KCQkgKiBUaGUgY2Fyb3VzZWwgZWxlbWVudC4NCgkJICogQHR5cGUge2pRdWVyeX0NCgkJICovDQoJCXRoaXMuJGVsZW1lbnQgPSB0aGlzLl9jb3JlLiRlbGVtZW50Ow0KDQoJCS8qKg0KCQkgKiBPdmVycmlkZGVuIG1ldGhvZHMgb2YgdGhlIGNhcm91c2VsLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9vdmVycmlkZXMgPSB7DQoJCQluZXh0OiB0aGlzLl9jb3JlLm5leHQsDQoJCQlwcmV2OiB0aGlzLl9jb3JlLnByZXYsDQoJCQl0bzogdGhpcy5fY29yZS50bw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBBbGwgZXZlbnQgaGFuZGxlcnMuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge09iamVjdH0NCgkJICovDQoJCXRoaXMuX2hhbmRsZXJzID0gew0KCQkJJ3ByZXBhcmVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9jb3JlLnNldHRpbmdzLmRvdHNEYXRhKSB7DQoJCQkJCXRoaXMuX3RlbXBsYXRlcy5wdXNoKCc8ZGl2IGNsYXNzPSInICsgdGhpcy5fY29yZS5zZXR0aW5ncy5kb3RDbGFzcyArICciPicgKw0KCQkJCQkJJChlLmNvbnRlbnQpLmZpbmQoJ1tkYXRhLWRvdF0nKS5hZGRCYWNrKCdbZGF0YS1kb3RdJykuYXR0cignZGF0YS1kb3QnKSArICc8L2Rpdj4nKTsNCgkJCQl9DQoJCQl9LCB0aGlzKSwNCgkJCSdhZGRlZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UgJiYgdGhpcy5fY29yZS5zZXR0aW5ncy5kb3RzRGF0YSkgew0KCQkJCQl0aGlzLl90ZW1wbGF0ZXMuc3BsaWNlKGUucG9zaXRpb24sIDAsIHRoaXMuX3RlbXBsYXRlcy5wb3AoKSk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkncmVtb3ZlLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9jb3JlLnNldHRpbmdzLmRvdHNEYXRhKSB7DQoJCQkJCXRoaXMuX3RlbXBsYXRlcy5zcGxpY2UoZS5wb3NpdGlvbiwgMSk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQknY2hhbmdlZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UgJiYgZS5wcm9wZXJ0eS5uYW1lID09ICdwb3NpdGlvbicpIHsNCgkJCQkJdGhpcy5kcmF3KCk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQknaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmICF0aGlzLl9pbml0aWFsaXplZCkgew0KCQkJCQl0aGlzLl9jb3JlLnRyaWdnZXIoJ2luaXRpYWxpemUnLCBudWxsLCAnbmF2aWdhdGlvbicpOw0KCQkJCQl0aGlzLmluaXRpYWxpemUoKTsNCgkJCQkJdGhpcy51cGRhdGUoKTsNCgkJCQkJdGhpcy5kcmF3KCk7DQoJCQkJCXRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZTsNCgkJCQkJdGhpcy5fY29yZS50cmlnZ2VyKCdpbml0aWFsaXplZCcsIG51bGwsICduYXZpZ2F0aW9uJyk7DQoJCQkJfQ0KCQkJfSwgdGhpcyksDQoJCQkncmVmcmVzaGVkLm93bC5jYXJvdXNlbCc6ICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCWlmIChlLm5hbWVzcGFjZSAmJiB0aGlzLl9pbml0aWFsaXplZCkgew0KCQkJCQl0aGlzLl9jb3JlLnRyaWdnZXIoJ3JlZnJlc2gnLCBudWxsLCAnbmF2aWdhdGlvbicpOw0KCQkJCQl0aGlzLnVwZGF0ZSgpOw0KCQkJCQl0aGlzLmRyYXcoKTsNCgkJCQkJdGhpcy5fY29yZS50cmlnZ2VyKCdyZWZyZXNoZWQnLCBudWxsLCAnbmF2aWdhdGlvbicpOw0KCQkJCX0NCgkJCX0sIHRoaXMpDQoJCX07DQoNCgkJLy8gc2V0IGRlZmF1bHQgb3B0aW9ucw0KCQl0aGlzLl9jb3JlLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgTmF2aWdhdGlvbi5EZWZhdWx0cywgdGhpcy5fY29yZS5vcHRpb25zKTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBoYW5kbGVycw0KCQl0aGlzLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCgl9Ow0KDQoJLyoqDQoJICogRGVmYXVsdCBvcHRpb25zLg0KCSAqIEBwdWJsaWMNCgkgKiBAdG9kbyBSZW5hbWUgYHNsaWRlQnlgIHRvIGBuYXZCeWANCgkgKi8NCglOYXZpZ2F0aW9uLkRlZmF1bHRzID0gew0KCQluYXY6IGZhbHNlLA0KCQluYXZUZXh0OiBbDQoJCQknPHNwYW4gYXJpYS1sYWJlbD0iJyArICdQcmV2aW91cycgKyAnIj4mI3gyMDM5Ozwvc3Bhbj4nLA0KCQkJJzxzcGFuIGFyaWEtbGFiZWw9IicgKyAnTmV4dCcgKyAnIj4mI3gyMDNhOzwvc3Bhbj4nDQoJCV0sDQoJCW5hdlNwZWVkOiBmYWxzZSwNCgkJbmF2RWxlbWVudDogJ2J1dHRvbiB0eXBlPSJidXR0b24iIHJvbGU9InByZXNlbnRhdGlvbiInLA0KCQluYXZDb250YWluZXI6IGZhbHNlLA0KCQluYXZDb250YWluZXJDbGFzczogJ293bC1uYXYnLA0KCQluYXZDbGFzczogWw0KCQkJJ293bC1wcmV2JywNCgkJCSdvd2wtbmV4dCcNCgkJXSwNCgkJc2xpZGVCeTogMSwNCgkJZG90Q2xhc3M6ICdvd2wtZG90JywNCgkJZG90c0NsYXNzOiAnb3dsLWRvdHMnLA0KCQlkb3RzOiB0cnVlLA0KCQlkb3RzRWFjaDogZmFsc2UsDQoJCWRvdHNEYXRhOiBmYWxzZSwNCgkJZG90c1NwZWVkOiBmYWxzZSwNCgkJZG90c0NvbnRhaW5lcjogZmFsc2UNCgl9Ow0KDQoJLyoqDQoJICogSW5pdGlhbGl6ZXMgdGhlIGxheW91dCBvZiB0aGUgcGx1Z2luIGFuZCBleHRlbmRzIHRoZSBjYXJvdXNlbC4NCgkgKiBAcHJvdGVjdGVkDQoJICovDQoJTmF2aWdhdGlvbi5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgb3ZlcnJpZGUsDQoJCQlzZXR0aW5ncyA9IHRoaXMuX2NvcmUuc2V0dGluZ3M7DQoNCgkJLy8gY3JlYXRlIERPTSBzdHJ1Y3R1cmUgZm9yIHJlbGF0aXZlIG5hdmlnYXRpb24NCgkJdGhpcy5fY29udHJvbHMuJHJlbGF0aXZlID0gKHNldHRpbmdzLm5hdkNvbnRhaW5lciA/ICQoc2V0dGluZ3MubmF2Q29udGFpbmVyKQ0KCQkJOiAkKCc8ZGl2PicpLmFkZENsYXNzKHNldHRpbmdzLm5hdkNvbnRhaW5lckNsYXNzKS5hcHBlbmRUbyh0aGlzLiRlbGVtZW50KSkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQoNCgkJdGhpcy5fY29udHJvbHMuJHByZXZpb3VzID0gJCgnPCcgKyBzZXR0aW5ncy5uYXZFbGVtZW50ICsgJz4nKQ0KCQkJLmFkZENsYXNzKHNldHRpbmdzLm5hdkNsYXNzWzBdKQ0KCQkJLmh0bWwoc2V0dGluZ3MubmF2VGV4dFswXSkNCgkJCS5wcmVwZW5kVG8odGhpcy5fY29udHJvbHMuJHJlbGF0aXZlKQ0KCQkJLm9uKCdjbGljaycsICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJCXRoaXMucHJldihzZXR0aW5ncy5uYXZTcGVlZCk7DQoJCQl9LCB0aGlzKSk7DQoJCXRoaXMuX2NvbnRyb2xzLiRuZXh0ID0gJCgnPCcgKyBzZXR0aW5ncy5uYXZFbGVtZW50ICsgJz4nKQ0KCQkJLmFkZENsYXNzKHNldHRpbmdzLm5hdkNsYXNzWzFdKQ0KCQkJLmh0bWwoc2V0dGluZ3MubmF2VGV4dFsxXSkNCgkJCS5hcHBlbmRUbyh0aGlzLl9jb250cm9scy4kcmVsYXRpdmUpDQoJCQkub24oJ2NsaWNrJywgJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJdGhpcy5uZXh0KHNldHRpbmdzLm5hdlNwZWVkKTsNCgkJCX0sIHRoaXMpKTsNCg0KCQkvLyBjcmVhdGUgRE9NIHN0cnVjdHVyZSBmb3IgYWJzb2x1dGUgbmF2aWdhdGlvbg0KCQlpZiAoIXNldHRpbmdzLmRvdHNEYXRhKSB7DQoJCQl0aGlzLl90ZW1wbGF0ZXMgPSBbICQoJzxidXR0b24gcm9sZT0iYnV0dG9uIj4nKQ0KCQkJCS5hZGRDbGFzcyhzZXR0aW5ncy5kb3RDbGFzcykNCgkJCQkuYXBwZW5kKCQoJzxzcGFuPicpKQ0KCQkJCS5wcm9wKCdvdXRlckhUTUwnKSBdOw0KCQl9DQoNCgkJdGhpcy5fY29udHJvbHMuJGFic29sdXRlID0gKHNldHRpbmdzLmRvdHNDb250YWluZXIgPyAkKHNldHRpbmdzLmRvdHNDb250YWluZXIpDQoJCQk6ICQoJzxkaXY+JykuYWRkQ2xhc3Moc2V0dGluZ3MuZG90c0NsYXNzKS5hcHBlbmRUbyh0aGlzLiRlbGVtZW50KSkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQoNCgkJdGhpcy5fY29udHJvbHMuJGFic29sdXRlLm9uKCdjbGljaycsICdidXR0b24nLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCXZhciBpbmRleCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLmlzKHRoaXMuX2NvbnRyb2xzLiRhYnNvbHV0ZSkNCgkJCQk/ICQoZS50YXJnZXQpLmluZGV4KCkgOiAkKGUudGFyZ2V0KS5wYXJlbnQoKS5pbmRleCgpOw0KDQoJCQllLnByZXZlbnREZWZhdWx0KCk7DQoNCgkJCXRoaXMudG8oaW5kZXgsIHNldHRpbmdzLmRvdHNTcGVlZCk7DQoJCX0sIHRoaXMpKTsNCg0KCQkvKiRlbC5vbignZm9jdXNpbicsIGZ1bmN0aW9uKCkgew0KCQkJJChkb2N1bWVudCkub2ZmKCIuY2Fyb3VzZWwiKTsNCg0KCQkJJChkb2N1bWVudCkub24oJ2tleWRvd24uY2Fyb3VzZWwnLCBmdW5jdGlvbihlKSB7DQoJCQkJaWYoZS5rZXlDb2RlID09IDM3KSB7DQoJCQkJCSRlbC50cmlnZ2VyKCdwcmV2Lm93bCcpDQoJCQkJfQ0KCQkJCWlmKGUua2V5Q29kZSA9PSAzOSkgew0KCQkJCQkkZWwudHJpZ2dlcignbmV4dC5vd2wnKQ0KCQkJCX0NCgkJCX0pOw0KCQl9KTsqLw0KDQoJCS8vIG92ZXJyaWRlIHB1YmxpYyBtZXRob2RzIG9mIHRoZSBjYXJvdXNlbA0KCQlmb3IgKG92ZXJyaWRlIGluIHRoaXMuX292ZXJyaWRlcykgew0KCQkJdGhpcy5fY29yZVtvdmVycmlkZV0gPSAkLnByb3h5KHRoaXNbb3ZlcnJpZGVdLCB0aGlzKTsNCgkJfQ0KCX07DQoNCgkvKioNCgkgKiBEZXN0cm95cyB0aGUgcGx1Z2luLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7DQoJCXZhciBoYW5kbGVyLCBjb250cm9sLCBwcm9wZXJ0eSwgb3ZlcnJpZGUsIHNldHRpbmdzOw0KCQlzZXR0aW5ncyA9IHRoaXMuX2NvcmUuc2V0dGluZ3M7DQoNCgkJZm9yIChoYW5kbGVyIGluIHRoaXMuX2hhbmRsZXJzKSB7DQoJCQl0aGlzLiRlbGVtZW50Lm9mZihoYW5kbGVyLCB0aGlzLl9oYW5kbGVyc1toYW5kbGVyXSk7DQoJCX0NCgkJZm9yIChjb250cm9sIGluIHRoaXMuX2NvbnRyb2xzKSB7DQoJCQlpZiAoY29udHJvbCA9PT0gJyRyZWxhdGl2ZScgJiYgc2V0dGluZ3MubmF2Q29udGFpbmVyKSB7DQoJCQkJdGhpcy5fY29udHJvbHNbY29udHJvbF0uaHRtbCgnJyk7DQoJCQl9IGVsc2Ugew0KCQkJCXRoaXMuX2NvbnRyb2xzW2NvbnRyb2xdLnJlbW92ZSgpOw0KCQkJfQ0KCQl9DQoJCWZvciAob3ZlcnJpZGUgaW4gdGhpcy5vdmVyaWRlcykgew0KCQkJdGhpcy5fY29yZVtvdmVycmlkZV0gPSB0aGlzLl9vdmVycmlkZXNbb3ZlcnJpZGVdOw0KCQl9DQoJCWZvciAocHJvcGVydHkgaW4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsNCgkJCXR5cGVvZiB0aGlzW3Byb3BlcnR5XSAhPSAnZnVuY3Rpb24nICYmICh0aGlzW3Byb3BlcnR5XSA9IG51bGwpOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFVwZGF0ZXMgdGhlIGludGVybmFsIHN0YXRlLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCgkJdmFyIGksIGosIGssDQoJCQlsb3dlciA9IHRoaXMuX2NvcmUuY2xvbmVzKCkubGVuZ3RoIC8gMiwNCgkJCXVwcGVyID0gbG93ZXIgKyB0aGlzLl9jb3JlLml0ZW1zKCkubGVuZ3RoLA0KCQkJbWF4aW11bSA9IHRoaXMuX2NvcmUubWF4aW11bSh0cnVlKSwNCgkJCXNldHRpbmdzID0gdGhpcy5fY29yZS5zZXR0aW5ncywNCgkJCXNpemUgPSBzZXR0aW5ncy5jZW50ZXIgfHwgc2V0dGluZ3MuYXV0b1dpZHRoIHx8IHNldHRpbmdzLmRvdHNEYXRhDQoJCQkJPyAxIDogc2V0dGluZ3MuZG90c0VhY2ggfHwgc2V0dGluZ3MuaXRlbXM7DQoNCgkJaWYgKHNldHRpbmdzLnNsaWRlQnkgIT09ICdwYWdlJykgew0KCQkJc2V0dGluZ3Muc2xpZGVCeSA9IE1hdGgubWluKHNldHRpbmdzLnNsaWRlQnksIHNldHRpbmdzLml0ZW1zKTsNCgkJfQ0KDQoJCWlmIChzZXR0aW5ncy5kb3RzIHx8IHNldHRpbmdzLnNsaWRlQnkgPT0gJ3BhZ2UnKSB7DQoJCQl0aGlzLl9wYWdlcyA9IFtdOw0KDQoJCQlmb3IgKGkgPSBsb3dlciwgaiA9IDAsIGsgPSAwOyBpIDwgdXBwZXI7IGkrKykgew0KCQkJCWlmIChqID49IHNpemUgfHwgaiA9PT0gMCkgew0KCQkJCQl0aGlzLl9wYWdlcy5wdXNoKHsNCgkJCQkJCXN0YXJ0OiBNYXRoLm1pbihtYXhpbXVtLCBpIC0gbG93ZXIpLA0KCQkJCQkJZW5kOiBpIC0gbG93ZXIgKyBzaXplIC0gMQ0KCQkJCQl9KTsNCgkJCQkJaWYgKE1hdGgubWluKG1heGltdW0sIGkgLSBsb3dlcikgPT09IG1heGltdW0pIHsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJCWogPSAwLCArK2s7DQoJCQkJfQ0KCQkJCWogKz0gdGhpcy5fY29yZS5tZXJnZXJzKHRoaXMuX2NvcmUucmVsYXRpdmUoaSkpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIERyYXdzIHRoZSB1c2VyIGludGVyZmFjZS4NCgkgKiBAdG9kbyBUaGUgb3B0aW9uIGBkb3RzRGF0YWAgd29udCB3b3JrLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oKSB7DQoJCXZhciBkaWZmZXJlbmNlLA0KCQkJc2V0dGluZ3MgPSB0aGlzLl9jb3JlLnNldHRpbmdzLA0KCQkJZGlzYWJsZWQgPSB0aGlzLl9jb3JlLml0ZW1zKCkubGVuZ3RoIDw9IHNldHRpbmdzLml0ZW1zLA0KCQkJaW5kZXggPSB0aGlzLl9jb3JlLnJlbGF0aXZlKHRoaXMuX2NvcmUuY3VycmVudCgpKSwNCgkJCWxvb3AgPSBzZXR0aW5ncy5sb29wIHx8IHNldHRpbmdzLnJld2luZDsNCg0KCQl0aGlzLl9jb250cm9scy4kcmVsYXRpdmUudG9nZ2xlQ2xhc3MoJ2Rpc2FibGVkJywgIXNldHRpbmdzLm5hdiB8fCBkaXNhYmxlZCk7DQoNCgkJaWYgKHNldHRpbmdzLm5hdikgew0KCQkJdGhpcy5fY29udHJvbHMuJHByZXZpb3VzLnRvZ2dsZUNsYXNzKCdkaXNhYmxlZCcsICFsb29wICYmIGluZGV4IDw9IHRoaXMuX2NvcmUubWluaW11bSh0cnVlKSk7DQoJCQl0aGlzLl9jb250cm9scy4kbmV4dC50b2dnbGVDbGFzcygnZGlzYWJsZWQnLCAhbG9vcCAmJiBpbmRleCA+PSB0aGlzLl9jb3JlLm1heGltdW0odHJ1ZSkpOw0KCQl9DQoNCgkJdGhpcy5fY29udHJvbHMuJGFic29sdXRlLnRvZ2dsZUNsYXNzKCdkaXNhYmxlZCcsICFzZXR0aW5ncy5kb3RzIHx8IGRpc2FibGVkKTsNCg0KCQlpZiAoc2V0dGluZ3MuZG90cykgew0KCQkJZGlmZmVyZW5jZSA9IHRoaXMuX3BhZ2VzLmxlbmd0aCAtIHRoaXMuX2NvbnRyb2xzLiRhYnNvbHV0ZS5jaGlsZHJlbigpLmxlbmd0aDsNCg0KCQkJaWYgKHNldHRpbmdzLmRvdHNEYXRhICYmIGRpZmZlcmVuY2UgIT09IDApIHsNCgkJCQl0aGlzLl9jb250cm9scy4kYWJzb2x1dGUuaHRtbCh0aGlzLl90ZW1wbGF0ZXMuam9pbignJykpOw0KCQkJfSBlbHNlIGlmIChkaWZmZXJlbmNlID4gMCkgew0KCQkJCXRoaXMuX2NvbnRyb2xzLiRhYnNvbHV0ZS5hcHBlbmQobmV3IEFycmF5KGRpZmZlcmVuY2UgKyAxKS5qb2luKHRoaXMuX3RlbXBsYXRlc1swXSkpOw0KCQkJfSBlbHNlIGlmIChkaWZmZXJlbmNlIDwgMCkgew0KCQkJCXRoaXMuX2NvbnRyb2xzLiRhYnNvbHV0ZS5jaGlsZHJlbigpLnNsaWNlKGRpZmZlcmVuY2UpLnJlbW92ZSgpOw0KCQkJfQ0KDQoJCQl0aGlzLl9jb250cm9scy4kYWJzb2x1dGUuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCXRoaXMuX2NvbnRyb2xzLiRhYnNvbHV0ZS5jaGlsZHJlbigpLmVxKCQuaW5BcnJheSh0aGlzLmN1cnJlbnQoKSwgdGhpcy5fcGFnZXMpKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogRXh0ZW5kcyBldmVudCBkYXRhLg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudCAtIFRoZSBldmVudCBvYmplY3Qgd2hpY2ggZ2V0cyB0aHJvd24uDQoJICovDQoJTmF2aWdhdGlvbi5wcm90b3R5cGUub25UcmlnZ2VyID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJdmFyIHNldHRpbmdzID0gdGhpcy5fY29yZS5zZXR0aW5nczsNCg0KCQlldmVudC5wYWdlID0gew0KCQkJaW5kZXg6ICQuaW5BcnJheSh0aGlzLmN1cnJlbnQoKSwgdGhpcy5fcGFnZXMpLA0KCQkJY291bnQ6IHRoaXMuX3BhZ2VzLmxlbmd0aCwNCgkJCXNpemU6IHNldHRpbmdzICYmIChzZXR0aW5ncy5jZW50ZXIgfHwgc2V0dGluZ3MuYXV0b1dpZHRoIHx8IHNldHRpbmdzLmRvdHNEYXRhDQoJCQkJPyAxIDogc2V0dGluZ3MuZG90c0VhY2ggfHwgc2V0dGluZ3MuaXRlbXMpDQoJCX07DQoJfTsNCg0KCS8qKg0KCSAqIEdldHMgdGhlIGN1cnJlbnQgcGFnZSBwb3NpdGlvbiBvZiB0aGUgY2Fyb3VzZWwuDQoJICogQHByb3RlY3RlZA0KCSAqIEByZXR1cm5zIHtOdW1iZXJ9DQoJICovDQoJTmF2aWdhdGlvbi5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgY3VycmVudCA9IHRoaXMuX2NvcmUucmVsYXRpdmUodGhpcy5fY29yZS5jdXJyZW50KCkpOw0KCQlyZXR1cm4gJC5ncmVwKHRoaXMuX3BhZ2VzLCAkLnByb3h5KGZ1bmN0aW9uKHBhZ2UsIGluZGV4KSB7DQoJCQlyZXR1cm4gcGFnZS5zdGFydCA8PSBjdXJyZW50ICYmIHBhZ2UuZW5kID49IGN1cnJlbnQ7DQoJCX0sIHRoaXMpKS5wb3AoKTsNCgl9Ow0KDQoJLyoqDQoJICogR2V0cyB0aGUgY3VycmVudCBzdWNjZXNvci9wcmVkZWNlc3NvciBwb3NpdGlvbi4NCgkgKiBAcHJvdGVjdGVkDQoJICogQHJldHVybnMge051bWJlcn0NCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKHN1Y2Nlc3Nvcikgew0KCQl2YXIgcG9zaXRpb24sIGxlbmd0aCwNCgkJCXNldHRpbmdzID0gdGhpcy5fY29yZS5zZXR0aW5nczsNCg0KCQlpZiAoc2V0dGluZ3Muc2xpZGVCeSA9PSAncGFnZScpIHsNCgkJCXBvc2l0aW9uID0gJC5pbkFycmF5KHRoaXMuY3VycmVudCgpLCB0aGlzLl9wYWdlcyk7DQoJCQlsZW5ndGggPSB0aGlzLl9wYWdlcy5sZW5ndGg7DQoJCQlzdWNjZXNzb3IgPyArK3Bvc2l0aW9uIDogLS1wb3NpdGlvbjsNCgkJCXBvc2l0aW9uID0gdGhpcy5fcGFnZXNbKChwb3NpdGlvbiAlIGxlbmd0aCkgKyBsZW5ndGgpICUgbGVuZ3RoXS5zdGFydDsNCgkJfSBlbHNlIHsNCgkJCXBvc2l0aW9uID0gdGhpcy5fY29yZS5yZWxhdGl2ZSh0aGlzLl9jb3JlLmN1cnJlbnQoKSk7DQoJCQlsZW5ndGggPSB0aGlzLl9jb3JlLml0ZW1zKCkubGVuZ3RoOw0KCQkJc3VjY2Vzc29yID8gcG9zaXRpb24gKz0gc2V0dGluZ3Muc2xpZGVCeSA6IHBvc2l0aW9uIC09IHNldHRpbmdzLnNsaWRlQnk7DQoJCX0NCg0KCQlyZXR1cm4gcG9zaXRpb247DQoJfTsNCg0KCS8qKg0KCSAqIFNsaWRlcyB0byB0aGUgbmV4dCBpdGVtIG9yIHBhZ2UuDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBbc3BlZWQ9ZmFsc2VdIC0gVGhlIHRpbWUgaW4gbWlsbGlzZWNvbmRzIGZvciB0aGUgdHJhbnNpdGlvbi4NCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oc3BlZWQpIHsNCgkJJC5wcm94eSh0aGlzLl9vdmVycmlkZXMudG8sIHRoaXMuX2NvcmUpKHRoaXMuZ2V0UG9zaXRpb24odHJ1ZSksIHNwZWVkKTsNCgl9Ow0KDQoJLyoqDQoJICogU2xpZGVzIHRvIHRoZSBwcmV2aW91cyBpdGVtIG9yIHBhZ2UuDQoJICogQHB1YmxpYw0KCSAqIEBwYXJhbSB7TnVtYmVyfSBbc3BlZWQ9ZmFsc2VdIC0gVGhlIHRpbWUgaW4gbWlsbGlzZWNvbmRzIGZvciB0aGUgdHJhbnNpdGlvbi4NCgkgKi8NCglOYXZpZ2F0aW9uLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24oc3BlZWQpIHsNCgkJJC5wcm94eSh0aGlzLl9vdmVycmlkZXMudG8sIHRoaXMuX2NvcmUpKHRoaXMuZ2V0UG9zaXRpb24oZmFsc2UpLCBzcGVlZCk7DQoJfTsNCg0KCS8qKg0KCSAqIFNsaWRlcyB0byB0aGUgc3BlY2lmaWVkIGl0ZW0gb3IgcGFnZS4NCgkgKiBAcHVibGljDQoJICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIG9yIHBhZ2UuDQoJICogQHBhcmFtIHtOdW1iZXJ9IFtzcGVlZF0gLSBUaGUgdGltZSBpbiBtaWxsaXNlY29uZHMgZm9yIHRoZSB0cmFuc2l0aW9uLg0KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW3N0YW5kYXJkPWZhbHNlXSAtIFdoZXRoZXIgdG8gdXNlIHRoZSBzdGFuZGFyZCBiZWhhdmlvdXIgb3Igbm90Lg0KCSAqLw0KCU5hdmlnYXRpb24ucHJvdG90eXBlLnRvID0gZnVuY3Rpb24ocG9zaXRpb24sIHNwZWVkLCBzdGFuZGFyZCkgew0KCQl2YXIgbGVuZ3RoOw0KDQoJCWlmICghc3RhbmRhcmQgJiYgdGhpcy5fcGFnZXMubGVuZ3RoKSB7DQoJCQlsZW5ndGggPSB0aGlzLl9wYWdlcy5sZW5ndGg7DQoJCQkkLnByb3h5KHRoaXMuX292ZXJyaWRlcy50bywgdGhpcy5fY29yZSkodGhpcy5fcGFnZXNbKChwb3NpdGlvbiAlIGxlbmd0aCkgKyBsZW5ndGgpICUgbGVuZ3RoXS5zdGFydCwgc3BlZWQpOw0KCQl9IGVsc2Ugew0KCQkJJC5wcm94eSh0aGlzLl9vdmVycmlkZXMudG8sIHRoaXMuX2NvcmUpKHBvc2l0aW9uLCBzcGVlZCk7DQoJCX0NCgl9Ow0KDQoJJC5mbi5vd2xDYXJvdXNlbC5Db25zdHJ1Y3Rvci5QbHVnaW5zLk5hdmlnYXRpb24gPSBOYXZpZ2F0aW9uOw0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7DQoNCi8qKg0KICogSGFzaCBQbHVnaW4NCiAqIEB2ZXJzaW9uIDIuMy40DQogKiBAYXV0aG9yIEFydHVzIEtvbGFub3dza2kNCiAqIEBhdXRob3IgRGF2aWQgRGV1dHNjaA0KICogQGxpY2Vuc2UgVGhlIE1JVCBMaWNlbnNlIChNSVQpDQogKi8NCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7DQoJJ3VzZSBzdHJpY3QnOw0KDQoJLyoqDQoJICogQ3JlYXRlcyB0aGUgaGFzaCBwbHVnaW4uDQoJICogQGNsYXNzIFRoZSBIYXNoIFBsdWdpbg0KCSAqIEBwYXJhbSB7T3dsfSBjYXJvdXNlbCAtIFRoZSBPd2wgQ2Fyb3VzZWwNCgkgKi8NCgl2YXIgSGFzaCA9IGZ1bmN0aW9uKGNhcm91c2VsKSB7DQoJCS8qKg0KCQkgKiBSZWZlcmVuY2UgdG8gdGhlIGNvcmUuDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICogQHR5cGUge093bH0NCgkJICovDQoJCXRoaXMuX2NvcmUgPSBjYXJvdXNlbDsNCg0KCQkvKioNCgkJICogSGFzaCBpbmRleCBmb3IgdGhlIGl0ZW1zLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9oYXNoZXMgPSB7fTsNCg0KCQkvKioNCgkJICogVGhlIGNhcm91c2VsIGVsZW1lbnQuDQoJCSAqIEB0eXBlIHtqUXVlcnl9DQoJCSAqLw0KCQl0aGlzLiRlbGVtZW50ID0gdGhpcy5fY29yZS4kZWxlbWVudDsNCg0KCQkvKioNCgkJICogQWxsIGV2ZW50IGhhbmRsZXJzLg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqIEB0eXBlIHtPYmplY3R9DQoJCSAqLw0KCQl0aGlzLl9oYW5kbGVycyA9IHsNCgkJCSdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UgJiYgdGhpcy5fY29yZS5zZXR0aW5ncy5zdGFydFBvc2l0aW9uID09PSAnVVJMSGFzaCcpIHsNCgkJCQkJJCh3aW5kb3cpLnRyaWdnZXIoJ2hhc2hjaGFuZ2Uub3dsLm5hdmlnYXRpb24nKTsNCgkJCQl9DQoJCQl9LCB0aGlzKSwNCgkJCSdwcmVwYXJlZC5vd2wuY2Fyb3VzZWwnOiAkLnByb3h5KGZ1bmN0aW9uKGUpIHsNCgkJCQlpZiAoZS5uYW1lc3BhY2UpIHsNCgkJCQkJdmFyIGhhc2ggPSAkKGUuY29udGVudCkuZmluZCgnW2RhdGEtaGFzaF0nKS5hZGRCYWNrKCdbZGF0YS1oYXNoXScpLmF0dHIoJ2RhdGEtaGFzaCcpOw0KDQoJCQkJCWlmICghaGFzaCkgew0KCQkJCQkJcmV0dXJuOw0KCQkJCQl9DQoNCgkJCQkJdGhpcy5faGFzaGVzW2hhc2hdID0gZS5jb250ZW50Ow0KCQkJCX0NCgkJCX0sIHRoaXMpLA0KCQkJJ2NoYW5nZWQub3dsLmNhcm91c2VsJzogJC5wcm94eShmdW5jdGlvbihlKSB7DQoJCQkJaWYgKGUubmFtZXNwYWNlICYmIGUucHJvcGVydHkubmFtZSA9PT0gJ3Bvc2l0aW9uJykgew0KCQkJCQl2YXIgY3VycmVudCA9IHRoaXMuX2NvcmUuaXRlbXModGhpcy5fY29yZS5yZWxhdGl2ZSh0aGlzLl9jb3JlLmN1cnJlbnQoKSkpLA0KCQkJCQkJaGFzaCA9ICQubWFwKHRoaXMuX2hhc2hlcywgZnVuY3Rpb24oaXRlbSwgaGFzaCkgew0KCQkJCQkJCXJldHVybiBpdGVtID09PSBjdXJyZW50ID8gaGFzaCA6IG51bGw7DQoJCQkJCQl9KS5qb2luKCk7DQoNCgkJCQkJaWYgKCFoYXNoIHx8IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpID09PSBoYXNoKSB7DQoJCQkJCQlyZXR1cm47DQoJCQkJCX0NCg0KCQkJCQl3aW5kb3cubG9jYXRpb24uaGFzaCA9IGhhc2g7DQoJCQkJfQ0KCQkJfSwgdGhpcykNCgkJfTsNCg0KCQkvLyBzZXQgZGVmYXVsdCBvcHRpb25zDQoJCXRoaXMuX2NvcmUub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBIYXNoLkRlZmF1bHRzLCB0aGlzLl9jb3JlLm9wdGlvbnMpOw0KDQoJCS8vIHJlZ2lzdGVyIHRoZSBldmVudCBoYW5kbGVycw0KCQl0aGlzLiRlbGVtZW50Lm9uKHRoaXMuX2hhbmRsZXJzKTsNCg0KCQkvLyByZWdpc3RlciBldmVudCBsaXN0ZW5lciBmb3IgaGFzaCBuYXZpZ2F0aW9uDQoJCSQod2luZG93KS5vbignaGFzaGNoYW5nZS5vd2wubmF2aWdhdGlvbicsICQucHJveHkoZnVuY3Rpb24oZSkgew0KCQkJdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSksDQoJCQkJaXRlbXMgPSB0aGlzLl9jb3JlLiRzdGFnZS5jaGlsZHJlbigpLA0KCQkJCXBvc2l0aW9uID0gdGhpcy5faGFzaGVzW2hhc2hdICYmIGl0ZW1zLmluZGV4KHRoaXMuX2hhc2hlc1toYXNoXSk7DQoNCgkJCWlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHBvc2l0aW9uID09PSB0aGlzLl9jb3JlLmN1cnJlbnQoKSkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJdGhpcy5fY29yZS50byh0aGlzLl9jb3JlLnJlbGF0aXZlKHBvc2l0aW9uKSwgZmFsc2UsIHRydWUpOw0KCQl9LCB0aGlzKSk7DQoJfTsNCg0KCS8qKg0KCSAqIERlZmF1bHQgb3B0aW9ucy4NCgkgKiBAcHVibGljDQoJICovDQoJSGFzaC5EZWZhdWx0cyA9IHsNCgkJVVJMaGFzaExpc3RlbmVyOiBmYWxzZQ0KCX07DQoNCgkvKioNCgkgKiBEZXN0cm95cyB0aGUgcGx1Z2luLg0KCSAqIEBwdWJsaWMNCgkgKi8NCglIYXNoLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7DQoJCXZhciBoYW5kbGVyLCBwcm9wZXJ0eTsNCg0KCQkkKHdpbmRvdykub2ZmKCdoYXNoY2hhbmdlLm93bC5uYXZpZ2F0aW9uJyk7DQoNCgkJZm9yIChoYW5kbGVyIGluIHRoaXMuX2hhbmRsZXJzKSB7DQoJCQl0aGlzLl9jb3JlLiRlbGVtZW50Lm9mZihoYW5kbGVyLCB0aGlzLl9oYW5kbGVyc1toYW5kbGVyXSk7DQoJCX0NCgkJZm9yIChwcm9wZXJ0eSBpbiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgew0KCQkJdHlwZW9mIHRoaXNbcHJvcGVydHldICE9ICdmdW5jdGlvbicgJiYgKHRoaXNbcHJvcGVydHldID0gbnVsbCk7DQoJCX0NCgl9Ow0KDQoJJC5mbi5vd2xDYXJvdXNlbC5Db25zdHJ1Y3Rvci5QbHVnaW5zLkhhc2ggPSBIYXNoOw0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7DQoNCi8qKg0KICogU3VwcG9ydCBQbHVnaW4NCiAqDQogKiBAdmVyc2lvbiAyLjMuNA0KICogQGF1dGhvciBWaXZpZCBQbGFuZXQgU29mdHdhcmUgR21iSA0KICogQGF1dGhvciBBcnR1cyBLb2xhbm93c2tpDQogKiBAYXV0aG9yIERhdmlkIERldXRzY2gNCiAqIEBsaWNlbnNlIFRoZSBNSVQgTGljZW5zZSAoTUlUKQ0KICovDQo7KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgew0KDQoJdmFyIHN0eWxlID0gJCgnPHN1cHBvcnQ+JykuZ2V0KDApLnN0eWxlLA0KCQlwcmVmaXhlcyA9ICdXZWJraXQgTW96IE8gbXMnLnNwbGl0KCcgJyksDQoJCWV2ZW50cyA9IHsNCgkJCXRyYW5zaXRpb246IHsNCgkJCQllbmQ6IHsNCgkJCQkJV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLA0KCQkJCQlNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsDQoJCQkJCU9UcmFuc2l0aW9uOiAnb1RyYW5zaXRpb25FbmQnLA0KCQkJCQl0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcNCgkJCQl9DQoJCQl9LA0KCQkJYW5pbWF0aW9uOiB7DQoJCQkJZW5kOiB7DQoJCQkJCVdlYmtpdEFuaW1hdGlvbjogJ3dlYmtpdEFuaW1hdGlvbkVuZCcsDQoJCQkJCU1vekFuaW1hdGlvbjogJ2FuaW1hdGlvbmVuZCcsDQoJCQkJCU9BbmltYXRpb246ICdvQW5pbWF0aW9uRW5kJywNCgkJCQkJYW5pbWF0aW9uOiAnYW5pbWF0aW9uZW5kJw0KCQkJCX0NCgkJCX0NCgkJfSwNCgkJdGVzdHMgPSB7DQoJCQljc3N0cmFuc2Zvcm1zOiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gISF0ZXN0KCd0cmFuc2Zvcm0nKTsNCgkJCX0sDQoJCQljc3N0cmFuc2Zvcm1zM2Q6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiAhIXRlc3QoJ3BlcnNwZWN0aXZlJyk7DQoJCQl9LA0KCQkJY3NzdHJhbnNpdGlvbnM6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiAhIXRlc3QoJ3RyYW5zaXRpb24nKTsNCgkJCX0sDQoJCQljc3NhbmltYXRpb25zOiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gISF0ZXN0KCdhbmltYXRpb24nKTsNCgkJCX0NCgkJfTsNCg0KCWZ1bmN0aW9uIHRlc3QocHJvcGVydHksIHByZWZpeGVkKSB7DQoJCXZhciByZXN1bHQgPSBmYWxzZSwNCgkJCXVwcGVyID0gcHJvcGVydHkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wZXJ0eS5zbGljZSgxKTsNCg0KCQkkLmVhY2goKHByb3BlcnR5ICsgJyAnICsgcHJlZml4ZXMuam9pbih1cHBlciArICcgJykgKyB1cHBlcikuc3BsaXQoJyAnKSwgZnVuY3Rpb24oaSwgcHJvcGVydHkpIHsNCgkJCWlmIChzdHlsZVtwcm9wZXJ0eV0gIT09IHVuZGVmaW5lZCkgew0KCQkJCXJlc3VsdCA9IHByZWZpeGVkID8gcHJvcGVydHkgOiB0cnVlOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfSk7DQoNCgkJcmV0dXJuIHJlc3VsdDsNCgl9DQoNCglmdW5jdGlvbiBwcmVmaXhlZChwcm9wZXJ0eSkgew0KCQlyZXR1cm4gdGVzdChwcm9wZXJ0eSwgdHJ1ZSk7DQoJfQ0KDQoJaWYgKHRlc3RzLmNzc3RyYW5zaXRpb25zKCkpIHsNCgkJLyoganNoaW50IC1XMDUzICovDQoJCSQuc3VwcG9ydC50cmFuc2l0aW9uID0gbmV3IFN0cmluZyhwcmVmaXhlZCgndHJhbnNpdGlvbicpKQ0KCQkkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQgPSBldmVudHMudHJhbnNpdGlvbi5lbmRbICQuc3VwcG9ydC50cmFuc2l0aW9uIF07DQoJfQ0KDQoJaWYgKHRlc3RzLmNzc2FuaW1hdGlvbnMoKSkgew0KCQkvKiBqc2hpbnQgLVcwNTMgKi8NCgkJJC5zdXBwb3J0LmFuaW1hdGlvbiA9IG5ldyBTdHJpbmcocHJlZml4ZWQoJ2FuaW1hdGlvbicpKQ0KCQkkLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCA9IGV2ZW50cy5hbmltYXRpb24uZW5kWyAkLnN1cHBvcnQuYW5pbWF0aW9uIF07DQoJfQ0KDQoJaWYgKHRlc3RzLmNzc3RyYW5zZm9ybXMoKSkgew0KCQkvKiBqc2hpbnQgLVcwNTMgKi8NCgkJJC5zdXBwb3J0LnRyYW5zZm9ybSA9IG5ldyBTdHJpbmcocHJlZml4ZWQoJ3RyYW5zZm9ybScpKTsNCgkJJC5zdXBwb3J0LnRyYW5zZm9ybTNkID0gdGVzdHMuY3NzdHJhbnNmb3JtczNkKCk7DQoJfQ0KDQp9KSh3aW5kb3cuWmVwdG8gfHwgd2luZG93LmpRdWVyeSwgd2luZG93LCBkb2N1bWVudCk7
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 93438
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20220806T160925Z
    - ID: "52807595-0f8f-4b20-8d2a-cb71d28c6103"
      Hint: __Owner
      Value: |
        sitecore\Admin
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\Admin
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "1d8c9a0d-7fbf-48fe-bdfc-d032b7cf589a"
    - ID: "badd9cf9-53e0-4d0c-bcc0-2d784c282f6a"
      Hint: __Updated by
      Value: |
        sitecore\Admin
    - ID: "d9cf14b1-fa16-4ba6-9288-e8a174d4d522"
      Hint: __Updated
      Value: 20220806T160925Z
